# llms-full (private-aware)
> Built from GitHub files and website pages. Large files may be truncated.

--- EntitiesSamples/Docs/additional-entities-features.md ---

In this page: 

- [Enableable components](#enableable-components)
- [Shared components](#shared-components)
- [Cleanup components](#cleanup-components)
- [Chunk components](#chunk-components)
- [Blob assets](#blob-assets)
- [Version numbers](#version-numbers)

<br>

# Enableable components

A struct implementing `IComponentData` or `IBufferElementData` can also implement [`IEnableableComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IEnableableComponent.html). A component type implementing this interface can be enabled and disabled per entity.

**When a component of an entity is disabled, queries consider the entity to not have the component type.** If no entities in a chunk match the query because one or more of their components are disabled, that chunk will not be included in the array returned by the [`ToArchetypeChunkArray()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityQuery.ToArchetypeChunkArray.html) method of `EntityQuery`.

Be clear that disabling a component does *not* remove or modify the component: rather, a bit associated with the specific component of the specific entity is cleared. Also be clear that a disabled component only affects queries: a disabled component can otherwise still be read and modified as normal, such as *via* `EntityManager` methods.

All enableable components are enabled by default on a newly created entity. When an entity is copied for serialization, copied to another world, or copied by the `Instantiate` method of `EntityManager`, the enabled states of the components in the new entity match the states in the original.

The enabled state of an entity's components can be checked and set through:

- [`EntityManager`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.html)
- [`ComponentLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.html)
- [`BufferLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.BufferLookup-1.html) (for a dynamic buffer)
- [`EnabledRefRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EnabledRefRW-1.html) (used in a `SystemAPI.Query` foreach or an `IJobEntity`)
- [`ArchetypeChunk`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ArchetypeChunk.html)

For instance, the `EntityManager` has these key methods:

|**Method**|**Description**|
|----|---|
| [`IsComponentEnabled<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.IsComponentEnabled.html) | Returns true if an entity has a currently enabled T component. |
| [`SetComponentEnabled<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetComponentEnabled.html) | Enables or disables an entity's enableable T component. |

| &#x1F4DD; NOTE |
| :- |
| For the sake of the job safety checks, read or write access of a component's enabled state requires read or write access of the component type itself. |

In an `IJobChunk`, the `Execute` method parameters signal which entities in the chunk match the query:

- If the `useEnableMask` parameter is false, all entities in the chunk match the query. 
- Otherwise, if the `useEnableMask` parameter is true, the bits of the `chunkEnabledMask` parameter signal which entities in the chunk match the query, factoring in all enableable component types of the query. Rather than check these mask bits manually, you can use a [`ChunkEntityEnumerator`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ChunkEntityEnumerator.html) to more conveniently iterate through the matching entities.

| &#x1F4DD; NOTE |
| :- |
| The `chunkEnabledMask` is a *composite* of all the enabled states of the enableable components included in the query of the job. To check enabled states of individual components, use the `IsComponentEnabled()` and `SetComponentEnabled()` methods of the `ArchetypeChunk`. |

<br>

# Shared components

For a shared component type, all entities in a chunk share the same component value rather than each entity having its own value. Consequently, **setting a shared component value of an entity performs a [structural change](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html)**: the entity is moved to a chunk which has the new value.

For example, if an entity has a *Foo* shared component value *X*, then the entity is stored in a chunk that has *Foo* value *X*; if the entity is then set to have *Foo* value *Y*, the entity is moved to a chunk that has value *Y*; if no such chunk already exists, a new chunk is created. 

The primary utility of shared components comes from the fact that **queries can filter for specific shared component values**.

Instead of storing shared component values directly in chunks, the world stores them in a set of arrays, and the chunks store just indexes into these arrays. This means that **each unique shared component value is stored only once within a world**.

A shared component type is declared as a struct implementing `ISharedComponentData`. If the struct contains any managed type fields, then the shared component will itself be a managed component type, with the same advantages and restrictions as a managed `IComponentData`.

The `EntityManager` has these key methods for shared components:

|**Method**|**Description**|
|----|---|
| [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddComponent.html) | Adds a T component to an entity, where T can be a shared component type. |
| [`AddSharedComponent()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddSharedComponent.html) | Adds an unmanaged shared component to an entity and sets its initial value. |
| [`AddSharedComponentManaged()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddSharedComponentManaged.html) | Adds a managed shared component to an entity and sets its initial value. |
| [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.RemoveComponent.html) | Removes a T component from an entity, where T can be a shared component type. |
| [`HasComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.HasComponent.html) | Returns true if an entity currently has a T component, where type T can be a shared component type. |
| [`GetSharedComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetSharedComponent.html) | Retrieves the value of an entity's unmanaged shared T component. |
| [`SetSharedComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetSharedComponent.html) | Overwrites the value of an entity's unmanaged shared T component. |
| [`GetSharedComponentManaged<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetSharedComponentManaged.html) | Retrieves the value of an entity's managed shared T component. |
| [`SetSharedComponentManaged<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetSharedComponentManaged.html) | Overwrites the value of an entity's managed shared T component. |

How a shared component type is compared for equality by the `EntityManager` can be customized by implementing [`IEquatable<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.iequatable-1.equals).

| &#x26A0; IMPORTANT |
| :- |
| Because the `EntityManager` relies upon equality to identify unique and matching shared component values, you should avoid modifying any mutable objects referenced by shared components. For example, if you want to modify an array stored in a shared component of a particular entity, you should not modify the array directly but instead update the component of that entity to have a new, modified copy of the array. |

If a shared component type implements `IRefCounted`, you can use reference counting to detect when a value of the type is no longer stored by any world. For example, if a shared component value that implements `IRefCounted` contains a `NativeArray`, you can dispose the array when the value is no longer stored by any world.

If the shared component type is unmanaged, the methods of `IEquatable<T>` and `IRefCounted` can be Burst-compiled by adding the [`[BurstCompile]`](https://docs.unity3d.com/Packages/com.unity.burst@latest/index.html?subfolder=/api/Unity.Burst.BurstCompileAttribute.html) attribute to the methods and the struct itself.


| &#x26A0; IMPORTANT |
| :- |
| **Having too many unique shared component values may result in chunk fragmentation.** <br> Because all entities in a chunk must share the same shared component values, if you give unique shared component values to a high number of entities, the entities will end up fragmented across many chunks. For example, if there are 500 entities of an archetype with a shared component and each entity has a unique shared component value, each entity is stored by itself in a separate chunk. This wastes most of the space in each chunk and also means that looping through all entities of the archetype requires visiting 500 chunks. This fragmentation largely negates the performance benefits of the ECS structure. To avoid this problem, try to use as few unique shared component values as possible. If, say, the 500 entities were to share only ten unique shared component values, they could be stored in as few as ten chunks. |

<br>

# Cleanup components

Cleanup components are special in two ways:

- When an entity with cleanup components is destroyed, the non-cleanup components are removed, but the entity actually continues to exist until you remove all of its cleanup components individually.
- When an entity is copied to another world, copied in serialization, or copied by the `Instantiate` method of `EntityManager`, any cleanup components of the original are *not* added to the new entity.

The primary use case for cleanup components is to help initialize entities after their creation or cleanup entities after their destruction. For example, say we have entities representing monsters, and they all have a *Monster* tag component:

1. We can find all monster entities needing initialization by querying for all entities which have the *Monster* component but which do *not* have a *MonsterCleanup* component. For all entities matching this query, we perform any required initialization and add *MonsterCleanup*.
2. We can find all monster entities needing cleanup by querying for all entities which have the *MonsterCleanup* component but *not* the *Monster* component. For all entities matching this query, we perform any required cleanup and remove *MonsterCleanup*. Unless the entities have additional remaining cleanup components, this will destroy the entities.

| &#x1F4DD; NOTE |
| :- |
| In some case, you'll want to store information needed for cleanup in your cleanup components, but in many cases, an empty cleanup tag component is sufficient. |

Cleanup components come in four varieties:

|**Kind of cleanup component**|**Description**|
|---|---|
| A struct implementing `ICleanupComponentData` | The cleanup variant of an unmanaged `IComponentData` type.|
| A class implementing `ICleanupComponentData` | The cleanup variant of a managed `IComponentData` type.|
| A struct implementing `ICleanupBufferElementData` | The cleanup variant of a dynamic buffer type.|
| A struct implementing `ICleanupSharedComponentData` | The cleanup variant of a shared component type.|

<br>

# Chunk components

Unlike a regular component, a chunk component is a single value belonging to the whole chunk, not any entity within the chunk.

Just like a regular component, a chunk component is defined as a struct or class implementing `IComponentData`, but a chunk component is added, removed, get, and set with these `EntityManager` methods:

|**Method**|**Description**|
|----|---|
| [`AddChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.AddChunkComponentData.html) | Adds a chunk component of type T to a chunk, where T is a managed or unmanaged `IComponentData`. |
| [`RemoveChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.RemoveChunkComponentData.html) | Removes a chunk component of type T from a chunk, where T is a managed or unmanaged `IComponentData`. |
| [`HasChunkComponent<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.HasChunkComponent.html) | Returns true if a chunk has a chunk component of type T. |
| [`GetChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.GetChunkComponentData.html) | Retrieves the value of a chunk's chunk component of type T. |
| [`SetChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.SetChunkComponentData.html) | Sets the value of a chunk's chunk component of type T. |

| &#x1F4DD; NOTE |
| :- |
| Shared components also store one value per chunk, but a shared component value logically belongs to the entities, not the chunk (which is why setting an entity's shared component value moves the entity to another chunk rather than modifying the value stored in the chunk). Chunk components truly belong to the chunk itself, and unlike unmanaged shared components, unmanaged chunk components are stored directly in the chunk.|

<br>

# Blob assets

A Blob (Binary Large Object) asset is an immutable (unchanging), unmanaged piece of binary data stored in a contiguous block of bytes:

- Blob assets are efficient to copy and load because they are fully *relocatable*: all internal pointers are expressed as relative offsets instead of absolute addresses, so copying the whole Blob is as simple as copying every byte.
- Although they are stored independently from entities, Blob assets may be _referenced_ from entity components.
- Because they're immutable, Blob assets are inherently safe to access from multiple threads.

| &#x1F4DD; NOTE |
| :- |
| The name Blob "asset" is a bit misleading: a Blob asset is a piece of data in memory, not a project asset file! However, Blob assets are efficiently and easily serializable into files on disk, so it makes some sense to call them "assets". |

To create a Blob asset:

1. Create a [BlobBuilder](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.html).
1. Call the builder's [`ConstructRoot<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.ConstructRoot.html) to set the Blob's 'root' (a struct of type T).
1. Call the builder's [`Allocate<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.Allocate.html), [`Construct<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.Construct.html) and [`SetPointer<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.SetPointer.html) methods to fill in the rest of the Blob data (including [`BlobArray`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobArray-1.html)'s, [`BlobString`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobString.html)'s, and [`BlobPtr`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobPtr-1.html)).
1. Call the builder's [CreateBlobAssetReference](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.CreateBlobAssetReference.html), which copies all the data in the builder to create the actual Blob asset and returns a [BlobAssetReference](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobAssetReference-1.html).
1. Dispose the `BlobBuilder`.

When a Blob asset is no longer needed, it should be disposed by calling `Dispose` on the `BlobAssetReference`.

Blob assets referenced in a baked entity scene are serialized and loaded along with the scene. These Blob assets should *not* be manually disposed: they will be automatically disposed along with the scene.

| &#x26A0; IMPORTANT |
| :- |
| All parts of a blob asset that contain internal pointers must always be accessed by reference. For example, the offset values in a BlobString struct are only correct relative to where the BlobString struct is stored inside the Blob; the offsets are not correct relative to *copies* of the struct. |

<br>

# Version numbers

A world, its systems, and its chunks maintain several **'version numbers'** (numbers which are incremented by certain operations). By comparing version numbers, you can determine if certain data might have changed.

All version numbers are 32-bit signed integers, so when incremented, they eventually wrap around. The proper way to compare version numbers then relies upon subtle quirks of how C# defines signed integer overflow:

```csharp
// true if VersionB is more recent than VersionA
// false if VersionB is equal or less than VersionA
bool changed = (VersionB - VersionA) > 0;
```

|**Version number**|**Description**|
|---|---|
| [`World.Version`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.World.Version.html) | Increased every time the world adds or removes a system or system group. |
| [`EntityManager.GlobalSystemVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.GlobalSystemVersion.html) | Increased before every system update in the world. |
| [`SystemState.LastSystemVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.SystemState.LastSystemVersion.html) | Assigned the value of the `GlobalSystemVersion` immediately after each time the system updates. |
| [`EntityManager.EntityOrderVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.EntityOrderVersion.html) | Increased every time a structural change is made in the world. |

Each component type has its own version number, which is incremented by any operation that gets write access to the component type. This number can be retrieved by calling the method [`EntityManager.GetComponentOrderVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetComponentOrderVersion.html).

Each shared component *value* also has a version number that is increased every time a structural change affects a chunk having the value.

A chunk stores a version number for each component type in the chunk. When a component type in a chunk is accessed for writing, its version number is assigned the value of `EntityManager.GlobalSystemVersion`, regardless of whether any component values are actually modified. These chunk version numbers can be retrieved by calling the [`ArchetypeChunk.GetChangeVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ArchetypeChunk.GetChangeVersion.html) method.

A chunk also stores a version number for each component type which is assigned the value of `EntityManager.GlobalSystemVersion` every time a structural change affects the chunk. These chunk version numbers can be retrieved by calling the [`ArchetypeChunk.GetOrderVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ArchetypeChunk.GetOrderVersion.html) method.

<br>


## Links discovered
- [`IEnableableComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IEnableableComponent.html)
- [`ToArchetypeChunkArray()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityQuery.ToArchetypeChunkArray.html)
- [`EntityManager`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.html)
- [`ComponentLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.html)
- [`BufferLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.BufferLookup-1.html)
- [`EnabledRefRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EnabledRefRW-1.html)
- [`ArchetypeChunk`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ArchetypeChunk.html)
- [`IsComponentEnabled<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.IsComponentEnabled.html)
- [`SetComponentEnabled<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetComponentEnabled.html)
- [`ChunkEntityEnumerator`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ChunkEntityEnumerator.html)
- [structural change](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html)
- [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddComponent.html)
- [`AddSharedComponent()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddSharedComponent.html)
- [`AddSharedComponentManaged()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddSharedComponentManaged.html)
- [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.RemoveComponent.html)
- [`HasComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.HasComponent.html)
- [`GetSharedComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetSharedComponent.html)
- [`SetSharedComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetSharedComponent.html)
- [`GetSharedComponentManaged<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetSharedComponentManaged.html)
- [`SetSharedComponentManaged<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetSharedComponentManaged.html)
- [`IEquatable<T>`](https://docs.microsoft.com/en-us/dotnet/api/system.iequatable-1.equals)
- [`AddChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.AddChunkComponentData.html)
- [`RemoveChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.RemoveChunkComponentData.html)
- [`HasChunkComponent<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.HasChunkComponent.html)
- [`GetChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.GetChunkComponentData.html)
- [`SetChunkComponentData<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.SetChunkComponentData.html)
- [BlobBuilder](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.html)
- [`ConstructRoot<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.ConstructRoot.html)
- [`Allocate<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.Allocate.html)
- [`Construct<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.Construct.html)
- [`SetPointer<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.SetPointer.html)
- [`BlobArray`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobArray-1.html)
- [`BlobString`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobString.html)
- [`BlobPtr`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobPtr-1.html)
- [CreateBlobAssetReference](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobBuilder.CreateBlobAssetReference.html)
- [BlobAssetReference](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.BlobAssetReference-1.html)
- [`World.Version`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.World.Version.html)
- [`EntityManager.GlobalSystemVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.GlobalSystemVersion.html)
- [`SystemState.LastSystemVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.SystemState.LastSystemVersion.html)
- [`EntityManager.EntityOrderVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/api/Unity.Entities.EntityManager.EntityOrderVersion.html)
- [`EntityManager.GetComponentOrderVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetComponentOrderVersion.html)
- [`ArchetypeChunk.GetChangeVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ArchetypeChunk.GetChangeVersion.html)
- [`ArchetypeChunk.GetOrderVersion`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ArchetypeChunk.GetOrderVersion.html)

--- EntitiesSamples/Docs/baking.md ---
# Baking and entity scenes

&#x1F579;  *[See examples of baking and authoring components](../Assets/ExampleCode/Baking.cs).*

**Baking** is a build-time process that transforms **sub scenes** into **entity scenes** using **bakers** and **baking systems**:

- A **sub scene** is a Unity scene asset that's embedded in another scene by the [SubScene](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SubScene.html) MonoBehaviour.
- An **entity scene** is a serialized set of entities and components that can be loaded at runtime.
- A **baker** is a class extending [`Baker<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.Baker-1.html), where T is a MonoBehaviour. A MonoBehaviour with a Baker is called an **authoring component**.
- A **baking system** is a normal system marked with the `[WorldSystemFilter(WorldSystemFilterFlags.BakingSystem)]` attribute. (Baking systems are fully optional and generally only required for advanced use cases.)

Baking a sub scene is done in a few main steps:

1. For each GameObject of the sub scene, a corresponding entity is created.
2. The baker of each authoring component in the sub scene is executed. Each baker can read the authoring component and add components to the corresponding entity.
2. The baking systems execute. Each system can read and modify the baked entities in any way: set components, add components, remove components, create additional entities, or destroy entities. Unlike bakers, baking systems should not access the original GameObjects of the sub scene.

When modified, a sub scene is re-baked:

1. Only the bakers that read the modified authoring components are re-executed.
1. The baking systems are always re-executed in full.
1. The live entities in Edit mode or Play mode are updated to match the results of baking. (This is possible because baking tracks the correspondence of baked entities to live entities.)

<br>

## Creating and editing sub scenes

A GameObject with the `SubScene` MonoBehaviour has a checkbox that opens and closes the sub scene for editing. While a sub scene is open, its GameObjects are loaded and take up resources in the Unity editor, so you may want to close sub scenes that you're not currently editing.

![](./images/open_subscene.png)

The convenient way to create a new sub scene is to right click within the Hierarchy window and select `New Subscene > Empty Scene...`. This creates both a new scene file and a GameObject with a `SubScene` component that references the new scene file:

![](images/create_subscene.png)

<br>

## Accessing data in a baker

Incremental baking requires bakers to track all the data they read. The fields of a baker's authoring component are automatically tracked, but other data read by a baker must be added to its list of dependencies through the `Baker` methods:

|**Baker method**|**Description**|
|---|---|
| [`GetComponent<T>()`]() | Accesses any component of any GameObject in the Sub Scene. |
| [`DependsOn()`]() | Tracks an asset for this `Baker`. |
| [`GetEntity()`]() | Returns the id of an entity baked in the sub scene or baked from a prefab. (The entity will not yet have been fully baked, so you should not attempt to read or modify the components of the entity.) |

<br>

## Loading and unloading entity scenes

For streaming purposes, the entities of a scene are split into **sections** identified by index number. Which section an entity belongs to is designated by its [`SceneSection`]() shared component. By default, an entity belongs to section 0, but this can be changed by setting `SceneSection` during baking.

| &#x26A0; IMPORTANT |
| :- |
| During baking, entities in a sub scene can only reference other entities of the same section or section 0 (which is a special case because section 0 is always loaded before the other sections and only *un*loaded when the scene itself is unloaded). |

When a scene is loaded, it is represented by an entity with metadata about the scene, and its sections are also each represented by an entity. An individual section is loaded and unloaded by manipulating its entity's [`RequestSceneLoaded`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html) component: the `SceneSectionStreamingSystem` in the `SceneSystemGroup` responds when this component changes.

The [`SceneSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SceneSystem.html) contains static methods for loading and unloading entity scenes:

|**`SceneSystem` method**|**Description**|
|---|---|
| [`LoadSceneAsync()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISharedComponent.html) | Initiates loading of a scene. Returns an entity that represents the loaded scene. |
| [`LoadPrefabAsync()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)  | Initiates loading of a prefab. Returns an entity that references the loaded prefab. |
| [`UnloadScene()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)  | Destroys all entities of a loaded scene. |
| [`IsSceneLoaded()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IComponentData.html) | Returns true if a scene is loaded. |
| [`IsSectionLoaded()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IBufferElementData.html) | Returns true if a section is loaded. |
| [`GetSceneGUID()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)  | Returns the GUID representing a scene asset (specified by its file path). |
| [`GetScenePath()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)  | Returns the path of a scene asset (specified by its GUID). |
| [`GetSceneEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)  | Returns the entity representing a scene (specified by its GUID). |

| &#x26A0; IMPORTANT |
| :- |
| Entity scene and section loading is always asynchronous, and there is no guarantee of how long it will take for the data to be loaded after the request. In most cases, code should check for the presence or absence of specific data loaded from scenes rather than check the loading status of the scenes themselves. This approach avoids tethering code to particular scenes: if the data is moved to a different scene, downloaded from the network, or procedurally generated, the code will still work without modification. |

<br>
















## Links discovered
- [See examples of baking and authoring components](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/ExampleCode/Baking.cs)
- [SubScene](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SubScene.html)
- [`Baker<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.Baker-1.html)
- [`RequestSceneLoaded`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)
- [`SceneSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SceneSystem.html)
- [`LoadSceneAsync()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISharedComponent.html)
- [`LoadPrefabAsync()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)
- [`UnloadScene()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)
- [`IsSceneLoaded()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IComponentData.html)
- [`IsSectionLoaded()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IBufferElementData.html)
- [`GetSceneGUID()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)
- [`GetScenePath()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)
- [`GetSceneEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)

--- EntitiesSamples/Docs/entities-components.md ---
# Entities and components

In this page: 

- [Entities and components](#entities-and-components)
- [Archetypes and chunks](#archetypes)
- [Queries](#queries)
- [`IComponentData` components](#icomponentdata)
- [DynamicBuffer components](#dynamicbuffer-components)
- [Aspects](#aspects)

<br/>


# Entities and components

An **entity** is a lightweight, unmanaged alternative to a GameObject. Entities resemble GameObjects in many ways and can serve a similar role, but they have key differences:

- Unlike a GameObject, an entity is not a managed object but simply a unique identifier number.
- The **components** associated with an entity are usually struct values.
- A single entity can only have one component of any given type. For example, a single entity cannot have two components both of type *Foo*.
- Although entity component types can be given methods, doing so is generally discouraged.
- An entity has no built-in concept of parenting. Instead, the standard [`Parent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.Parent.html) component contains a reference to another entity, allowing formation of entity transform hierarchies.

Entity component types are defined by implementing these interfaces:

|**Kind of component**|**Description**|
|---|---|
| [`IComponentData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IComponentData.html) | Defines the most common, basic kind of component type.|
| [`IBufferElementData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IBufferElementData.html) | Defines a dynamic buffer (growable array) component type.|
| [`ISharedComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISharedComponent.html) | Defines a shared component type, whose values can be shared by multiple entities.|
| [`ICleanupComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)  | Defines a cleanup component type, which facilitates proper setup and teardown of resources.|

There are also two additional interfaces ([`ICleanupSharedComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupSharedComponent.html) and [`ICleanupBufferElementData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupBufferElementData.html)) and [chunk components](additional-entities-features.md#chunk-components) (which are defined with `IComponentData` but added and removed from entities by a different set of methods).

A component type defined with `IComponentData` or `IBufferElementData` can be made **'enableable'** by also implementing [`IEnableableComponent`](additional-entities-features.md#enableable-components).

<br>

# Worlds and EntityManagers

A [`World`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.html) is a collection of entities. An entity's ID number is only unique within its own world, *i.e.* the entity with a particular ID in one world is entirely unrelated to an entity with the same ID in a different world.

A world also owns a set of [systems](concepts-systems.md), which are units of code that run on the main thread, usually once per frame. The entities of a world are normally only accessed by the world's systems and the jobs scheduled by those systems, but this is not an enforced restriction.

The entities in a world are created, destroyed, and modified through the world's [`EntityManager`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.html). Key `EntityManager` methods include:

|**Method**|**Description**|
|---|---|
| [`CreateEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.CreateEntity.html) | Creates a new entity. |
| [`Instantiate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.Instantiate.html) | Creates a new entity with a copy of all the components of an existing entity. |
| [`DestroyEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.DestroyEntity.html) | Destroys an existing entity. |
| [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddComponent.html) | Adds a component of type T to an existing entity. |
| [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.RemoveComponent.html) | Removes a component of type T from an existing entity. |
| [`HasComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.HasComponent.html) | Returns true if an entity currently has a component of type T. |
| [`GetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetComponent.html) | Retrieves the value of an entity's component of type T. |
| [`SetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetComponent.html) | Overwrites the value of an entity's component of type T. |

| &#x1F4DD; NOTE |
| :- |
| `CreateEntity`, `Instantiate`, `DestroyEntity`, `AddComponent`, and `RemoveComponent` are [structural change](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html) operations. |

<br>

#  Archetypes

An **archetype** represents a particular combination of component types in a world: all of the entities in a world with a certain set of component types are stored together in the same archetype. For example:

 - All of a world's entities with component types *A*, *B*, and *C*, are stored together in one archetype,
 - ...the entities with just component types *A* and *B* (but not *C*) are stored together in a second archetype,
 - ...and the entities with component types *B* and *D* are stored in a third archetype.

Effectively, adding or removing components of an entity changes which archetype the entity belongs to, necessitating the `EntityManager` to actually move the entity and its components from its old archetype to its new one.

When you add or remove components from an entity, the  `EntityManager` moves the entity to the appropriate archetype. For example, if an entity has component types *X*, *Y*, and *Z* and you remove its *Y* component, the `EntityManager` moves the entity to the archetype that has component types *X* and *Z*. If no such archetype already exists in the world, the `EntityManager` creates it.

| &#x26A0; IMPORTANT |
| :- |
| Moving too many entities between archetypes too frequently can add up to [significant costs](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html). |

Archetypes are created by the `EntityManager` as you create and modify entities, so you don't have to worry about creating archetypes explicitly. Even if all the entities are removed from an archetype, the archetype is only destroyed when its world is destroyed.

<br>

# Chunks

The entities of an archetype are stored in 16KiB blocks of memory belonging to the archetype called *chunks*. Each chunk stores up to 128 entities (with the precise quantity depending upon the number and size of the component types in the archetype).

The entity ID's and components of each type are stored in their own separate array within the chunk. For example, in the archetype for entities which have component types *A* and *B*, each chunk will store three arrays: 

- one array for the entity ID's
- ...a second array for the *A* components
- ...and a third array for the *B* components.

The ID and components of the first entity in the chunk are stored at index 0 of these arrays, the second entity at index 1, the third entity at index 2, and so forth.

A chunk's arrays are always kept tightly packed:

- When a new entity is added to the chunk, it is stored in the first free index of the arrays.
- When an entity is removed from the chunk (which happens either because the entity is being destroyed or because it's being moved to another archetype), the last entity in the chunk is moved to fill in the gap.

The creation and destruction of chunks is handled by the `EntityManager`:

- The `EntityManager` creates a new chunk only when an entity is added to an archetype whose already existing chunks are all full.
- The `EntityManager` only destroys a chunk when the chunk's last entity is removed.

Any `EntityManager` operation that adds, removes, or moves entities within a chunk is called a *structural change*. Such changes should generally be made only on the main thread, not in jobs (though an [`EntityCommandBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.html) can be used as a work around).

<br>

# Queries

An [`EntityQuery`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityQuery.html) efficiently finds all entities having a specified set of component types. For example, if a query looks for all entities having component types *A* and *B*, then the query will gather the chunks of all archetypes which include *A* and *B*, regardless of whatever other component types those archetypes might have. Such a query would match the entities with component types *A* and *B*, but the query would also match, say, the entities with component types  *A*, *B*, and *C*.

| &#x1F4DD; NOTE |
| :- |
| The archetypes matching a query will get cached until the next time a new archetype is added to the world. Because the set of existing archetypes in a world tends to stabilize early in the lifetime of a program, this caching usually helps make the queries much cheaper. |

A query can also specify component types to *exclude* from the matching archetypes. For example, if a query looks for all entities having component types *A* and *B* but *not* having component type *C*, the query would match entities with component types *A* and *B*, but the query would *not* match entities with component types *A*, *B*, and *C*.

<br>

# Entity ID's

An entity ID is represented by the struct [`Entity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.Entity.html).

In order to look up entities by ID, the world’s `EntityManager` maintains an array of entity metadata. Each entity ID has an index value denoting a slot in this metadata array, and the slot stores a pointer to the chunk where that entity is stored, as well as the index of the entity within the chunk. When no entity exists for a particular index, the chunk pointer at that index is null. Here, for example, no entities with indexes 1, 2, and 5 currently exist, so the chunk pointers in those slots are all null:

![entity metadata](./images/entities_metadata.png)

In order to allow entity indexes to be reused after an entity is destroyed, each entity ID also contains a *version number*. When an entity is destroyed, the version number stored at its index is incremented, and so if an ID’s version number doesn’t match the one currently stored, then the ID must refer to an entity that has already been destroyed or perhaps never existed.

<br>

# `IComponentData`

The most common, basic kind of component type is defined as a struct implementing [`IComponentData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IComponentData.html).

An `IComponentData` struct is expected to be unmanaged, so it cannot contain any managed field types. Specifically, the allowed field types are:

* [Blittable types](https://docs.microsoft.com/en-us/dotnet/framework/interop/blittable-and-non-blittable-types)
* `bool`
* `char`
* `BlobAssetReference<T>`, a reference to a Blob data structure
* `Collections.FixedString`, a fixed-sized character buffer
* `Collections.FixedList`
* [Fixed array](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/fixed-statement) (only allowed in an [unsafe](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/unsafe) context)
* Struct types that conform to these same restrictions.

An `IComponentData` struct with no fields is called a ***tag component***. Although tag components store no data, they can still be added and removed from entities like any other component type, which is useful for queries. For example, if all of our entities representing monsters have a *Monster* tag component, a query for the *Monster* component type will match all the monster entities.

<br>

## Managed `IComponentData` components

A class implementing `IComponentData` is a *managed* component type. Unlike the unmanaged `IComponentData` structs, these managed components can store any managed objects.

In general, managed component types should be used only when really needed because, compared to *unmanaged* components, they incur some heavy costs:

- Like all managed objects, managed components *cannot* be used in [Burst](https://docs.unity3d.com/Packages/com.unity.burst@latest)-compiled code.
- Managed objects cannot normally be used safely in [jobs](https://docs.unity3d.com/Manual/JobSystem.html).
- Managed components are not stored directly in the chunks: instead, all managed components of a world are all stored in one big array while the chunks merely store indexes of this array.
- Like all managed objects, creating managed components incurs garbage collection overhead.

If a managed component type implements `ICloneable`, then any resources it contains can be properly copied when an instance is itself copied. Likewise, if a managed component type implements `IDisposable`, then it can properly dispose any resources it may contain when an instance is removed from an entity or the entity is destroyed.

<br>

# DynamicBuffer components

A [`DynamicBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.html) is a component type which is a resizable array. To define a `DynamicBuffer` component type, create a struct that implements the [`IBufferElementData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IBufferElementData.html) interface.

The buffer of each entity stores a `Length`, a `Capacity`, and a pointer:

* The `Length` is the number of elements in the buffer. It starts at `0` and increments when you append a value to the buffer.
* The `Capacity` is the amount of storage in the buffer. It starts out matching the internal buffer capacity (which [defaults](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.TypeManager.DefaultBufferCapacityNumerator.html) to `128 / sizeof(Waypoint)` but can be specified by the [`InternalBufferCapacity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.InternalBufferCapacityAttribute.html) attribute on the `IBufferElementData` struct). Setting `Capacity` resizes the buffer.
* The pointer indicates the location of the buffer's contents. Initially it is `null`, signifying that the contents are stored directly in the chunk. If the capacity is set to exceed the internal buffer capacity, a new larger array is allocated outside of the chunk, the contents are copied to this external array, and the pointer is set to point to this new array. If the length of the buffer ever exceeds the capacity of the external array, then the contents of the buffer are copied to another new, larger array outside the chunk, and the old array is disposed. The buffer can also be shrunk.

The internal buffer capacity and the external capacity (if present) are deallocated when the `EntityManager` destroys the chunk itself. 

| &#x1F4DD; NOTE |
| :- |
|When a dynamic buffer is stored outside the chunk, the internal capacity is effectively wasted, and accessing the buffer contents requires following an extra pointer. These costs can be avoided if you ensure the internal capacity is never exceeded. Of course, in many cases, staying within this limit may require an excessively large internal capacity. Another option is to set the internal capacity to 0, which means that any non-empty buffer will always be stored outside the chunk. This incurs the cost of always following a pointer when accessing the buffer, but it avoids wasting unused space in the chunk.|


The `EntityManager` has these key methods for using dynamic buffers:

|**Method**|**Description**|
|----|---|
| [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.AddComponent.html) | Adds a component of type T to an entity, where T can be a dynamic buffer component type. |
| [`AddBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.AddBuffer.html) | Adds a dynamic buffer component of type T to an entity; returns the new buffer as a `DynamicBuffer<T>`. |
| [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.RemoveComponent.html) | Removes the component of type T from an entity, where T can be a dynamic buffer component type. |
| [`HasBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.HasBuffer.html) | Returns true if an entity currently has a dynamic buffer component of type T. |
| [`GetBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.GetBuffer.html) | Returns an entity's dynamic buffer component of type T as a `DynamicBuffer<T>`. |

A `DynamicBuffer<T>` represents the dynamic buffer component of type T of an individual entity. Its key properties and methods include:

|**Property or Method**|**Description**|
|----|---|
| [`Length`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Length.html) | Gets or sets the length of the buffer. |
| [`Capacity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Capacity.html) | Gets or sets the capacity of the buffer. |
| [`Item[Int32]`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Item.html) | Gets or sets the element at a specified index. |
| [`Add()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Add.html) | Adds an element to the end of the buffer, resizing it if necessary. |
| [`Insert()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Insert.html) | Inserts an element at a specified index, resizing if necessary. |
| [`RemoveAt()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.RemoveAt.html) | Removes the element at a specified index. |

To enforce job safety, a `DynamicBuffer<T>` value holds a safety handle. The contents of a `DynamicBuffer` cannot be accessed while any scheduled jobs that access the same buffer component type remain uncompleted. If, however, the uncompleted jobs all just have read-only access of the buffer component type, then the main thread is allowed to read the buffer.

Any structural change operation will invalidate the `DynamicBuffer` safety handles, meaning all of the methods will subsequently throw an exception if called. To use a buffer again after a structural change, it must be re-retrieved.

A `DynamicBuffer<T>` can be '[reinterpreted](https://docs.unity3d.com/Packages/com.unity.collections@2.1/manual/allocation.html#array-reinterpretation)'. The target reinterpretation element type must have the same size as T.


<br/>

# Aspects

An aspect is an object-like wrapper over a subset of an entity's components. Aspects can be useful for simplifying queries and component-related code. The [`TransformAspect`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.TransformAspect.html), for example, groups together the standard transform components ([`LocalTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalTransform.html), [`ParentTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.ParentTransform.html), and [`WorldTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.WorldTransform.html)).

Including an aspect in a query is the same as including the components wrapped by the aspect, *e.g.* a query that includes `TransformAspect` includes the standard transform matrix components.

An aspect is defined as a readonly partial struct implementing [`IAspect`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IAspect.html). The struct can contain fields of these types:

|**Field type**|**Description**|
|----|---|
| `Entity` | The wrapped entity's entity ID. |
|[`RefRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.RefRW-1.html) or [`RefRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.RefRO-1.html)|A reference to the wrapped entity's T component.|
|[`EnabledRefRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EnabledRefRW-1.html) and [`EnabledRefRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EnabledRefRO-1.html)| A reference to the enabled state of the wrapped entity's T component.|
|`DynamicBuffer<T>`|The wrapped entity's dynamic buffer T component.|
|Another aspect type| The containing aspect will encompass all the fields of the 'embedded' aspect. |

These `EntityManager` methods create instances of an aspect:

|**Method**|**Description**|
|----|---|
| [`GetAspect<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetAspect.html) | Returns an aspect of type T wrapping an entity. |
| [`GetAspectRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetAspectRO.html) | Returns a readonly aspect of type T wrapping an entity. A read-only aspect throws an exception if you use any method or property that attempts to modify the underlying components. |

Aspect instances can also be retrieved by [`SystemAPI.GetAspectRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.GetAspectRW.html) or [`SystemAPI.GetAspectRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.GetAspectRO.html) and accessed in an [`IJobEntity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IJobEntity.html) or a [`SystemAPI.Query`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.Query.html) loop.

| &#x26A0; IMPORTANT |
| :- |
| You should generally get aspect instances *via* `SystemAPI` rather than the `EntityManager`: unlike the `EntityManager` methods, the `SystemAPI` methods register the underlying component types of the aspect with the system, which is [necessary for the systems to properly schedule jobs with every dependency they need](./entities-jobs.md#systemstatedependency). |

<br>



## Links discovered
- [`Parent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.Parent.html)
- [`IComponentData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IComponentData.html)
- [`IBufferElementData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IBufferElementData.html)
- [`ISharedComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISharedComponent.html)
- [`ICleanupComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupComponent.html)
- [`ICleanupSharedComponent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupSharedComponent.html)
- [`ICleanupBufferElementData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICleanupBufferElementData.html)
- [chunk components](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/additional-entities-features.md#chunk-components)
- [`IEnableableComponent`](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/additional-entities-features.md#enableable-components)
- [`World`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.html)
- [systems](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/concepts-systems.md)
- [`EntityManager`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.html)
- [`CreateEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.CreateEntity.html)
- [`Instantiate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.Instantiate.html)
- [`DestroyEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.DestroyEntity.html)
- [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.AddComponent.html)
- [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.RemoveComponent.html)
- [`HasComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.HasComponent.html)
- [`GetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetComponent.html)
- [`SetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.SetComponent.html)
- [structural change](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html)
- [significant costs](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html)
- [`EntityCommandBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.html)
- [`EntityQuery`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityQuery.html)
- [`Entity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.Entity.html)
- [entity metadata](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/images/entities_metadata.png)
- [Blittable types](https://docs.microsoft.com/en-us/dotnet/framework/interop/blittable-and-non-blittable-types)
- [Fixed array](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/fixed-statement)
- [unsafe](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/unsafe)
- [Burst](https://docs.unity3d.com/Packages/com.unity.burst@latest)
- [jobs](https://docs.unity3d.com/Manual/JobSystem.html)
- [`DynamicBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.html)
- [defaults](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.TypeManager.DefaultBufferCapacityNumerator.html)
- [`InternalBufferCapacity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.InternalBufferCapacityAttribute.html)
- [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.AddComponent.html)
- [`AddBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.AddBuffer.html)
- [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.RemoveComponent.html)
- [`HasBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.HasBuffer.html)
- [`GetBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.GetBuffer.html)
- [`Length`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Length.html)
- [`Capacity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Capacity.html)
- [`Add()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Add.html)
- [`Insert()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.Insert.html)
- [`RemoveAt()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.RemoveAt.html)
- [reinterpreted](https://docs.unity3d.com/Packages/com.unity.collections@2.1/manual/allocation.html#array-reinterpretation)
- [`TransformAspect`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.TransformAspect.html)
- [`LocalTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalTransform.html)
- [`ParentTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.ParentTransform.html)
- [`WorldTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.WorldTransform.html)
- [`IAspect`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IAspect.html)
- [`RefRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.RefRW-1.html)
- [`RefRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.RefRO-1.html)
- [`EnabledRefRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EnabledRefRW-1.html)
- [`EnabledRefRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EnabledRefRO-1.html)
- [`GetAspect<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetAspect.html)
- [`GetAspectRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityManager.GetAspectRO.html)
- [`SystemAPI.GetAspectRW<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.GetAspectRW.html)
- [`SystemAPI.GetAspectRO<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.GetAspectRO.html)
- [`IJobEntity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IJobEntity.html)
- [`SystemAPI.Query`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.Query.html)
- [necessary for the systems to properly schedule jobs with every dependency they need](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/entities-jobs.md#systemstatedependency)

--- EntitiesSamples/Docs/entities-jobs.md ---
# Accessing entities in jobs

&#x1F579;  *[See example jobs](../Assets/ExampleCode/Jobs.cs).*

You can offload the processing of entity data to worker threads with the [C# Job System](https://docs.unity3d.com/Manual/JobSystem.html). The Entities package has two interfaces for defining jobs that access entities:

- [`IJobChunk`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IJobChunk.html), whose `Execute()` method is called once for each individual chunk matching the query.
- [`IJobEntity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IJobEntity.html), whose `Execute()` method is called once for each entity entity matching the query. 

Although `IJobEntity` is generally more convenient to write and use, `IJobChunk` provides more precise control. In most cases, their performance is identical for equivalent work.

| &#x1F4DD; NOTE |
| :- |
| `IJobEntity` is not actually a 'real' job type: source generation extends an `IJobEntity` struct with an implementation of `IJobChunk`. So in fact, a `IJobEntity` is ultimately scheduled as an `IJobChunk`. |

It is not safe to make [structural changes](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html) in a job, so normally you should only make structural changes on the main thread. To work around this restriction, a job can record structural change commands in an [`EntityCommandBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.html), and then these commands can be played back later on the main thread.

To split the work of an `IJobChunk` or `IJobEntity` across multiple threads, schedule the job by calling `ScheduleParallel()` instead of `Schedule()`. When you use `ScheduleParallel()`, the chunks matching the query will be split into separate batches, and these batches will be farmed out to the worker threads.

<br>

## Sync points

A **'synchronization point'** operation is an operation that cannot safely be performed concurrently with the scheduled jobs which may access entities and components, and so these operations must first complete the jobs. For example, calling `EntityManager.CreateEntity()` will first complete all currently scheduled jobs which access any entities and components. Likewise, the `EntityQuery` methods `ToComponentDataArray<T>()`, `ToEntityArray()`, and `ToArchetypeChunkArray()` must first complete any currently scheduled jobs which access any of the same components as the query.

In many cases, these synchronization points will also **'invalidate'** existing instances of a few types, namely [`DynamicBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.html) and [`ComponentLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.html). When an instance is invalidated, calling its methods will throw safety check exceptions. If an instance you need to still use gets invalidated, you must retrieve a new instance to replace it.

<br>

## Component safety handles

Just like the native collections, each component type has an associated job safety handle for each world. The implication is that, for any two jobs which access the same component type in a world, the safety checks won't let the jobs be scheduled concurrently. For example, when we try scheduling a job that accesses component type *Foo*, the safety checks will throw an exception if an already scheduled job also accesses component type *Foo*. To avoid this exception, the already scheduled job must be completed before scheduling the new job, or the new job must depend upon the already scheduled job. 

| &#x1F4DD; NOTE |
| :- |
| It's safe for two jobs to be scheduled concurrently if they both have *read-only* access of the same component type. For any component type in your job that is not ever written, be sure to inform the safety checks by marking the component type handle with the [`ReadOnly`](https://docs.unity3d.com/ScriptReference/Unity.Collections.ReadOnlyAttribute.html) attribute. |

<br>

## SystemState.Dependency

When we schedule a job in a system, we want it to depend upon any currently scheduled jobs that might conflict with the new job, even if those jobs were scheduled in other systems. To arrange this, we use the job handle property `Dependency` of [`SystemState`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.html).

Immediately before a system updates:

1. ...the system's `Dependency` property is completed
2. ...and then assigned a combination of the `Dependency` handles of all other systems which access any of the same component types as this system. For example, for a system which accesses the *Foo* and *Bar* component type, the `Dependency` of all other systems in the world which also access either *Foo* or *Bar* will be included in the combination job handle.

You're then expected to do two things in every system:

1. All jobs scheduled in a system update should (directly or indirectly) depend upon the job handle that was assigned to `Dependency` right before the update.
1. Before a system update returns, the `Dependency` property should be assigned a handle that includes all the jobs scheduled in that update.

As long as you follow these two rules, every job scheduled in a system update will depend upon all jobs scheduled in other systems which might access any of the same component types.

| &#x26A0; IMPORTANT |
| :- |
| Systems do not track which [native collections]() they use, so the `Dependency` property only accounts for component types, not native collections. Consequently, if two systems both schedule jobs which use the same native collection, their `Dependency` properties will not necessarily be combined into the job handle assigned to the `Dependency` property of the other, and so the jobs of the different systems will not depend upon each other as they should. In these scenarios, you *could* manually share job handles between the systems, but the better solution is to store the native collection in a component: if both systems access the collection through the same component type, the jobs scheduled in both systems should then depend upon each other (as long as you follow the `Dependency` rules described above). |

<br>

## ComponentLookup\<T\>

We can randomly access the components of individual entities through an `EntityManager`, but we generally shouldn't use an `EntityManager` in jobs. Instead, we should use a type called [`ComponentLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.html), which can get and set component values by entity ID. We can also get dynamic buffers by entity ID using [`BufferLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.BufferLookup-1.html).

| &#x26A0; IMPORTANT |
| :- |
| Keep in mind that looking up an entity by ID tends to incur the performance cost of cache misses, so it's generally a good idea to avoid lookups when you can. There are though, of course, many problems which require random lookups to solve, so by no means can random lookups be avoided entirely. Just avoid using them carelessly! |


The `ComponentLookup<T>` and `BufferLookup<T>` method [`HasComponent()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.HasComponent.html) returns true if the specified entity has the component type T. The [`TryGetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.TryGetComponent.html) and [`TryGetBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.BufferLookup-1.TryGetBuffer.html) methods do the same but also outputs the component value or buffer if it exists.

To test whether an entity simply exists, we can call [`Exists()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityStorageInfoLookup.Exists.html) of an [`EntityStorageInfoLookup`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityStorageInfoLookup.html). Indexing an `EntityStorageInfoLookup` returns an [`EntityStorageInfo`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityStorageInfo.html) struct, which includes a reference to the entity's chunk and its index within the chunk.


If a job needs to only *read* the components accessed through a `ComponentLookup<T>`, the `ComponentLookup<T>` field should be marked with the `ReadOnly` attribute to inform the job safety checks. The same is true for a `BufferLookup<T>`.

In a parallel-scheduled job, getting component values from a `ComponentLookup<T>` requires the field to be marked with the `ReadOnly` attribute. The safety checks do not allow setting component values through a `ComponentLookup<T>` in a parallel-scheduled job because safety cannot be guaranteed. However, you can fully *disable* the safety checks on the `ComponentLookup<T>` by marking it with the [`NativeDisableParallelForRestriction`](https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeDisableParallelForRestrictionAttribute.html) attribute. The same is true for a `BufferLookup<T>`. Just make sure that your code sets component values in a thread-safe manner!












## Links discovered
- [See example jobs](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/ExampleCode/Jobs.cs)
- [C# Job System](https://docs.unity3d.com/Manual/JobSystem.html)
- [`IJobChunk`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IJobChunk.html)
- [`IJobEntity`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.IJobEntity.html)
- [structural changes](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html)
- [`EntityCommandBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.html)
- [`DynamicBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DynamicBuffer-1.html)
- [`ComponentLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.html)
- [`ReadOnly`](https://docs.unity3d.com/ScriptReference/Unity.Collections.ReadOnlyAttribute.html)
- [`SystemState`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.html)
- [`BufferLookup<T>`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.BufferLookup-1.html)
- [`HasComponent()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.HasComponent.html)
- [`TryGetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentLookup-1.TryGetComponent.html)
- [`TryGetBuffer<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.BufferLookup-1.TryGetBuffer.html)
- [`Exists()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityStorageInfoLookup.Exists.html)
- [`EntityStorageInfoLookup`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityStorageInfoLookup.html)
- [`EntityStorageInfo`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityStorageInfo.html)
- [`NativeDisableParallelForRestriction`](https://docs.unity3d.com/ScriptReference/Unity.Collections.NativeDisableParallelForRestrictionAttribute.html)

--- EntitiesSamples/Docs/entity-command-buffers.md ---
# Entity command buffers

We can defer changes to entities by recording commands into an [`EntityCommandBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.html). The recorded commands are executed later when we call [`Playback()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.Playback.html) on the main thread.

Deferring changes with an `EntityCommandBuffer` is particularly useful in jobs because jobs generally shouldn't directly make [structural changes](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html) (*i.e.* create entities, destroy entities, add components, or remove components). Instead, jobs should record commands to be played back on the main thread after the job has been completed. `EntityCommandBuffer`'s can also help us avoid unnecessary [sync points](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html#sync-points) by deferring structural changes to a few consolidated points of the frame rather than scattered across the frame.

An `EntityCommandBuffer` has many (but not all) of the same methods as `EntityManager`. The methods include:

|**`EntityCommandBuffer` method**|**Description**|
|---|---|
| [`CreateEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.CreateEntity.html) | Records a command to create a new entity. Returns a [temporary](#temporary-entities) entity ID. |
| [`DestroyEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.DestroyEntity.html) | Records a command to destroy an entity. |
| [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.AddComponent.html) | Records a command to add a component of type T to an entity. |
| [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.RemoveComponent.html) | Records a command to temove a component of type T from an entity. |
| [`SetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.SetComponent.html) | Records a command to set a component value of type T. |
| [`AppendToBuffer()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.AppendToBuffer.html) | Records a command that will append an individual value to the end of the entity's existing buffer. |
| [`AddBuffer()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.AddBuffer.html) | Returns a `DynamicBuffer` which is stored in the recorded command, and the contents of this buffer will be copied to the entity's actual buffer when it is created in playback. Effectively, writing to the returned buffer allows you to set the initial contents of the component. |
| [`SetBuffer()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.SetBuffer.html)  | Like `AddBuffer()`, but it assumes the entity already has a buffer of the component type. In playback, the entity's already existing buffer content is overwritten by the contents of the returned buffer. |

| &#x1F4DD; NOTE |
| :- |
| Some `EntityManager` methods have no `EntityCommandBuffer` equivalent because an equivalent wouldn’t be feasible or make sense. For example, there are no `EntityCommandBuffer` methods for getting component values because *reading* data is not something that can be usefully deferred. |
| After it has been played back, an `EntityCommandBuffer` instance cannot be used for additional recording. If you need to record more commands, create a new, separate `EntityCommandBuffer` instance. |

<br>

## Job safety

Each `EntityCommandBuffer` has a job safety handle, so the safety checks will throw an exception if you:

- ...invoke the `EntityCommandBuffer`'s methods on the main thread while the `EntityCommandBuffer` is still in use by any currently scheduled jobs.
- ... or schedule a job that accesses an `EntityCommandBuffer` already in use by other currently scheduled jobs (*unless* the new job depends on those other jobs).

| &#x26A0; IMPORTANT |
| :- |
| You might be tempted to share a single `EntityCommandBuffer` instance across multiple jobs, but this is strongly discouraged. There are cases where it will work fine, but in many cases it will not. For example, using the same `EntityCommandBuffer.ParallelWriter` across multiple parallel jobs might lead to an unexpected playback order of the commands. Instead, **it’s virtually always best to create and use one `EntityCommandBuffer` per job**. Don't worry about a performance difference: recording and playing back a set of commands split across multiple `EntityCommandBuffer`'s is not really any more expensive than recording the same set of commands all into one `EntityCommandBuffer`. |

<br>

## Temporary entities

When you call the [`CreateEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.CreateEntity.html) or [`Instantiate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.Instantiate.html) methods of an `EntityCommandBuffer`, no new entity is created until the command is executed in playback, so the entity ID returned by these methods are *temporary* ID's, which have negative index numbers. Subsequent `AddComponent`, `SetComponent`, and `SetBuffer` commands of the same `EntityCommandBuffer` may use these temporary ID's. In playback, any temporary ID's in the recorded commands will be remapped to actual, existing entities.

| &#x26A0; IMPORTANT |
| :- |
| Because a temporary entity ID has no meaning outside of the `EntityCommandBuffer` instance from which it was created, it should *only* be used in subsequent method calls of the same `EntityCommandBuffer` instance. Do not, for example, use a temporary ID in recording a command of a different `EntityCommandBuffer` instance. |

<br>

## EntityCommandBuffer.ParallelWriter

To safely record commands from a parallel job, we need an [`EntityCommandBuffer.ParallelWriter`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.ParallelWriter.html), which is a wrapper around an underlying `EntityCommandBuffer`.

A `ParallelWriter` has most of the same methods as an `EntityCommandBuffer` itself, but the `ParallelWriter` methods all take an additional 'sort key' argument for the sake of determinism:

When an `EntityCommandBuffer.ParallelWriter` records commands in a parallel job, the order of commands recorded from different threads depends upon thread scheduling, making the order non-deterministic. This isn't ideal because:

- Deterministic code is generally easier to debug.
- Some netcode solutions depend upon determinism to produce consistent results across different machines. 

While the recording order of the commands cannot be deterministic, the *playback order* can be deterministic with a simple trick:

1. Each command records a 'sort key' integer passed as the first argument to each command method.
1. The `Playback()` method sorts the commands by their sort keys before executing the commands.

As long as the used sort keys map deterministically to each recorded command, the sort makes the playback order deterministic.

So in an `IJobEntity`, the sort key we generally want to use is the [`ChunkIndexInQuery`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ChunkIndexInQuery.html), which is a unique value for every chunk. Because the sort is stable and because all entities of an individual chunk are processed together in a single thread, this index value is suitable as a sort key for the recorded commands. In an `IJobChunk`, we can use the equivalent `unfilteredChunkIndex` parameter of the `Execute` method.

<br>

## Multi-playback

If an `EntityCommandBuffer` is created with the `PlaybackPolicy.MultiPlayback` option, it's `Playback` method can be called more than once. Otherwise, calling `Playback` more than once will throw an exception. Multi-playback is mainly useful when you want to repeatedly spawn a set of entities.


<br>

## EntityCommandBufferSystem

An [`EntityCommandBufferSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBufferSystem.html) is a system that provides a convenient way to defer `EntityCommandBuffer` playback. An `EntityCommandBuffer` instance created from an `EntityCommandBufferSystem` will be played back and disposed the next time the `EntityCommandBufferSystem` updates.

You rarely need to create any `EntityCommandBufferSystem`'s yourself because the automatic bootstrapping process puts these five into the default world:

- `BeginInitializationEntityCommandBufferSystem`
- `EndInitializationEntityCommandBufferSystem`
- `BeginSimulationEntityCommandBufferSystem`
- `EndSimulationEntityCommandBufferSystem`
- `BeginPresentationEntityCommandBufferSystem`

The `EndSimulationEntityCommandBufferSystem`, for example, is updated at the end of the `SimulationSystemGroup`. (Notice there's no *EndPresentationEntityCommandBufferSystem* at the end of the frame, but you can use `BeginInitializationEntityCommandBufferSystem` instead: the end of one frame and the beginning of the next are logically the same point in time).

| &#x26A0; IMPORTANT |
| :- |
| Do not manually play back and dispose an `EntityCommandBuffer` instance created by an `EntityCommandBufferSystem`: the `EntityCommandBufferSystem` will both play back and dispose the instance for you. |

## Links discovered
- [`EntityCommandBuffer`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.html)
- [`Playback()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.Playback.html)
- [structural changes](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html)
- [sync points](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/concepts-structural-changes.html#sync-points)
- [`CreateEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.CreateEntity.html)
- [`DestroyEntity()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.DestroyEntity.html)
- [`AddComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.AddComponent.html)
- [`RemoveComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.RemoveComponent.html)
- [`SetComponent<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.SetComponent.html)
- [`AppendToBuffer()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.AppendToBuffer.html)
- [`AddBuffer()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.AddBuffer.html)
- [`SetBuffer()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.SetBuffer.html)
- [`Instantiate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.Instantiate.html)
- [`EntityCommandBuffer.ParallelWriter`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBuffer.ParallelWriter.html)
- [`ChunkIndexInQuery`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ChunkIndexInQuery.html)
- [`EntityCommandBufferSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.EntityCommandBufferSystem.html)

--- EntitiesSamples/Docs/jobs.md ---
# The C# Job system

In this page:

- [Unmanaged Collections](#unmanaged-collections)
- [C# Jobs](#c-jobs-and-job-dependencies)
- [Job Dependencies](#c-jobs-and-job-dependencies)
- [Job Safety Checks](#job-safety-checks)
- [Parallel Jobs](#parallel-jobs)

Further reading:

1. [Blog post: Improving Job System Performance part 1](https://blog.unity.com/engine-platform/improving-job-system-performance-2022-2-part-1)
1. [Blog post: Improving Job System Performance part 2](https://blog.unity.com/engine-platform/improving-job-system-performance-2022-2-part-2)

<br/>

# Unmanaged collections

The unmanaged collection types of `Unity.Collections` have a few advantages over normal C# managed collections:

- Unmanaged objects can be used in Burst-compiled code.
- Unmanaged objects can be used in jobs, whereas using managed objects in jobs is not always safe.
- The `Native-` collection types have safety checks to help enforce thread-safety in jobs.
- Unmanaged objects are not garbage collected and so induce no garbage collection overhead.

On the downside, you are responsible for calling `Dispose()` on every unmanaged collection once it's no longer needed. Neglecting to dispose a collection creates a memory leak, and the disposal safety checks will throw an error.

*[See more information about unmanaged collections](./cheatsheet/collections.md).*

## Allocators

When instantiating an unmanaged collection, you must specify an *allocator*. Different allocators organize and track their memory in different ways. Three of the most-commonly used allocators are:

- `Allocator.Persistent`: **The slowest allocator. Used for indefinite lifetime allocations.** You must call `Dispose()` to deallocate a Persistent-allocated collection when you no longer need it.
- `Allocator.Temp`: **The fastest allocator. Used for short-lived allocations.** Each frame, the main thread creates a Temp allocator which is deallocated in its entirety at the end of the frame. Because a Temp allocator gets discarded as a whole, you don't actually need to manually deallocate your Temp allocations, and in fact, calling `Dispose()` on a Temp-allocated collection is a no-op.
- `Allocator.TempJob`: *(discussed [below](#allocations-within-jobs))*

<br/>

# C# Jobs and Job Dependencies

&#x1F579;  *[See example jobs](../Assets/ExampleCode/Jobs.cs).*

The C# Jobs system allows us to schedule work to be executed in a pool of worker threads:

- When a worker thread finishes its current work, the thread will pull a waiting job off the queue and invoke the job's `Execute()` method to run the job.
- A job type is created by defining a struct that implements [`IJob`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.IJob.html) or one of the other job interfaces (`IJobParallelFor`, `IJobEntity`, `IJobChunk`...).
- To put a job instance on the job queue, call the extension method `Schedule()`. Jobs can only be scheduled from the main thread, not from within other jobs.

<br>

## Dependencies

`Schedule()` returns a [`JobHandle`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.html) representing the scheduled job. If a `JobHandle` is passed to `Schedule()`, the new job will *depend* upon the job represented by the handle.

**A worker thread will not pull a job off the job queue until the job's dependencies have all finished execution.** So we can use dependencies to prescribe the execution order amongst the scheduled jobs.

Although `Schedule()` only takes one `JobHandle` argument, we can use [`JobHandle.CombineDependencies()`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.CombineDependencies.html)'s to combine multiple handles into one logical handle, thus allowing a job to have multiple direct dependencies.

<br>

## Completing jobs

At some point after scheduling a job, the main thread should call the `JobHandle`'s [`Complete()`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.Complete.html) method on the main thread. Completing a job does a few things in this order:

1. Recursively completes all dependencies of the job.
1. Waits for the job to finish execution if it hasn't finished already. 
1. Removes all remaining references of the job from the job queue.

Effectively, once `Complete()` returns, the job and all its dependencies are guaranteed to have finished execution and to have been removed from the queue.

Also note:

- Calling `Complete()` on the handle of an already completed job does nothing and throws no error.
- Like with scheduling, jobs can only be completed from the main thread, not from within other jobs. 
- Though a job can be completed immediately after scheduling, it's usually best to hold off completing a job until the latest possible moment when the work actually needs to be done. In general, the longer the gaps between the scheduling of each job and its completion, the less likely the main thread and worker threads will spend time needlessly sitting idle.

<br>

## Data access in jobs

In the large majority of cases:

- A job should not perform I/O.
- A job should not access managed objects.
- A job should only access static fields if they are readonly.

Scheduling a job creates a private copy of the struct that will be visible only to the running job. Consequently, any modifications to the fields in the job will be visible only within the job. However, because an unmanaged collection struct stores its *content* externally instead of in the struct itself, modifications to the content of a collection field will be visible outside the job.

<br>

## Allocations within jobs

Collections passed to a job must be allocated with `Allocator.Persistent`, `Allocator.TempJob`, or another thread-safe allocator.

Collections allocated with `Allocator.Temp` *cannot* be passed into jobs. However, each thread of a job is given its own Temp allocator, so `Allocator.Temp` is safe to use *within* jobs. All Temp allocations in a job will be disposed automatically at the end of the job.

Allocations made with `Allocator.TempJob` must be manually disposed. The disposal safety checks, if enabled, will throw an exception when any allocation made with `Allocator.TempJob` is not disposed within 4 frames after allocation.


<br/>


# Job Safety Checks

For any two jobs which access the same data, it's generally undesirable for their execution to overlap or for their execution order to be indeterminate. For example, if two jobs read and write the content of a native array, we should ensure that one of the two jobs finishes execution before the other starts. Otherwise, when either job modifies the array, that change may interfere with the results of the other job, depending upon the happenstance of which job runs before the other and whether their execution overlaps.

So when you have such a data conflict between two jobs, you should either:

- Schedule and complete one job before scheduling the other...
- ...or schedule one job as a dependency of the other.

When you call `Schedule()`, the job safety checks (if enabled) will throw an exception if they detect a potential race condition. For instance, an exception will be thrown if you first schedule a job that uses a native array and then schedule a second job which uses that same native array but which does not depend upon the first job.

As a special case, it's always safe for two jobs to access the same data if both jobs only *read* the data. Because neither job modifies the data, they won't interfere with each other. We can indicate that a native array or collection will only be read in a job by marking the struct field with the [`[ReadOnly]`](https://docs.unity3d.com/ScriptReference/Unity.Collections.ReadOnlyAttribute.html) attribute. The job safety checks will not consider two jobs to conflict if all native arrays or collections they share are marked `[ReadOnly]` in both jobs.

In some cases, you may wish to disable the job safety checks entirely for a specific native array or collection used in a job. This can be done by marking it with the [`[NativeDisableContainerSafetyRestriction]`](https://docs.unity3d.com/ScriptReference/Unity.Collections.LowLevel.Unsafe.NativeDisableContainerSafetyRestrictionAttribute.html) attribute. Just be sure that you're not creating a race condition!

While a native collection is in use by any currently scheduled jobs, the safety checks will throw an exception if you attempt to read or modify that native collection on the main thread. As a special case, the main thread can *read* from a native collection if it is marked `[ReadOnly]` in the scheduled jobs.

<br/>


# Parallel Jobs

To split the work of processing an array or list across multiple threads, we can define a job with the [`IJobParallelFor`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.IJobParallelFor.html) interface:

```csharp
[BurstCompile]
public struct SquareNumbersJob : IJobParallelFor
{
    public NativeArray<int> Nums;

    // Each Execute call processes only a single index.
    public void Execute(int index)
    {
        Nums[index] *= Nums[index];
    }
}
```

When we schedule the job, we specify an index count and batch size:
 
```csharp
// ... scheduling the job
var job = new SquareNumbersJob { Nums = myArray };
JobHandle handle = job.Schedule(
        myArray.Length,    // count
        100);              // batch size
```

When the job runs, its `Execute()` will be called *`count`* times, with all values from 0 up to *count* passed to `index`.

The indexes of the job get split into batches determined by the batch size, and the worker threads then can grab these batches off the queue. Effectively, the separate batches may be processed concurrently on separate threads, but all indexes of an individual batch will be processed together within a single thread.

In this example, if the array length is, say, 250, then the job will be split into three batches: the first covering indexes 0 through 99; the second covering indexes 100 through 199; and the last batch covering the remainder, indexes 200 through 249. Because the job is split into three batches, it will effectively be processed at most across three worker threads. If we want to split the job up across more threads, we must pick a smaller batch size.

| &#x1F4DD; NOTE |
| :- |
| The choice of a good batch size isn’t an exact science! In the extreme case, we could pick a batch size of 1 and thereby split each individual index into its own batch, but keep in mind that having too many small batches might incur significant job system overhead. In general, you should pick a batch size that seems not too big but not too small and then experiment to find a size that seems optimal for each specific job. |

When a batch is processed, it should only access array or list indexes of its own batch. To enforce this, the safety checks throw an exception if we index an array or list with any value other than the `index` parameter:

```csharp
[BurstCompile]
public struct MyJob : IJobParallelFor
{
    public NativeArray<int> Nums;

    public void Execute(int index)
    {
        // The expression Nums[0] triggers a safety check exception!
        Nums[index] = Nums[0];
    }
}
```

This restriction does not apply to array and list fields marked with the `[ReadOnly]` attribute. For an array or list field you need to write in the job, you can disable the restriction by marking the field with `[NativeDisableParallelForRestriction]`. Just be careful that you're not creating a race condition!

## Links discovered
- [Blog post: Improving Job System Performance part 1](https://blog.unity.com/engine-platform/improving-job-system-performance-2022-2-part-1)
- [Blog post: Improving Job System Performance part 2](https://blog.unity.com/engine-platform/improving-job-system-performance-2022-2-part-2)
- [See more information about unmanaged collections](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/cheatsheet/collections.md)
- [See example jobs](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/ExampleCode/Jobs.cs)
- [`IJob`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.IJob.html)
- [`JobHandle`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.html)
- [`JobHandle.CombineDependencies()`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.CombineDependencies.html)
- [`Complete()`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.JobHandle.Complete.html)
- [`IJobParallelFor`](https://docs.unity3d.com/ScriptReference/Unity.Jobs.IJobParallelFor.html)

--- EntitiesSamples/Docs/project_setup.md ---
# New Entities project setup

With Unity 2022.2, create a new project from either an HDRP or URP template, then add the DOTS packages that you need by name from the package manager:

![add package](./images/add_package.png)

- `com.unity.entities`
- `com.unity.entities.graphics` (for rendering entities)
- `com.unity.collections` (unmanaged collection types)
- `com.unity.physics` (for collision detection and physical simulation of entities)
- `com.havok.physics` (alternative Havok-provided "backend" for physics)
- `com.unity.netcode` (for entities-driven server-client multiplayer)

These packages will include `com.unity.burst` and `com.unity.mathematics` as dependencies.

When working in an Entities project, you normally want these two settings:

- In the "Entities" section of the Unity preferences, set the "Scene View Mode" to "Runtime Data".
- In the "Editor" section of the project settings, enable "Enter Play Mode Options" but leave "Reload Domain" and "Reload Scene" disabled. (See [Unity Manual - Configurable Enter Play Mode](https://docs.unity3d.com/Manual/ConfigurableEnterPlayMode.html) and [Unity Blog - Enter Play Mode faster in Unity 2019.3](https://blog.unity.com/technology/enter-play-mode-faster-in-unity-2019-3).)

## Links discovered
- [add package](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/images/add_package.png)
- [Unity Manual - Configurable Enter Play Mode](https://docs.unity3d.com/Manual/ConfigurableEnterPlayMode.html)
- [Unity Blog - Enter Play Mode faster in Unity 2019.3](https://blog.unity.com/technology/enter-play-mode-faster-in-unity-2019-3)

--- EntitiesSamples/Docs/systems.md ---
# Systems

A **system** is a unit of code which belongs to a [world]() and which runs on the main thread (usually once per frame). Normally, a system will only access entities of its own world, but this is not an enforced restriction.

&#x1F579; *[See example systems](../Assets/ExampleCode/ComponentsSystems.cs).*

A system is defined as a struct implementing the [`ISystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.html) interface, which has three key methods:

| **`ISystemState` method** | **Description** |
|---|---|
| [`OnUpdate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.OnUpdate.html) | Normally called once per frame, though this depends upon the `SystemGroup` to which the system belongs. |
| [`OnCreate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.OnCreate.html) | Called before the first call to `OnUpdate` and whenever a system resumes running. |
| [`OnDestroy()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.OnDestroy.html) | Called when a system is destroyed. |

A system may additionally implement `ISystemStartStop`, which has these methods:

| **`ISystemStartStop` method** | **Description** |
|------|------|
| [`OnStartRunning()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystemStartStop.OnStartRunning.html) | Called before the first call to `OnUpdate` and after any time the system's [`Enabled`](xref:Unity.Entities.ComponentSystemBase.Enabled) property is changed from `false` to `true`. |
| [`OnStopRunning()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystemStartStop.OnStopRunning.html) | Called before `OnDestroy` and after any time the system's [`Enabled`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.Enabled.html) property is changed from `true` to `false`. |

<br>

## System groups and system update order

The systems of a world are organized into **system groups**. Each system group has an ordered list of systems and other system groups as its children, so the system groups form a hierarchy, which determines the update order. A system group is defined as a class inheriting from [`ComponentSystemGroup`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentSystemGroup.html).

When a system group is updated, the group normally updates its children in their sorted order, but this default behavior can be overridden by overriding the group's update method.

A group's children are re-sorted every time a child is added or removed from the group.

The [`[UpdateBefore]`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.UpdateBeforeAttribute.html) and [`[UpdateAfter]`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.UpdateAfterAttribute.html) attributes can be used to determine the relative sort order amongst the children in a group. For example, if a *FooSystem* has the attribute `UpdateBefore(typeof(BarSystem))]`, then *FooSystem* will be put somewhere before *BarSystem* in the sorted order. If, however, *FooSystem* and *BarSystem* don't belong to the same group, the attribute is ignored. If the ordering attributes of a group's children create a contradiction (*e.g.* *A* is marked to update before *B* but also *B* is marked to update before *A*), an exception is thrown when the group's children are sorted.

<br>

## Creating worlds and systems

By default, an automatic bootstrapping process creates a default world with three system groups: 

- `InitializationSystemGroup`, which updates at the end of the `Initialization` phase of the Unity player loop.
- `SimulationSystemGroup`, which updates at the end of the `Update` phase of the Unity player loop.
- `PresentationSystemGroup`, which updates at the end of the `PreLateUpdate` phase of the Unity player loop.

Automatic bootstrapping creates an instance of every system and system group (except those with the [`[DisableAutoCreation]`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.DisableAutoCreationAttribute.html) attribute). These instances are added added to the `SimulationSystemGroup` unless overridden by the [`[UpdateInGroup]`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.UpdateInGroupAttribute.html) attribute. For example, if a system has the attribute `UpdateInGroup(typeof(InitializationSystemGroup))]`, then the system will be added to the `InitializationSystemGroup` instead of the `SimulationSystemGroup`.

The automatic bootstrapping process can be disabled with scripting defines:

|**Scripting define**|**Description**|
|---|---|
|`#UNITY_DISABLE_AUTOMATIC_SYSTEM_BOOTSTRAP_RUNTIME_WORLD`| Disables automatic bootstrapping of the default world. |
|`#UNITY_DISABLE_AUTOMATIC_SYSTEM_BOOTSTRAP_EDITOR_WORLD`| Disables automatic bootstrapping of the Editor world. |
|`#UNITY_DISABLE_AUTOMATIC_SYSTEM_BOOTSTRAP`| Disables automatic bootstrapping of both the default world and the Editor world. |

When automatic bootstrapping is disabled, your code is responsible for:

- Creating any worlds you need.
- Calling [`World.GetOrCreateSystem<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.GetOrCreateSystem.html) to add the system and system group instances to the worlds.
- Registering top-level system groups (like `SimulationSystemGroup`) to update in the Unity [PlayerLoop](https://docs.unity3d.com/ScriptReference/LowLevel.PlayerLoop.html).

Alternatively, automatic bootstrapping can be customized by creating a class that implements [`ICustomBootstrap`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICustomBootstrap.html).

<br>

## Time in worlds and systems

A world has a `Time` property, which returns a [`TimeData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Core.TimeData.html) struct, containing the frame delta time and elapsed time. The time value is updated by the world's [`UpdateWorldTimeSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.UpdateWorldTimeSystem.html). The time value can be manipulated with these `World` methods:

|**`World` method**|**Description**|
|---|---|
| [`SetTime`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.SetTime.html) | Set the time value. |
| [`PushTime`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.PushTime.html) | Temporarily change the time value. |
| [`PopTime`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.PopTime.html) | Restore the time value from before the last push. |

Some system groups, like [`FixedStepSimulationSystemGroup`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.FixedStepSimulationSystemGroup.html), push a time value before updating their children and then pop the value once done updating.

<br>

## SystemState

A system's `OnUpdate()`, `OnCreate()`, and `OnDestroy()` methods are passed a [`SystemState`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.html) parameter. `SystemState` represents the state of the system instance and has important methods and properties, including:

|**Method or property**|**Description**|
|---|---|
| [`World`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.World.html) | The system's world. |
| [`EntityManager`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.EntityManager.html) | The `EntityManager` of the system's world. |
| [`Dependency`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.Dependency.html) | A `JobHandle` used to pass job dependencies between systems. |
| [`GetEntityQuery()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.GetEntityQuery.html) | Returns an `EntityQuery`. |
| [`GetComponentTypeHandle<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.GetComponentTypeHandle.html) | Returns a `ComponentTypeHandle<T>`. |
| [`GetComponentLookup<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.GetComponentLookup.html) | Returns a `ComponentLookup<T>`.|

| &#x26A0; IMPORTANT |
| :- |
| Although entity queries, component type handles, and component lookups can be acquired directly from the `EntityManager`, it is generally proper for a system to only acquire these things from the `SystemState` instead. By going through `SystemState`, the component types accessed get tracked by the system, which is essential for the `Dependency` property to correctly pass job dependencies between systems. *[See more about jobs that access entities](./entities-jobs.md).* |

<br>

## SystemAPI

The [`SystemAPI`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.html) class has many static convenience methods, covering much of the same functionality as `World`, `EntityManager`, and `SystemState`.

The `SystemAPI` methods rely upon [source generators](https://docs.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/source-generators-overview), so they only work in systems and `IJobEntity` (but not `IJobChunk`). The advantage of using `SystemAPI` is that these methods produce the same results in both contexts, so code that uses `SystemAPI` will generally be easier to copy-paste between these two contexts.

| &#x1F4DD; NOTE |
| :- |
| If you get confused about where to look for key Entities functionality, the general rule is to check `SystemAPI` first. If `SystemAPI` doesn't have what you're looking for, look in `SystemState`, and if what you're looking for isn't there, look in the `EntityManager` and `World`. |

`SystemAPI` also provides a special [`Query()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.Query.html) method that, through source generation, helps conveniently create a foreach loop over the entities and components matching a query.

<br>

## Links discovered
- [See example systems](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/ExampleCode/ComponentsSystems.cs)
- [`ISystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.html)
- [`OnUpdate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.OnUpdate.html)
- [`OnCreate()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.OnCreate.html)
- [`OnDestroy()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystem.OnDestroy.html)
- [`OnStartRunning()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystemStartStop.OnStartRunning.html)
- [`Enabled`](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/xref:Unity.Entities.ComponentSystemBase.Enabled)
- [`OnStopRunning()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ISystemStartStop.OnStopRunning.html)
- [`Enabled`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.Enabled.html)
- [`ComponentSystemGroup`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ComponentSystemGroup.html)
- [`World.GetOrCreateSystem<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.GetOrCreateSystem.html)
- [PlayerLoop](https://docs.unity3d.com/ScriptReference/LowLevel.PlayerLoop.html)
- [`ICustomBootstrap`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.ICustomBootstrap.html)
- [`TimeData`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Core.TimeData.html)
- [`UpdateWorldTimeSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.UpdateWorldTimeSystem.html)
- [`SetTime`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.SetTime.html)
- [`PushTime`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.PushTime.html)
- [`PopTime`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.World.PopTime.html)
- [`FixedStepSimulationSystemGroup`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.FixedStepSimulationSystemGroup.html)
- [`SystemState`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.html)
- [`World`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.World.html)
- [`EntityManager`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.EntityManager.html)
- [`Dependency`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.Dependency.html)
- [`GetEntityQuery()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.GetEntityQuery.html)
- [`GetComponentTypeHandle<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.GetComponentTypeHandle.html)
- [`GetComponentLookup<T>()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemState.GetComponentLookup.html)
- [See more about jobs that access entities](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/entities-jobs.md)
- [`SystemAPI`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.html)
- [source generators](https://docs.microsoft.com/en-us/dotnet/csharp/roslyn-sdk/source-generators-overview)
- [`Query()`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Entities.SystemAPI.Query.html)

--- EntitiesSamples/Docs/transforms.md ---
# Transform components and systems

The [`LocalTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalTransform.html) component represents the transform of an entity, and entity transform hierarchies are formed with three additional components:

- The [`Parent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.Parent.html) component stores the id of the entity's parent.
- The [`Child`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.Child.html) dynamic buffer component stores the ids of the entity's children.
- The [`PreviousParent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.PreviousParent.html) component stores a copy of the id of the entity's parent.

To modify the transform hierarchy:

- Add the `Parent` component to parent an entity.
- Remove an entity's `Parent` component to de-parent it.
- Set an entity's `Parent` component to change its parent.

The [`ParentSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.ParentSystem.html) updates the `Child` and `PreviousParent` components to ensure that:

- Every entity with a parent has a `PreviousParent` component that references the parent.
- Every entity with one or more children has a `Child` buffer component that references all of its children.

| &#x26A0; IMPORTANT |
| :- |
| Although you can safely *read* an entity's `Child` buffer component, you should not modify it directly. Only modify the transform hierarchy by setting the entities' `Parent` components. |

Every frame, the [`LocalToWorldSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalToWorldSystem.html) computes each entity's world-space transform (from the `LocalTransform` components of the entity and its ancestors) and assigns it to the entity's [`LocalToWorld`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalToWorld.html) component.

| &#x1F4DD; NOTE |
| :- |
| The `Entity.Graphics` systems read the `LocalToWorld` component but not any of the other transform components, so `LocalToWorld` is the only transform component an entity needs to be rendered. |

## Links discovered
- [`LocalTransform`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalTransform.html)
- [`Parent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.Parent.html)
- [`Child`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.Child.html)
- [`PreviousParent`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.PreviousParent.html)
- [`ParentSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.ParentSystem.html)
- [`LocalToWorldSystem`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalToWorldSystem.html)
- [`LocalToWorld`](https://docs.unity3d.com/Packages/com.unity.entities@latest?subfolder=/api/Unity.Transforms.LocalToWorld.html)

--- EntitiesSamples/Docs/cheatsheet/blob_assets.src.md ---


--- LICENSE.md ---
Entity Component System copyright © 2017-2020 Unity Technologies ApS

Licensed under the Unity Companion License for Unity-dependent projects--see [Unity Companion License](https://unity3d.com/legal/licenses/Unity_Companion_License). 

Unless expressly provided otherwise, the Software under this license is made available strictly on an “AS IS” BASIS WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED. Please review the license for details on these and other terms and conditions.


## Links discovered
- [Unity Companion License](https://unity3d.com/legal/licenses/Unity_Companion_License)

--- NetcodeSamples/CHANGELOG.md ---
# Changelog

## [1.9.1] - 2025-10-11

### Fixed
- Issue in host migration sample where the migration update data didn't update/compress properly when hosting a game, leaving and then re-hosting.
- Issue in connection approval sample when going through relay.

## [1.9.0] - 2025-09-13

### Added
- Added debug level logging in hello netcode samples for better following input handling and spawning.

### Fixed
- Issue in `Asteroids` where the `AsteroidScore` ghost was being stripped out of builds.

### Host Migration (HelloNetcode)

#### Changes
- In `Asteroids` removed the server-only player color tracking system. Now the colors are again mapped to the network ID like before and these are properly migrated. One side effect is that when the client which was the previous host reconnects he'll not be detected as a reconnection anymore if the client world has been destroyed (like when returning to main menu).

#### Fixed
- Issue where reconnected player were not detected properly and got duplicate spawns in the `PlayerSpawn` sample and those who derive from it.
- Issue with double amount of barrels spawning in `Importance` sample after a migration.
- Possible crash when waiting for the relay join code to arrive (server world can disappear).
- Issue with UTC time being used in lobby migration data but not in local time

## [1.8.0] - 2025-08-17

### Changed
- Improvements to importance system in `Asteroids`.
- Improvements to the `Optimization` sample.
- Big overhaul done on the `Importance` sample, use with the new `Importance Visualizer` in the Netcode for Entities package.

### Fixed
- In `Asteroids` properly apply the bullet scale from the prefab.


## [1.7.0] - 2025-07-29

### Fixed
- Issue in the frontend where the selected sample would not be saved between sessions (always picked the first one in the Samples or HelloNetcode lists)

### Relay Support (HelloNetcode)

#### Changed
- When a join code has been entered the hosting button is disabled

#### Fixed
- Message is now printed to the UI field when no join code is present when pressing join button
- When join button is pressed with an empty field, it no longer tries to immediately join when you start entering the join code (now properly resets state)
- Issue where you could not host or join a second time after going back to the frontend menu
- Failure in `ConnectionApproval` sample when running via relay


## [1.6.2] - 2025-07-07

### Added
- Preserialization test with a custom template added to the project.


## [1.6.1] - 2025-05-28

### Fixed
- Issues with the relay sample and the WebGL platform target not working properly together.

### Asteroids

### Changed
- Improved relevancy and importance scaling implementation, increase asteroid count from 200 to 800
- Improved the `AsteroidScore` and collision handling.

### Host migration (HelloNetcode)

#### Changed
- Added test/debug toggle to manually fail a host migration when elected as host
- Updated for API changes in Netcode for Entities 1.6.1, added `ENABLE_HOST_MIGRATION` define to player settings to enable the host migration feature

#### Fixed
- Fixed case where a client joins while a host migration is in progress, but the new host fails to become a host, then the client might be elected as the new host, but it would be in the middle of the join-as-client flow and have no client world or scenes loaded yet. 


## [1.5.0] - 2025-04-22

### Added

### Changed
- Modified `LoadScenes_AllScenesShouldConnect` test to spam the reconnect button, to place more burden on the correctness of Netcode for Entities (and each samples) reconnect flows.
- Cleaned up some constantly changing meta files.
- Removed the duplicate Asteroids scene.
- Fixed issue in the `ConnectionApproval` sample, where disconnecting would not stop the sending of the RPC, leading to an RPC warning when reconnecting. Ditto for `PlayerList` and RPC samples.
- Updated `SceneLoading` tests to use `AutomaticThinClientWorldsUtility`.
- Stop including `DisableBootstrap` scene in the sample selection dropdown.
- Switch to using Multiplayer SDK instead of relay package.
- `GhostPredictionSwitchingSystemForThinClient` is no longer needed (netcode does not require it).

### Fixed
- Issues with `PredictedSpawning` classification system.
- Issues with particles in the `MultyPhysicsWorld` sample


--- PhysicsSamples/ReleaseNotes.md ---
# Release Notes
All notable changes to this project will be documented in this file.

## [Physics Samples Project for post 1.3.0]
### Changes
* Changed the Joints - Parade demo such that the BreakJoint1 MaxImpulse was changed from (10,10,10) to (2,2,2).

### Fixes

## [Physics Samples Project for 1.3.0]
### Changes
* Added demo scene `Modify Collider Geometry.unity` demonstrating runtime collider deformations. In the demo, the geometry of various types of colliders are modified via the new `ColliderBakeTransformAuthoring` component, which lets you create cyclic animations during which a game object's collider and its visuals are deformed over time. This is achieved through use of the `Collider.BakeTransform` function, which applies an affine transformation to a collider, correspondingly rotating, translating, scaling and shearing its geometry in the process. 
* Added support for spring and damping for motors in the custom authoring components. In the motor demos, these fields are used now.
* Demo scenes with motors now have examples of how to author using built-in components or custom components

### Fixes
* Modify Runtime - Collision Filter demo: fixed a bug where the render mesh of the cubes was being incorrectly changed to a sphere.
* Fixed a memory leak in the ColliderBakeTransformSystem caused by the subscene being disposed before the OnDestroy could properly dispose a collider blob

## [Physics Samples Project for 1.2.0]
### Changes
* Reorganized the samples, with cleanup of various samples' code and scenes.
* Added demo scene `Modify Collider Geometry.unity` demonstrating runtime collider deformations. In the demo, the geometry of various types of colliders are modified via the new `ColliderBakeTransformAuthoring` component, which lets you create cyclic animations during which a game object's collider and its visuals are deformed over time. This is achieved through use of the `Collider.BakeTransform` function, which applies an affine transformation to a collider, correspondingly rotating, translating, scaling and shearing its geometry in the process. 
* Added support for spring and damping for motors in the custom authoring components. In the motor demos, these fields are used now.

## [Physics Samples Project for 1.1.0]
### Changes
* Added demo scene `4e. Single Ragdoll` with a GameObject ragdoll created using the built-in physics [Ragdoll Wizard](https://docs.unity3d.com/Manual/wizard-RagdollWizard.html) and simulated using Unity Physics for DOTS on one side and the built-in GameObject physics on the other.
* Added demo scene `5m. Collider Modifications` to show how to create mesh colliders during runtime
* Added new API for BlobAssetReference MeshCollider.Create(UnityEngine.Mesh, CollisionFilter, Material) in `Physics_MeshCollider.cs`
* Added new API for BlobAssetReference MeshCollider.Create(UnityEngine.Mesh.MeshData, CollisionFilter, Material) in `Physics_MeshCollider.cs`
* Added new API for BlobAssetReference MeshCollider.Create(UnityEngine.Mesh.MeshDataArray, CollisionFilter, Material) in `Physics_MeshCollider.cs`
* Renamed the `4d. Ragdoll` scene to `4d. Ragdolls` for clarity.
* The `Mouse Hover Authoring` component was improved and now works also when hovering over physics entities whose rendering components are located in a child entity. Consequently, the previously disabled `Mouse Hover Authoring` component has now been enabled in the `4d. Ragdolls` scene.
* Added new physics component: Force Unique Collider Authoring to allow built-in colliders to be made unique during baking
* Updated the `5b. Change Box Collider Size` scene to use the new Physics Force Unique Collider component
* The `5. Modify` section now has a new section called `5g. Runtime Collider Modifications`.
* A new demo has been added: `5g1. Change Collider Material - Bouncy Boxes`. This demo instantiates prefabs containing unique colliders and modifies collider blob data during runtime
* The previously named `5g. Change Collider Filter` demo has been renamed to `5g2. Unique Collider Blob Sharing`. The focus of this demo is how collider data is shared, rather than how the `CollisionFilter` is modified.
* The `5g2. Unique Collider Blob Sharing` demo uses the new `MakeUnique` method in `SpawnExplosionAuthoring.cs`. The manual management of new colliders is no longer necessary.
* Moved the `5m. Collider Modification` demo to the `5g. Runtime Collider Modifications` section and renamed it to `5g3. Runtime Collider Creation`
* Extended the `Motion Properties - Mass` demo with an additional seesaw created using built-in physics authoring components (in grey) alongside the already existing
seesaw that uses custom physics authoring components (in yellow).
* A new demo has been added: `5g4. Runtime Collision Filter Modification`. This demo shows how to modify a CollisionFilter during runtime.

### Fixes
* Improved system start-up efficiency by not initializing systems that aren't required in the following files:
  * `Tests/Animation/Scripts/AnimationPhysicsSystem.cs`
  * `Tests/MultipleWorlds/ClientServer/Scripts/ServerPhysicsSystem.cs`
  * `Tests/MultipleWorlds/CustomPhysicsGroup/MultiWorldMousePicker.cs`
  * `Tests/MultipleWorlds/CustomPhysicsGroup/UserWorldCreator.cs`
* `Tests/SamplesTest/CreatePhysicsPerformanceTests.unity`: Fixed an index out of range bug in the OnUpdate method of the system
* Fixed bug in demo scene 5c. Change Collider Type where the collider type wasn't being updated'
* Fixed bug in `QueryTester.cs`, which is used in demos 3a. All Hits Distance Test / 3b. Cast Test / 3c. Closest Hit Distance Test, where debug draw lines were not drawing the results of the queries. Any system using drawing features of the PhysicsDebugDisplaySystem must update this system within the PhysicsDebugDisplayGroup.

## [Physics Samples Project for 1.0.0]

* Added automatic import of _Custom Physics Authoring_ experience: <br> The custom physics authoring experience, built around the `PhysicsBodyAuthoring` and `PhysicsShapeAuthoring` components, is no longer embedded in the Unity Physics package API. Instead it is provided as a Unity Physics package sample called _Custom Physics Authoring_. This sample is now automatically imported into the PhysicsSamples project under `Assets/Samples/Unity Physics/<package version>/Custom Physics Authoring`. If you want to update the Unity Physics package in the PhysicsSamples project make sure to import the new version of this sample using the Package Manager under the _Samples_ tab after the update and then delete the previous version of this sample from the project. 

## [Physics Samples Project for 1.0.0-pre.15]
### Changes
* Added demo scenes for new motor joints under `Assets/Demos/4. Joints/4c. Motors`.
* Added `SimulationValidationAuthoring` component for physics behavior validation testing, which can be used to confirm that joints behave as expected and that rigid bodies are at rest if desired.
* Added simulation validation to the following PlayMode tests in the `Assets` folder:
  * `Tests/Stacking/BasicStacks.unity`
  * `Tests/JointTest/LimitedHinge/LimitedHingeSub.unity`
  * `Tests/JointTest/Prismatic.unity`
  * `Tests/JointTest/Hinge.unity`
  * `Demos/4. Joints/4a. Joints Parade/4a. Joints Parade SubScene.unity`
  * `Demos/4. Joints/4c. Motors/4c3. Linear Velocity Motor.unity`
  * `Demos/4. Joints/4c. Motors/4c4. Angular Velocity Motor.unity`
* Changed base class of systems from SystemBase to ISystem
### Fixes
  * `Demos/5. Modify/5f. Change Surface Velocity.unity` fixed a dependency in the DisplayConveyorBeltJob
### Known Issues

## [Physics Samples Project for 0.51.0-preview.32] - 2022-06-30
### Changes
* Packages:
  * Updated com.unity.physics from `0.50.0-preview.24` to `0.51.0-preview.32`  
  * Updated com.havok.physics from `0.50.0-preview.24` to `0.51.0-preview.32`  
  * Updated com.unity.collections from `1.2.3-pre.24` to `1.3.1`
  * Updated com.unity.entities from `0.50.0-preview.24` to `0.51.0-preview.32`
  * Updated com.unity.jobs from `0.50.0-preview.8` to `0.51.0-preview.32`
  * Updated com.unity.rendering.hybrid from `0.50.0-preview.24` to `0.51.0-preview.32`
  * Updated com.unity.render-pipelines.universal from `10.8.1` to `12.1.7`
* Editor:
  * Updated Editor version from `2020.3.30f1` to `2021.3.4f1`  
* Documentation:
  * Updated Documentation folder has been renamed to READMEimages and Samples.md has been renamed to README.md.  
* Shader PhysicsStatic material has been disabled due to some rendering errors with `2021.3.4f1` a new material substitutes the shader while the errors gets fixed.
* Updated NativeHashMap to NativeParallelHashMap.

### Fixes
### Known Issues

## [Physics Samples Project for 0.50.0-preview.24] - 2022-03-25
### Changes
* Project:
  * Updated project name from UnityPhysicsSamples to PhysicsSamples.   
  * add urp to the project.
  * upgrade shaders so they are urp compatible.
  * cleanup Shaders/PhysicsStaticInputs.hlsl and Shaders/PhysicsStatic.shader + add materials.
* Packages:
  * Updated com.unity.physics to `0.50.0-preview.24`  
  * Updated com.havok.physics  to `0.50.0-preview.24`  
  * Updated com.unity.collections to `1.2.3-pre.24`
  * Updated com.unity.entities to `0.50.0-preview.24`
  * Updated com.unity.jobs to `0.50.0-preview.8`
  * Updated com.unity.rendering.hybrid to `0.50.0-preview.24`
  * Updated com.unity.render-pipelines.universal to `10.8.1` 

### Fixes
  * fixed materials for all demos
  * fixed up ragdoll parts scale based on collider mesh bounds
  * fixed material colors
  
### Known Issues

## [Physics Samples Project for 0.10.0-preview] - 2021-12-31
### Changes
* Added `ImmediatePhysicsWorldStepper` utility class for running physics simulation immediately on the current thread.
* Changed `ProjectIntoFutureOnCueSystem` in Pool demo to use `ImmediatePhysicsWorldStepper`.
* Added Assets/Tests/MultipleWorlds/Animation/Animation scene that shows how you can use a separate `PhysicsWorld` to simulate a small number of non-critical bodies for animation purposes (character's ponytail and scabbard). `DriveAnimationBodySystem` syncs critical bodies between default and side physics world (character's head and torso) and prepares the data for non-critical bodies (position and velocity correction for ponytail and scabbard). `AnimationPhysicsSystem` performs single-threaded `PhysicsWorld` building, simulation and export to ECS components. The demo shows 2 variants of physically animated ponytail: with position and velocity corrections (green) and without them (blue).
* Added Assets/Tests/MultipleWorlds/ClientServer/ClientServer scene as a simplified client-server sample, with game-critical ghost bodies (exist on both server and client) and client-only bodies that are simulated only locally to add to game's visual appeal.
Bodies in server physics world are simulated first (would be predicted based on server data in real use-cases) and then mirrored into the default physics world. Default physics world contains ghost and client-only bodies, where ghost bodies are driven by their server counterparts (game objects are linked via Server Entity setting in Drive Ghost Body Authoring script). `DriveGhostBodySystem` drives ghost bodies by position or velocity, the ratio (position vs velocity) is determined by First Order Gain setting in Drive Ghost Body Authoring script on the client ghost body game object. `ServerPhysicsSystem` is the key system that builds, simulates and exports server physics world. 
The demo shows different kinematic bars (client-only, dynamic and kinematic ghost) rotating and pushing various speheres around (client-only, dynamic and kinematic ghosts driven by position, velocity and both equally).
### Fixes
### Known Issues

## [Physics Samples Project for 0.9.0-preview.4] - 2021-05-19
### Changes
* Dependencies
  * Updated Data Flow Graph to `0.21.0-preview.1`
  * Updated IDE Visual Studio to `2.0.7`
  * Updated Hybrid Renderer `0.13.0-preview.30`
### Fixes
### Known Issues

## [Physics Samples Project for 0.8.0-preview] - 2021-03-26

### Changes
* Dependencies
  * Updated DOTS Editor from `0.13.0-preview` to `0.14.0-preview.1`
  * Updated Hybrid Renderer from `0.12.0-preview.42` to `0.13.0-preview.17`
  * Updated Burst from `1.4.4` to `1.5.0`

* Refactored the `CollisionEvent` and `TriggerEvent` demos to make the Stateful events clearer.
  * To add stateful events to your own project copy all scripts from the [Stateful](Assets/Demos/2.%20Setup/2d.%20Events/Scripts/Stateful) folder.
  * Then, if you want to have collision events:
    1. Use the **'Collide Raise Collision Events'** option of the **'Collision Response'** property of a `PhysicsShapeAuthoring` component, and
    2. Add a `StatefulCollisionEventBufferAuthoring` component to that entity (and select if details should be calculated or not)
    3. At runtime, read from the dynamic buffer of `StatefulCollisionEvent`s
  * Alternatively, if you want to have trigger events:
    1. Use the **'Raise Trigger Events'** option of the **'Collision Response'** property of a `PhysicsShapeAuthoring` component, and
    2. Add a `StatefulTriggerEventBufferAuthoring` component to that entity
    3. At runtime, read from the dynamic buffer of `StatefulTriggerEvent`s

## [Physics Samples Project for 0.7.0-preview.3] - 2021-02-24

### Changes

* Dependencies
  * Updated Data Flow Graph from `0.18.0-preview.3` to `0.20.0-preview.4`
  * Updated DOTS Editor from `0.12.0-preview.4` to `0.13.0-preview`
  * Updated Hybrid Renderer from `0.10.0-preview.21` to `0.12.0-preview.42`
  * Updated Coding from `0.1.0-preview.17` to `0.1.0-preview.20`
  
* Added a new `MouseHoverAuthoring` script to help highlight the extra `CompoundCollider.Child.Entity` field and `PhysicsRenderEntity` component data. Check out the simple `1b. Representations` and more complex `2a2. Collider Parade - Advanced` demos scene for example of setup variations. 
* Added `Tests/VelocityClipping/VelocityClippingStacking` demo to showcase a simple replacement for the removed `SimulationCallbacks.Phase.PostSolveJacobians`. This demo does a really simple velocity clipping and the point is not to showcase stacking (which is covered with `Tests/Stacking` demos) but instead to show how to achieve the effect similar to previous callback without using the callback itself.
* Added `Tests/SystemScheduling/SchedulingSample` which shows how jobs that interact with physics runtime data (stored in PhysicsWorld) should be scheduled.

### Fixes

* Fixed a bug where duplicate joint Entities were created when multiple joint components are added to the same game object.

### Known Issues

## [Physics Samples Project for 0.6.0-preview.3] - 2021-01-18

### Changes
* Dependencies
  * Updated Data Flow Graph from `0.18.0-preview.3` to `0.19.0-preview.5`
  * Updated DOTS Editor from `0.9.0-preview.1` to `0.12.0-preview.4`
  * Updated Hybrid Renderer from `0.10.0-preview.21` to `0.11.0-preview.40`
* Added `5g. Change Collider Filter` sample showing explosion use case and the importance of collision filters in that case. Setting the force to 0 in `SpawnExplosionAuthoring` causes a performance spike because when the filters get set to default, a lot of bodies are pentetrating each other.

### Fixes

### Known Issues

## [Physics Samples Project for 0.5.1-preview.2] - 2020-10-14

### Changes

* Dependencies
  * Updated Hybrid Renderer from `0.7.0-preview.24` to `0.10.0-preview.21`
  * Updated Data Flow Graph from `0.16.0-preview.3` to `0.18.0-preview.1`
* All demos now have a target frame rate of 60HZ.

### Fixes

### Known Issues

## [Physics Samples Project for 0.5.0-preview] - 2020-09-15

### Changes

* Moved `LimitDOF` joint into core Unity Physics package

### Fixes

* Fixed issue with the `FreeHingeJoint.Create` authoring script not setting the `BodyFrame.PerpendicularAxis`

### Known Issues

* `RaycastCar` demo has issues that sometimes produce NaN values.

## [Physics Samples Project for 0.4.1-preview] - 2020-07-28

### Changes

* Added simple `1b. Respresentations` sample highlighting graphical and physical representations of the world.
* Added simple `1c. Conversion` sample, along with worked examples moving from GameObjects (Data & Logic) to DOTS.
    * New `1c1. GameObjects GravityWell` sample - showing Data conversion working but not Logic conversion.
    * New `1c2. Covertible GravityWell` sample - showing Data & Logic conversion.
    * New `1c3. DOTS GravityWell` sample - showing same scene without GameObject conversion.
* Updated `2a2. Collider Parade - Advanced` sample with extra setup samples involving multiple graphics mesh and/or multiple physics shapes.
* Updated `4. Joints\Ragdoll` demo to use new ragdoll joint interface and allow modification of joint limits.
* Added `5d. Change Velocity` demo showing a local velocity change.
* Added `5f. Change Surface Velocity` sample highlighting a conveyor belt use case with no moving parts.

## [Physics Samples Project for 0.4.0-preview.5] - 2020-06-18

### Changes

* Updated the following packages:
    * Added Data Flow Graph `0.14.0-preview.2`
    * Added DOTS Editor `0.7.0-preview.1`
    * Hybrid Renderer from `0.4.0-preview.8` to `0.5.1-preview.18`
* The `PrismaticJoint` example no longer includes `MinDistanceFromAxis` or `MaxDistanceFromAxis` parameters.
* The `RagdollJoint` example now takes perpendicular limits in the range of (-90, 90) rather than (0, 180).
* Added `5d. Kinematic Motion` to illustrate different ways of moving kinematic bodies.
* Improved usability of trigger events and collision events:
	* Events (StatefulTriggerEvent and StatefulCollisionEvent) have states indicating overlap or colliding state of two bodies:
		* Enter - the bodies didn't overlap or collide in the previous frame, and they do in the current frame
		* Stay - the bodies did overlap or collide in the previous frame, and they do in the current frame
		* Exit - the bodies did overlap or collide in the previous frame, and they do not in the current frame
	* Events (StatefulTriggerEvent and StatefulCollisionEvent) are stored in DynamicBuffers of entities that raise them
	* Reworked following demos to demonstrate new trigger event approach:
		* `2d1a. Triggers - Change Material`
		* `2d1b. Triggers - Portals`
		* `2d1c. Triggers - Force Field`
	* `2d2a. Collision Events - Event States` added to demonstrate new collision event approach.
* Exposed trigger events and collision events of CharacterController
* CharacterController body is now using a `CollisionResponse.None` collision response on its body to avoid reporting duplicated collision/trigger events coming from the physics engine.
* `Demos/2. Setup/2b. Motion Properties/2b1. Motion Properties - Mass`, `Tests/Pyramids` and a group of demos under `Tests/Stacking` now showcase new solver stabilization features/strengths and weaknesses/trade-offs.

## [Physics Samples Project for 0.3.2-preview] - 2020-04-16

### Changes

* Updated the following packages:
    * Removed DOTS Editor
    * Hybrid Renderer from `0.3.4-preview.24` to `0.4.0-preview.8`
    * Input System from `1.0.0-preview.5` to `1.0.0-preview.6`
* Fixed character controller tunnelling issue.
* Made standalone player quit (with exit code 1) if an exception is caught in BasePhysicsDemo or derived classes.

## [Physics Samples Project for 0.3.1-preview] - 2020-03-19

### Changes
* Fixed a potential character controller tunnelling issue.
* Removed the Lightweight RP package.

## [Physics Samples Project for 0.3.0-preview] - 2020-03-12

### Changes

* Joint samples now correctly add new joint entity to prefab's linked entity group so they will be instantiated along with the rest of a prefab.
* Renamed `StiffSpringJoint` to `LimitedDistanceJoint` to reflect changes in API.
* Updated the following packages
    * Input System from `0.9.6-preview` to `1.0.0-preview.5`
    * Lightweight RP from `7.1.6` to `7.1.7`
    * DOTS Editor from `0.2.0-preview` to `0.3.0-preview`
    * Hybrid Renderer from `0.3.3-preview.11` to `0.3.4-preview.24`
* Character controller improvements
    * `CharacterControllerUtilities.CheckSupport()` now uses a collider cast
    * Character now doesn't collide with triggers, but raises trigger events instead
    * Fixed the support check issue with slopes equal to MaxSlope
    * Fixed the returned support state when there are no supporting planes

## [Physics Samples Project for 0.2.5-preview] - 2019-12-04

### Changes
* Added `CharacterControllerAuthoring.MaxMovementSpeed` to avoid large velocities coming from penetration recovery.
* Improved the behavior of character controller walking on multiple objects or mesh triangles:
    * Fixed the problems with losing support state
    * Fixed the problems with being unstable due to interaction with steep slopes
    * Improved penetration recovery
* Character controller is now using native lists instead of native arrays for constraints and query hits to avoid large preallocations.
* Planet gravity sample now correctly randomizes mass of orbiting bodies.

## [Physics Samples Project for 0.2.4-preview] - 2019-09-19

### Changes

* Fixed the issue with collider cast in character controller assuming ordered hits, potentially tunneling through objects.
* When opening the Project with Unity `2019.3` below `0b5` it might be required to update the *Lightweight RP* package (com.unity.render-pipelines.lightweight) to version `7.0.1`  and reimport the `Assets/Common` folder.


## [Physics Samples Project for 0.2.2-preview] - 2019-09-06

### Changes

* Character controller changes include:
    - Character controller demo scenes merged into single scene.
    - Character controller can now use any collision filter, as opposed to previously being forced to set it to 'Nothing'.
    - Default max slope to climb is now 60 degrees.
    - Character controller can now use any collider, instead of previously being forced to use capsule.
    - Fixed a race condition problem with scheduling character controller jobs when their data is in multiple chunks.
    - Simple collisions between characters are now supported (not going through each other).
    - KeepDistance with a default of 2cm has been added to avoid character getting stuck in narrow passages.
    - User input is now projected onto supporting surface, incorporating its velocity into input.
    - CharacterControllerUtilities.CheckSupport() has been deprecated. Use the new CheckSupport() method that outputs the surface info.
    - CharacterControllerUtilities.CollideAndIntegrate() has been deprecated. Use the new CollideAndIntegrate() method that takes numConstraints as input.
* Menu loader scene now supports keyboard and controller input. Controller input now maps correctly across platforms. Controls have been updated to the following:
    * Keyboard/Mouse
        * UI:
            * Arrow keys to navigate
            * [Return] to select
        * Character Controller
            - [WASD] to move
            - Mouse look
            - [Space] to jump
            - [LMB/Ctrl] to shoot
        * Vehicle
            - [WS] to accelerate/decelerate
            - [AD] to steer
            - [Left/Right] arrows to look
            - [Left/RightBracket] to switch cars
    * Controller:
        * UI
            * D-Pad to navigate
            * [West] to select
        * Character Controller
            - Left Stick to move
            - Right Stick look
            - [South] to jump
            - [Right Trigger] to shoot
        * Vehicle
            - [Left/Right Trigger] to accelerate/decelerate
            - Left Stick to steer
            - Right Stick arrows to look
            - [Left/Right Bumper] to switch cars

### Opening the Project with different Unity Editor versions

* To open the project with Unity `2019.3.0b1` or later, it is currently required to upgrade the following packages:
   - *Hybrid Renderer* (com.unity.rendering.hybrid) has to be upgraded to `0.1.1-preview`
   - *Lightweight RP* (com.unity.render-pipelines.lightweight) has to be updated to version `7.0.1`
   - A reimport of the materials might be required when this is done while the Unity Editor is opened.


## [Physics Samples Project for 0.2.0-preview] - 2019-07-18

### Changes

* `5a. Change Motion Type` demo illustrating how to swap the motion type of a rigid body.
* `5b. Change Collider Size` demo shows how to dynamically resize a sphere collider.
* `5c. Change Collider Type` demo shows a body's collider changing between a cube and a sphere.
* Removed `4c. Newton's Cradle` demo
* Removed `4d. Abacus` demo
* Added a loader scene to more easily test all examples on a device.


## [Physics Samples Project for 0.1.0-preview] - 2019-05-31

### Changes

* `1. Hello World` now uses convex hulls for letters.
* `2b1. Motion Properties - Mass` shows a number of seesaws in anticipation of future stacking improvements.
* `2b6. Motion Properties - Inertia Tensor` adds an example of infinite mass dynamic objects - i.e lock rotations.
* `2c2. Material Properties - Restitution` shows the changes to the restitution model, with complex bodies bouncing more with high restitution values.
* `2c3. Material Properties - Collision Filters` shows the filtering setup between potentially colliding objects
* `2d1. Events - Triggers` shows a simple trigger use case that changes a bodies gravity fractor when inside the volume.
    - The more advanced trigger use cases capture state such as Entering, Overlapping and Leaving a trigger volume.
    - `2d1. Triggers - Change Material` shows set of triggers that change a bodies material when they enter the trigger volume.
    - `2d2. Triggers - Portals` shows set of triggers that transform a body to a new location and orientation while preserving local velocity.
    - `2d3. Triggers - Force Field` shows a trigger volume acting and a tornado moving through the world.
* `2d2. Events - Contacts` shows a simple collision event used to apply an impulse to any body colliding with the tagged 'repulsor' body.
* `4a. Joints Parade` demo shows the Prismatic Joint now locks rotation.
* `4b. Limit DOF` demo shows the new Limit DOF Joint, locking body rotation and translation to various axes.
* `4c. Newton's Cradle` demo shows how to cheat collision response to create a desktop toy.
* `4d. Abacus` shows a desktop toy as an extreme test of the Limit DOF Joint.
* `5. Modify` demos have been changed to use the new jobify approach to modifying simulation data.

* Mouse Pick Behavior now ignores Static and Trigger bodies, illustrating a custom hit collector.
* Joint Editors now lock the connected body offset to the local offsets, as suggested by the UI.
* Debug Display changes include:
    - Colliders are displayed as solid.
    - Collider Edges can be display independent of solid Colliders.
    - Trigger events draw connecting line between overlapping bodies.
    - Collision events draw impulse half-way between colliding bodies.

* Various tests have been added to confirm API changes and as comparisons for WIP and the upcoming Havok Physics release.


## [Physics Samples Project for 0.0.2-preview] - 2019-04-08

### Changes

* Character controller now has a max slope constraint to avoid climbing slopes that are too steep.
* Character controller now does another query to check if position returned by the solver can be reached.


## [Physics Samples Project for 0.0.1-preview] - 2019-03-12

* Initial package version and sample project.


## Links discovered
- [Ragdoll Wizard](https://docs.unity3d.com/Manual/wizard-RagdollWizard.html)
- [Stateful](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/Assets/Demos/2.%20Setup/2d.%20Events/Scripts/Stateful.md)

--- README.md ---

*The sample projects in this repo use Unity 6.2 and the 1.4 releases of the `Entities`, `Netcode`, `Physics`, and `Entities.Graphics` packages.*

# DOTS Samples

The DOTS package sample projects contain many small samples that cover most of the functionality in the packages:

- [Entities samples](./EntitiesSamples/README.md)
- [Physics samples](./PhysicsSamples/README.md)
- [Netcode samples](./NetcodeSamples/README.md)
- [Entities.Graphics HDRP samples](./GraphicsSamples/HDRPSamples/README.md)
- [Entities.Graphics URP samples](./GraphicsSamples/URPSamples/README.md)

For those new to DOTS, we recommend starting with the DOTS 101 sample projects and materials below:

## The Job System 101

- [Document: Unity Job System 101](https://docs.google.com/document/d/1gtXwUwsuQTfpBUmdFd5ieZaL7v3UdYTKq9H5P0M57Mg/edit?usp=sharing)
- [Sample project: Unity Job System 101](./Dots101/Jobs101/)
- [Video: The C# Job system](https://youtu.be/jdW66hA-Qu8) (11 minutes)
- [Video: Walkthrough of the jobs sample](https://youtu.be/oOgNg2gL2yw) (17 minutes)

## Entities 101

- [Document: Unity Entities 101](https://docs.google.com/document/d/1R6E4IDpfLatwHITlCND0i5TuMVG0CMGsentFL-3RQT0/edit?usp=sharing)
- [Sample project: Unity Entities 101](./Dots101/Entities101/)
- [Video: ECS Entities and components](https://youtu.be/jzCEzNoztzM) (10 minutes)
- [Video: ECS Systems](https://youtu.be/k07I-DpCcvE) (7 minutes)
- [Video: ECS Baking](https://youtu.be/r337nXZFYeA) (6 minutes)
- [Video: HelloCube samples](https://youtu.be/32TLgtA9yUM) (30 minutes) ([code](./Dots101/Entities101/Assets/HelloCube/)) 
- [Video: Kickball sample](https://youtu.be/P6_3L7RTcm0) (55 minutes) ([code](./Dots101/Entities101/Assets/Kickball/)) 
- [Video: StateChange sample](https://youtu.be/KC-EyCh5TrY) (14 minutes) ([code](./Dots101/Entities101/Assets/HelloCube/14.%20StateChange/)) 

Additional Entities material on Unity Learn:

- [Tanks tutorial](https://learn.unity.com/tutorial/65b3e48fedbc2a611fc291a7) and [walkthrough video](https://youtu.be/jAVVxoWU5lo) (23 minutes)
- [DOTS Bootcamp](https://learn.unity.com/tutorial/dots-bootcamp) ([code](./Dots101/Entities101/Assets/Firefighters/README.md))

## Physics 101

- [Document: Unity Physics 101](https://docs.google.com/document/d/1nHJoDBetbrmvO-KsOJ2S_p0tJI2UzRrp6T3oZSPoyg8/edit?usp=sharing)
- [Sample project: Unity Physics 101](./Dots101/Physics101/)
- [Video: Physics 101](https://youtu.be/EGcHDZeDTtA)

## Netcode 101

- [Document: Unity Netcode for Entities 101](https://docs.google.com/document/d/17AYh_Lc7Phgtg66sX9TrSrtCS7PZn0y-XuVL2A6cXCw/edit?usp=sharing)
- [Sample project: Unity Netcode for Entities 101](./Dots101/Netcode101/)
- [Video: Netcode 101](https://youtu.be/f-4NR30ieWg)

## Other samples

- [Sample project: DOTS UI](./Dots101/OtherSamples/DotsUI/Assets/README.md): Demonstrates the use of UI Toolkit in an ECS context.
- [Video: DOTS UI (walkthrough)](https://youtu.be/72EaJ1OW9Nw)
- [Sample project: Content Management 101](./Dots101/ContentManagement101/README.md): A starter example of how to use the Content Management API.
- [Sample project: ECS Network Racing](https://github.com/Unity-Technologies/ECS-Network-Racing-Sample): A small DOTS game using Netcode for Entities and Unity Physics.

## Additional material 

- [Document: Introduction to DOTS Ebook](https://unity.com/resources/introduction-to-dots-ebook)
- [Document: Misconceptions about DOTS and Entities](https://docs.google.com/document/d/18hFIQipNxTsKsWk9eRroRwkGgswWs6m40X8N4Kkjhy4/edit?usp=sharing)
- [Document: Performance checklist](https://docs.google.com/document/d/1QQZz6xzmWpe6NMdL3t2o7RXmya6UFyl_Xgo3KPfGxzQ/edit?usp=sharing)
- [Cheat sheet: collections](./EntitiesSamples/Docs/cheatsheet/collections.md)
- [Cheat sheet: mathematics](./EntitiesSamples/Docs/cheatsheet/mathematics.md)

## Package manuals

- [Entities manual and API reference](https://docs.unity3d.com/Packages/com.unity.entities@latest/)
- [Collections manual and API reference](https://docs.unity3d.com/Packages/com.unity.collections@latest/)
- [Burst manual and API reference](https://docs.unity3d.com/Packages/com.unity.burst@latest/)
- [Mathematics manual and API reference](https://docs.unity3d.com/Packages/com.unity.mathematics@latest/)
- [Job system manual](https://docs.unity3d.com/Manual/JobSystem.html)




## Links discovered
- [Entities samples](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/README.md)
- [Physics samples](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/README.md)
- [Netcode samples](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/NetcodeSamples/README.md)
- [Entities.Graphics HDRP samples](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/GraphicsSamples/HDRPSamples/README.md)
- [Entities.Graphics URP samples](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/GraphicsSamples/URPSamples/README.md)
- [Document: Unity Job System 101](https://docs.google.com/document/d/1gtXwUwsuQTfpBUmdFd5ieZaL7v3UdYTKq9H5P0M57Mg/edit?usp=sharing)
- [Sample project: Unity Job System 101](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101.md)
- [Video: The C# Job system](https://youtu.be/jdW66hA-Qu8)
- [Video: Walkthrough of the jobs sample](https://youtu.be/oOgNg2gL2yw)
- [Document: Unity Entities 101](https://docs.google.com/document/d/1R6E4IDpfLatwHITlCND0i5TuMVG0CMGsentFL-3RQT0/edit?usp=sharing)
- [Sample project: Unity Entities 101](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101.md)
- [Video: ECS Entities and components](https://youtu.be/jzCEzNoztzM)
- [Video: ECS Systems](https://youtu.be/k07I-DpCcvE)
- [Video: ECS Baking](https://youtu.be/r337nXZFYeA)
- [Video: HelloCube samples](https://youtu.be/32TLgtA9yUM)
- [code](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/HelloCube.md)
- [Video: Kickball sample](https://youtu.be/P6_3L7RTcm0)
- [code](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball.md)
- [Video: StateChange sample](https://youtu.be/KC-EyCh5TrY)
- [code](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/HelloCube/14.%20StateChange)
- [Tanks tutorial](https://learn.unity.com/tutorial/65b3e48fedbc2a611fc291a7)
- [walkthrough video](https://youtu.be/jAVVxoWU5lo)
- [DOTS Bootcamp](https://learn.unity.com/tutorial/dots-bootcamp)
- [code](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Firefighters/README.md)
- [Document: Unity Physics 101](https://docs.google.com/document/d/1nHJoDBetbrmvO-KsOJ2S_p0tJI2UzRrp6T3oZSPoyg8/edit?usp=sharing)
- [Sample project: Unity Physics 101](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Physics101.md)
- [Video: Physics 101](https://youtu.be/EGcHDZeDTtA)
- [Document: Unity Netcode for Entities 101](https://docs.google.com/document/d/17AYh_Lc7Phgtg66sX9TrSrtCS7PZn0y-XuVL2A6cXCw/edit?usp=sharing)
- [Sample project: Unity Netcode for Entities 101](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Netcode101.md)
- [Video: Netcode 101](https://youtu.be/f-4NR30ieWg)
- [Sample project: DOTS UI](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/OtherSamples/DotsUI/Assets/README.md)
- [Video: DOTS UI (walkthrough)](https://youtu.be/72EaJ1OW9Nw)
- [Sample project: Content Management 101](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/README.md)
- [Sample project: ECS Network Racing](https://github.com/Unity-Technologies/ECS-Network-Racing-Sample)
- [Document: Introduction to DOTS Ebook](https://unity.com/resources/introduction-to-dots-ebook)
- [Document: Misconceptions about DOTS and Entities](https://docs.google.com/document/d/18hFIQipNxTsKsWk9eRroRwkGgswWs6m40X8N4Kkjhy4/edit?usp=sharing)
- [Document: Performance checklist](https://docs.google.com/document/d/1QQZz6xzmWpe6NMdL3t2o7RXmya6UFyl_Xgo3KPfGxzQ/edit?usp=sharing)
- [Cheat sheet: collections](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/cheatsheet/collections.md)
- [Cheat sheet: mathematics](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Docs/cheatsheet/mathematics.md)
- [Entities manual and API reference](https://docs.unity3d.com/Packages/com.unity.entities@latest/)
- [Collections manual and API reference](https://docs.unity3d.com/Packages/com.unity.collections@latest/)
- [Burst manual and API reference](https://docs.unity3d.com/Packages/com.unity.burst@latest/)
- [Mathematics manual and API reference](https://docs.unity3d.com/Packages/com.unity.mathematics@latest/)
- [Job system manual](https://docs.unity3d.com/Manual/JobSystem.html)

--- Dots101/ContentManagement101/README.md ---
<img src="Images/Header.gif" alt="header" height="500"/>

# Content Management

The Entities package's Content Management API allows you to download, load, and unload Unity assets and sub-scenes at runtime.<br>
This sample project demonstrates the basic APIs for Weak References you need for a few use cases:

- Loading alternate meshes and materials through the **local content** workflow.
- Showcases downloading, loading, and unloading scenes at runtime using both **local and remote content pipelines**.

    | Content Type          | Advantages                                                                                           | Disadvantages                                                                                                   |
    |-----------------------|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
    | **Local Content**     | - Provides fallback even when remote content is unreachable.<br>- No preload required.               | - Increases overall build size.<br>- Updating even a single reference requires rebuilding the entire player.    |
    | **Remote Content**    | - Reduces build size.<br>- Allows updating content without rebuilding the player.                    | - No fallback files unless previously cached.<br>- Requires an initial download before use.                     |
    |                                                                                                                                                                                                                                                |


For more detailed information, refer to the Entities documentation on [Content management](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/manual/content-management.html).

## Getting Started
- See [ProjectVersion.txt](./ProjectSettings/ProjectVersion.txt) for the minimum supported Unity version.<br>
    This project currently targets [Unity 6](https://unity.com/releases/editor/whats-new/6000.2.6#installs).
- Open the 1. WeakObjectLoading/WeakObjectLoading.scene file to begin exploring the project.
- Navigate to **File > Build Profiles**, or press **Ctrl + Shift + B / Cmd + Shift + B**, to **activate** the [Platform] WeakObjectLoading or [Platform] WeakSceneLoading build profile.
---

| Section | Description |
|---------|-------------|
| [Running and Building Sample Scenes](#running-and-building-the-sample-scenes) | Instructions to switch build profiles and run sample scenes in Unity Editor. |
| [Scripting Define Symbols](#scripting-define-symbols-for-content-management) | Steps to enable content delivery and debug symbols via project settings. |
| [Strong vs Weak References](#strong-vs-weak-references) | Explanation of strong references versus weak references and their runtime behavior. |
| [Weakly Referencing an Object](#weakly-referencing-an-object) | Guide for using `WeakObjectReference<T>` and `UntypedWeakReferenceId` to load meshes and materials at runtime. |
| [WeakObjectReference](#weakobjectreference) | Code snippet for checking and loading typed weak references. |
| [UntypedWeakReferenceId](#untypedweakreferenceid) | Code snippet for checking and loading untyped weak references. |
| [Weakly Referencing a Scene](#weakly-referencing-a-scene) | Overview of loading subscenes through weak references with local or remote content options. |
| [Steps to Load Remote Subscenes (Option 1)](#steps-to-load-remote-subscenes-option-1) | Step-by-step for building player with subscene references packed locally. |
| [Behavior in the Unity Editor](#behavior-in-the-unity-editor) | Explanation of low-fidelity and high-fidelity scene toggling in the Editor. |
| [Weak Scene References](#weak-scene-references) | Using `UntypedWeakReferenceId` and `WeakObjectSceneReference` to weakly reference scenes. |
| [Building the Player](#building-the-player) | Instructions to include subscene references in the player build for local content. |
| [Steps to Load Remote Subscenes (Option 2)](#steps-to-load-remote-subscenes-option-2) | Instructions to load content remotely by building separate subscene references. |
| [Build Content Catalog](#build-content-catalog) | How to generate and publish content catalog using `RemoteContentCatalogBuildUtility`. |
| [StreamingAssets Paths](#streamingassets-paths-in-unity) | Platform-specific paths where `StreamingAssets` is stored for Windows, macOS, Android, and iOS. |
| [Serving a Catalog from a Web Server](#serving-a-catalog-from-a-web-server) | Instructions to serve a content catalog from a remote web server for runtime loading. |

## Running and building the sample scenes

Before running or building each sample scene in the editor, you may need to switch the active build profile. For example, before running the WeakObject scene, you should:

1. Open the File > Build Profiles menu
1. Set the active build profile to  "Windows WeakObject" (or "Mac WeakObject" if you're on Mac).

## Scripting define symbols for content management

To enable content delivery in a project, the project must have the scripting define symbol `ENABLE_CONTENT_DELIVERY`. <br>
For more detailed content management debug messages, you can also add the scripting define symbols `ENABLE_CONTENT_DIAGNOSTICS` and `ENABLE_CONTENT_BUILD_DIAGNOSTICS`.<br>
To set or remove define symbols:

1. Go to **Edit > Project Settings > Player**.
1. Select **Player** in the sidebar.
1. Navigate to **Other Settings > Script Compilation**.

Each Profile asset includes a Scripting Define Symbols section, where you can directly set the scripting defines associated with that profile.

<img src="Images/scripting-define-symbols.png" alt="define-scripting-symbols"  width="600"/>

For more information on scripting defines, refer to [Custom scripting symbols](https://docs.unity3d.com/Manual/custom-scripting-symbols.html).

## Strong vs weak references

When an asset is directly assigned to a property of a GameObject component, this creates a "strong reference". For example, if you set a mesh filter component to directly reference a mesh asset, the mesh asset is strongly referenced by the mesh filter.<br>
At runtime, Unity automatically loads strongly-referenced objects when they're required and unloads them when they're no longer needed. Effectively, when you access an object *via* a strong reference, you can assume that it is always in memory and ready-to-use.<br>
For example, all the assets in the subscene below are strongly referenced:

<img src="Images/strongly-reference.png" desc="The assets in this subscene are strongly referenced." width="600"/>

In contrast, when you access an object *via* a weak reference, the object may not necessarily loaded and ready for use.<br>
Therefore, you must always check if a weakly-referenced object is actually loaded and ready, and if not, you must trigger the load and then wait for it to be ready before using it.<br>

Although weak references impose more hassle, they allow for more flexiblity. For example, a weak reference can point to assets which have yet to be loaded from disk or perhaps haven't even been downloaded yet to the local system. <br>
The Content Management API allows you to reference assets that are not included in your build by using weak references.<br>

## Weakly referencing an object

The *WeakObjectLoading* scene demonstrates how to load objects through weak references. When you play the scene, a system loads the weakly referenced meshes and materials from local path.<br>
This is done by calling `RuntimeContentSystem.LoadContentCatalog(null, null, null, true)` ([see WeakObjectLoadingSystem.cs](Assets/1.%20WeakObjectLoading/WeakObjectLoadingSystem.cs)), which downloads all asset references from the `StreamingAssets` folder at runtime and creates rendered entities after loading completes.

To weakly reference objects like meshes and materials, we need either:

- `UntypedWeakReferenceId`, which stores a global id of a Unity object
-  `WeakObjectReference<T>`, a wrapper around `UntypedWeakReferenceId` where T is a type of Unity object

In general, `WeakObjectReference<T>` is preferred except in cases where we need a weak reference that can vary the type of referenced object. This sample demonstrates use of both.

In the `WeakObjectLoading.unity` scene, a tree GameObject and house GameObject both have the [WeakRenderedObjectAuthoring](Assets/1.%20WeakObjectLoading/WeakRenderedObjectAuthoring.cs) component. If the authoring component's `UseUntypedId` flag is set, its baker adds:

- `WeakMeshUntyped`, an `IComponentData` storing a `UntypedWeakReferenceId` for a mesh
- `WeakMaterialUntyped`, an `IBufferElementData` storing a `UntypedWeakReferenceId` for a material

If the `UseUntypedId` flag is unset, the baker instead adds:

- `WeakMesh`, an `IComponentData` storing a `WeakObjectReference<Mesh>`
- `WeakMaterial`, an `IBufferElementData` storing a `WeakObjectReference<Material>`

> NOTE: The materials are stored in a dynamic buffer because a single rendered mesh may have multiple materials, as is the case for the tree and house in this example.

The [WeakObjectLoadingSystem](Assets/1.%20WeakObjectLoading/WeakObjectLoadingSystem.cs) system looks for these weak reference components, loads the weakly referenced assets, and then adds the components that make the entity renderable. <br>
In the system's `OnUpdate`, here's the code that processes the typed weak references, please review `WeakObjectReference` and `UntypedWeakReferenceId` regions in the system to validate the different uses.

### WeakObjectReference
```csharp
#region WeakObjectReference
// mesh load status
var meshStatus = mesh.Value.LoadingStatus;
if (meshStatus == ObjectLoadingStatus.None)
{
    Debug.Log("Initiate mesh LOAD");
    mesh.Value.LoadAsync(); // trigger load
}
if (meshStatus != ObjectLoadingStatus.Completed)
{
    loaded = false;
}
#endregion
```

### UntypedWeakReferenceId
```csharp
#region WeakObjectReference
// mesh load status
var meshStatus = RuntimeContentManager.GetObjectLoadingStatus(mesh.Value);
if (meshStatus == ObjectLoadingStatus.None)
{
    RuntimeContentManager.LoadObjectAsync(mesh.Value);  // trigger load
}
if (meshStatus != ObjectLoadingStatus.Completed)
{
    loaded = false;
}
#endregion
```

> **Note** that this uses a local setup, which automatically retrieves assets from the StreamingAssets folder generated during the build process and loads them at runtime. <br>
> For further information please review the [documentation](https://docs.unity3d.com/Packages/com.unity.entities@1.4/manual/content-management-load-an-object.html) for this section.

## Weakly referencing a scene

The *WeakSceneLoading* sample scene demonstrates how to load scenes through weak references. 
Additionally, there are two paths to accomplish this:  

- **Option 1:** Build the project normally and pack all references inside the `StreamingAssets` folder during the project build.
- **Option 2:** Build separate subscene references to download content remotely.  

### Steps to Load Remote Subscenes (Option 1)
1. **Configure Target:**  
   Navigate to  
   ```
   /Assets/2. WeakSceneLoading/Content Settings/WeakSceneList.asset
   ```  
   Add the desired subscenes and set their `Content Source` parameter to **Local**. This will assign the right component to the Entity in the Scene.

2. **Target the local content catalog:**  
   Similar to the WeakObject sample, call  
   ```csharp
   RuntimeContentSystem.LoadContentCatalog(null, null, null, true);
   ```  
   In the project, the script [`Assets/1. WeakObjectLoading/LoadingLocalCatalogSystem.cs`] automatically does this once there is an entity with a `LocalContent` component attached.  

---

### Behavior in the Unity Editor

When you play the sample scene, a low-fidelity version of the environment scene `Assets/2. WeakSceneLoading/Subscenes/LowFidelitySubscene.unity`  is loaded by the `WeakSceneLoadingSystem` once the `LoadingLocalCatalogSystem` has set the catalog source to **local** and created the `ContentReady` entity.<br>  Pressing **Enter** toggles between the low-fidelity version and a high-fidelity version of the scene: `Assets/2. WeakSceneLoading/Subscenes/HighFidelitySubscene.unity`

> **Note:** Both the low- and high-fidelity scenes are baked entity subscenes. However, the solution presented here also works for regular GameObject scenes that are weakly referenced.

---

### Weak Scene References

To weakly reference a scene, you can use either:

- `UntypedWeakReferenceId` — stores a global ID of a Unity object, such as a scene or mesh.  
- `WeakObjectSceneReference` — a wrapper around `UntypedWeakReferenceId` specifically for scenes only.

Generally, `WeakObjectSceneReference` is preferred unless a weak reference of varying object types is needed.  
This sample demonstrates the use of both `UntypedWeakReferenceId` and `WeakObjectSceneReference`.

In [`WeakSceneAuthoring.cs`](Assets/2.%20WeakSceneLoading/WeakSceneAuthoring.cs), the baker adds an `IComponentData` named `HighLowWeakScene`, which stores:

- The high-fidelity scene in an `UntypedWeakReferenceId`
- The low-fidelity scene in a `WeakObjectSceneReference`

When a scene is weakly referenced in a build, the original GameObject scene and its assets are still included in the build. To include the baked entity scenes in the build, we nest them as subscenes in another scene, "ContainerScene", which we include in the scene list of the sample's build profile.

---

### Building the Player

When building the player, make sure to include subscene references.  
In the sample, there is a scene named `ContainerScene` which references both `LowFidelitySubscene` and `HighFidelitySubscene`.  

During the build process, Unity includes these references and packs them into the **StreamingAssets** folder for the player.

<img src="Images/build-profile.png" desc="The scene contains needed subscenes to be built in the player." width="600"/>

### Steps to Load Remote Subscenes (Option 2)

Before loading remote subscenes, perform the following steps:

1. **Set scripting define:**  
   Define the [Scripting Define Symbols for Content Management](#scripting-define-symbols-for-content-management) in the Build Profile.
2. **Configure Target:**  
   Navigate to  
   ```
   /Assets/2. WeakSceneLoading/Content Settings/WeakSceneList.asset
   ```  
   Add the desired subscenes and set their `Content Source` parameter to **Remote**, keeping it selected in the Editor.
3. **Build content catalog:**  
   Open the menu `Assets > Publish > Publish Catalog from a WeakSceneListScriptableObject` and build the content.

4. **Target the remote content catalog:**  
   In the project, the script [`Assets/2. WeakSceneLoading/LoadingRemoteCatalogSystem.cs`] initializes the content according to the parameters.<br>
   Please review it carefully [LoadingRemoteCatalogSystem](Assets/2.%20WeakSceneLoading/LoadingRemoteCatalogSystem.cs) to check how to use it.

---

### Build content catalog
Since the Content Management API depends on subscenes, you can create content and references directly from them.  
Please review the [`ContentBuilder`](Assets/2.%20WeakSceneLoading/Content%20Settings/Editor/ContentBuilder.cs) script to see how the content build process above works.

The content can be generated by filling the following function parameters as needed:

```csharp
// Builds the subscenes and stores them in tempPath 
RemoteContentCatalogBuildUtility.BuildContent(
    subSceneGuids,
    playerGuid,
    EditorUserBuildSettings.activeBuildTarget,
    tempPath
);

// Copies from tempPath to the target folder and renames assets using their content hashes  
RemoteContentCatalogBuildUtility.PublishContent(
    tempPath,
    contentPath,
    f => new string[] { contentSetName }
);
```

---

### Weak Scene References

The [WeakSceneLoadingSystem](Assets/2.%20WeakSceneLoading/WeakSceneLoadingSystem.cs) system will initially load the low-fidelity scene:

```csharp
var weakScene = SystemAPI.GetSingletonRW<WeakSceneRefs>();

var sceneParams = new Unity.Loading.ContentSceneParameters
{
    loadSceneMode = UnityEngine.SceneManagement.LoadSceneMode.Additive,
    autoIntegrate = true,
};

// initial load of the low-fidelity scene
// (we store the loaded Scene object 
// so that we can later unload the scene)
weakScene.ValueRW.Scene = 
    weakScene.ValueRW.LowSceneRef.LoadAsync(sceneParams);
```

When the user hits the enter key, the system unloads the current scene and loads the other scene:

```csharp
// toggle between the two scenes
if (weakScene.ValueRO.IsHighLoaded)
{
    // unload high fidelity
    RuntimeContentManager.UnloadScene(ref weakScene.ValueRW.Scene);
    
    // load low fidelity
    weakScene.ValueRW.Scene = 
        weakScene.ValueRW.LowSceneRef.LoadAsync(sceneParams);
    
    weakScene.ValueRW.IsHighLoaded = false;
}
else
{
    // unload low fidelity
    // (UntypedWeakReferenceId does not have this Unload method, but
    // this method simply calls RuntimeContentManager.UnloadScene, 
    // so you could alternatively call it yourself directly)
    weakScene.ValueRO.LowSceneRef.Unload(ref weakScene.ValueRW.Scene);
    
    // load high fidelity
    weakScene.ValueRW.Scene = RuntimeContentManager.LoadSceneAsync(
        weakScene.ValueRO.HighSceneRef, sceneParams);
    
    weakScene.ValueRW.IsHighLoaded = true;
}
```
---
### Building the Player for Remote

Unlike the [local content build](#steps-to-load-remote-subscenes-option-1), the player does **not** need to include the subscene references that were already packaged during the [catalog build process](#build-content-catalog).  

<img src="Images/build-profile-remote.png" desc="The scene contains needed subscenes to be built in the player." width="600"/>

> **Note:**  
> Building this way results in a smaller player build size.  
> However, there will be no fallback data if the remote path becomes unreachable.  
> To ensure content can always be loaded, whether or not the remote source is accessible, embed the content in `StreamingAssets` using a reference scene, similar to the [Local content approach](#building-the-player).
> Otherwise, if you are prioritzing build size go with the approach explaining in [remote content section](#building-the-player-for-remote).


## Downloading and Loading Scenes at Runtime

After building the player, all dependency data, object references, and scene references are stored in the `StreamingAssets` folder (also referred to as **local content** in the sample). <br>The exact path of this folder varies by platform, but it is always included as part of the player build.<br>
Inside this folder, there is a list of generated folders similar to the following:

<img src="Images/streamingassets.png" desc="The scene contains needed subscenes to be built in the player." width="600"/><br>
<img src="Images/local-content-archives.png" desc="The scene contains needed subscenes to be built in the player." width="600"/><br>
<img src="Images/local-content-entitiescenes.png" desc="The scene contains needed subscenes to be built in the player." width="600"/><br>


---

If the project is configured to use remote content, the generated folders will look similar to the following:

<img src="Images/catalog.png" desc="The scene contains needed subscenes to be built in the player." width="600"/><br>

### StreamingAssets Paths in Unity

This document outlines where Unity places the **`StreamingAssets`** folder for each supported platform after building a player.

- **Windows (Standalone Player)**
  ```
  <BuildFolder>/<GameName>_Data/StreamingAssets/
  ```

- **macOS (Standalone Player)**
  ```
  <AppName>.app/Contents/Resources/Data/StreamingAssets/
  ```

- **Android**  
  Unity packs `StreamingAssets` inside the **`assets`** folder in the APK.
  ```
  assets/
  ```
    Runtime access path (read-only):
    ```
    jar:file://<path_to_apk>!/assets/
    ```
    When using Unity’s API:  
    ```csharp
    Application.streamingAssetsPath
    // Typically resolves to:
    // jar:file:///data/app/com.company.mygame/base.apk!/assets
    ```

- **iOS**  
  ```
  <AppName>.app/Data/Raw/
  ```
    Runtime access path (via API):
    ```csharp
    Application.streamingAssetsPath
    // Typically resolves to:
    // /var/containers/Bundle/Application/<GUID>/MyProject.app/Data/Raw
    ```

---
>Note:Please review the  [Postprocessing build script](Assets/2.%20WeakSceneLoading/Content%20Settings/Editor/BuildPostProcessing.cs)(`Assets\2. WeakSceneLoading\Content Settings\Editor\BuildPostProcessing.cs`). 
>It includes a simple example of how to filter and remove duplicate dependencies based on Catalog and StreamingAsset folders. 

### Serving a catalog from a web server

In real use cases, a catalog is not stored on the same local machine as the player but rather served from a web server. With Python, for example, this can be as simple as running `python3 -m http.server --directory /path/to/your/catalog 8000` on the server. In your Unity project, you then pass the URI of the server instead of a file path to `RuntimeContentSystem.LoadContentCatalog`, *e.g.* `https://example.com:8000`.











## Links discovered
- [Content management](https://docs.unity3d.com/Packages/com.unity.entities@latest/index.html?subfolder=/manual/content-management.html)
- [ProjectVersion.txt](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/ProjectSettings/ProjectVersion.txt)
- [Unity 6](https://unity.com/releases/editor/whats-new/6000.2.6#installs)
- [Custom scripting symbols](https://docs.unity3d.com/Manual/custom-scripting-symbols.html)
- [see WeakObjectLoadingSystem.cs](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/1.%20WeakObjectLoading/WeakObjectLoadingSystem.cs)
- [WeakRenderedObjectAuthoring](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/1.%20WeakObjectLoading/WeakRenderedObjectAuthoring.cs)
- [WeakObjectLoadingSystem](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/1.%20WeakObjectLoading/WeakObjectLoadingSystem.cs)
- [documentation](https://docs.unity3d.com/Packages/com.unity.entities@1.4/manual/content-management-load-an-object.html)
- [`WeakSceneAuthoring.cs`](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/2.%20WeakSceneLoading/WeakSceneAuthoring.cs)
- [LoadingRemoteCatalogSystem](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/2.%20WeakSceneLoading/LoadingRemoteCatalogSystem.cs)
- [`ContentBuilder`](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/2.%20WeakSceneLoading/Content%20Settings/Editor/ContentBuilder.cs)
- [WeakSceneLoadingSystem](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/2.%20WeakSceneLoading/WeakSceneLoadingSystem.cs)
- [Postprocessing build script](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/ContentManagement101/Assets/2.%20WeakSceneLoading/Content%20Settings/Editor/BuildPostProcessing.cs)

--- Dots101/Entities101/Assets/Firefighters/README.md ---
# Entities Tutorial: Firefighters

A fire spreads across a field, and bots form bucket brigade lines to douse the fire.

![](Common/firefighters.png)

# Step 1: Spawning

This step sets up the core data and spawns the field, the bots, the ponds of water around the field, and the buckets on the field.

# Step 2: Fire simulation

This step adds code to spread the fire. Three solutions are demonstrated:

- A single-threaded solution running on the main thread.
- A single-threaded solution running in a job.
- A parallel-threaded solution running in a job.

# Step 3: Bot behaviour

This step adds behiour to the bots, who are organized into teams. Each team forms a line between a pond and the closest fire. A bucket is filled at the pond and then passed up the line.

# Step 4: Animation and UI

This step replaces the bot capsules with animated characters. A UI HUD element displays the total count of fires that have been doused. Clicking a HUD button triggers repositioning of the bucket brigade lines.

--- Dots101/Entities101/Assets/HelloCube/README.md ---
# HelloCube samples

[Video: Entities "HelloCube" samples walkthrough](https://youtu.be/32TLgtA9yUM) (30 minutes)

*These very simple samples demonstrate the basic elements of the Entities API.*

## MainThread sample

The sample rotates two cubes, a parent and its child. 

The larger cube has a `RotationSpeedAuthoring` MonoBehavior, which adds a `RotationSpeed` IComponentData to the entity in baking. At runtime, the `RotationSpeedSystem` spins all entities having the `RotationSpeed` component (in this case, just the single parent cube).

## IJobEntity sample

This sample is the same as "MainThread", except the `RotationSpeedSystem` now uses a job (an `IJobEntity`) to spin the cubes instead of doing so directly on the main thread. Also, the Y-axis scale of the cube is fluctuated between 1 and -1 by setting the cube's `PostTransformMatrix` component. 

## Prefabs sample

The sample contains a single non-rendered entity with a `Spawner` component that references a cube prefab.

At runtime, the `SpawnSystem` spawns many instances of the cube prefab and places the instances at random positions. The `RotationSpeedSystem` makes the cubes rotate and fall. The `FallAndDestroySystem` destroys cubes when they fall below y coord 0. Once all cubes are destroyed, `SpawnSystem` will spawn more cubes.

## IJobChunk sample

This sample is like "IJobEntity", but it uses an `IJobChunk` instead of `IJobEntity`. Compared to `IJobEntity`, `IJobChunk` requires more boilerplate, but it provides more explicit control in some use cases.

## Reparenting sample

At regular intervals, the smaller cubes are parented and un-parented from the large rotating cube.

## EnableableComponents sample

The `EnabelableComponent` state of the rotating cubes are toggled at regular intervals, causing them to start and stop rotating.

## GameObjectSync sample

This sample contains an entity with a transform that rotates, but the entity itself is not rendered. Instead, the entity syncs its transform with a rendered GameObject. A UI checkbox toggles the rotation on and off.

## CrossQuery sample

This sample demonstrates how to compare entities from two separate queries. At runtime:

- The `SpawnSystem` creates two sets of boxes: 10 white boxes and 10 black boxes.
- The `MoveSystem` moves the white and black boxes back and forth starting in opposite directions.
- The `CollisionSystem` changes the color of a box when it intersects another: white boxes become pink and black boxes become green.

The `CollisionSystem` performs the intersection tests in one of two ways, toggled by an `#if` in the code:

- The `#if true` solution copies the entity id's and transforms of the boxes to arrays, then it loops over every box (using [`SystemAPI.Query`]()) to compare its position against every other box.
- The `#if false` solution does the work in a job and avoids having to copy the boxes by passing the entity chunks to the job.

## RandomSpawn sample

At runtime:

- The `RandomSpawn` system spawns 200 boxes at regular intervals and positions them at random points along the edge of a circle.
- The `MovementSystem` moves the boxes downward and destroys them when their y coordinate becomes less than zero.

Because the boxes are positioned in a parallel job, randomly positioning the boxes requires a unique random seed value for every box.

## FirstPersonController sample

A very simple first-person controller that demonstrates basic input handling and coordination with a GameObject (the camera).

## FixedTimestep sample

This sample demonstrates how to update systems at a fixed rate, similar to the `MonoBehaviour.FixedUpdate` method.

## CustomTransforms

A simple custom transform system specialized for 2D instead of 3D.

## StateChange sample

These samples demonstrate different ways of expressing state changes. Numerous cubes are spawned on a plane, and clicking toggles all cubes within a radius between two states: white and stationary; or red and spinning. There are four solutions:

- **Enableable component**: The cube state is represented by enabling and disabling a component.
- **Structural change**: The cube state is represented by adding and removing a component.
- **Value change**: The cube state is represented by a component value.

## ClosestTarget sample

This sample is similar to the [jobs tutorial](../Tutorials/Jobs/README.md): Seekers (green cubes) and Targets (red cubes) each move slowly in a random direction on a 2D plane. A white debug line is drawn from each Seeker to the nearest Target.

In the subscene, the "Simulation" GameObject has a "SettingsAuthoring" component with a "Spatial Partitioning" value which controls how the Seekers find their Targets:

- `None`: The brute force option. For every Seeker, the `NoPartitioning` loops through every Target to find the Target closest to the Seeker.
- `Simple`: This option uses the same spatial partioning demonstrated in [step 4 of the jobs tutorial](../Tutorials/Jobs/README.md#step-4---solution-with-a-parallel-job-and-a-marter-algorithm).
- `KD Tree`: This option uses a [k-d tree](https://en.wikipedia.org/wiki/K-d_tree) (a tree of points in a *k*-dimensional space) for spatial partitioning.

Spatial partitioning allows each Seeker to find its closest target without having to consider *every* Target. Even the simple partitioning solution scales much better than if we use no partitioning at all, and the k-d tree solution performs even better at very large scales. For example, with 30,000 Seekers and 30,000 Targets on my 8-core CPU, the `TargetingSystem` is about twice as fast using the k-d tree solution compared to the simple solution, and more than a hundred times faster compared to the no partitioning solution.




## Links discovered
- [Video: Entities "HelloCube" samples walkthrough](https://youtu.be/32TLgtA9yUM)
- [jobs tutorial](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Tutorials/Jobs/README.md)
- [step 4 of the jobs tutorial](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Tutorials/Jobs/README.md#step-4---solution-with-a-parallel-job-and-a-marter-algorithm)
- [k-d tree](https://en.wikipedia.org/wiki/K-d_tree)

--- Dots101/Entities101/Assets/Kickball/README.md ---
# Entities Tutorial: Kickball

[Video: Entities "Kickball" Tutorial walkthrough](https://youtu.be/P6_3L7RTcm0) (55 minutes)

This tutorial project demonstrates basic *Unity.Entities* usage.

![](Common/Images/end_result.gif)

- Obstacles (grey cylinders) and players (orange capsules) are spawned on a field.
- Directional input moves the players, but players cannot walk through the obstacles.
- Hitting enter spawns a yellow ball at each player capsule's location.
- Hitting space kicks the balls that are near a player.
- The balls bounce off the obstacles and lose momentum over time.

The text below describes the general idea of each step, but you're strongly encouraged to study the code and read the comments.

<br>

## **Step 1:** Obstacle spawning.

- [`ConfigAuthoring.cs `](./Step%201/ConfigAuthoring.cs)
- [`ObstacleAuthoring.cs `](./Step%201/ObstacleAuthoring.cs)
- [`ObstacleSpawnerSystem.cs `](./Step%201/ObstacleSpawnerSystem.cs)

In Step 1, the main scene contains an embedded 'sub scene', meaning a separate scene asset which is referenced by a `SubScene` MonoBehaviour in the main scene. 

- At build time, the GameObjects in a sub scene are [baked](../../Docs/baking.md) into entities that are serialized.
- When the main scene is loaded at runtime, the serialized entities are loaded along with the GameObjects of the main scene.
- **The GameObjects of the sub scene are NOT loaded at runtime!**

In the Step 1 scene, the sub scene contains a rendered plane GameObject for the ground "Plane" and an un-rendered GameObject called "Config" which has the `ConfigAuthoring` MonoBehaviour. Again, be clear that the GameObjects of the sub scene will *not* be loaded at runtime: the plane you see rendered in play mode is an entity, not a GameObject.

![](Common/Images/initial_scene.png)

In baking, `ConfigAuthoring` adds a `Config` component to the baked entity. This `Config` component stores an assortment of game parameters, such as how many obstacles and players to spawn, plus the entity prefabs that we'll instantiate at runtime.

At the start of play mode, the `ObstacleSpawnerSystem` creates instances of the obstacle prefab. Because spawning should only happen once, the system disables itself to stop subsequent updates.

![](Common/Images/step1_result.png)

<br>

## **Step 2:** Player spawning and movement.

- [`PlayerAuthoring.cs `](./Step%202/PlayerAuthoring.cs)
- [`PlayerSpawnerSystem.cs `](./Step%202/PlayerSpawnerSystem.cs)
- [`PlayerMovementSystem.cs `](./Step%202/PlayerMovementSystem.cs)

After the obstacles are spawned, the `PlayerSpawnerSystem` creates instances of the player prefab, one next to each obstacle.

Each frame, the `PlayerMovementSystem` reads the player's directional input and moves all of the players accordingly. Using a simple radius collision check, players are prevented from penetrating into the obstacles.

![](Common/Images/step2_result.png)

<br>

## **Step 3:** Ball spawning, movement, and kicking.

- [`BallAuthoring.cs `](./Step%203/BallAuthoring.cs)
- [`BallSpawnerSystem.cs `](./Step%203/BallSpawnerSystem.cs)
- [`BallMovementSystem.cs `](./Step%203/BallMovementSystem.cs)
- [`BallKickingSystem.cs `](./Step%203/BallMovementSystem.cs)

When the user hits the enter key, the `BallSpawnerSystem` spawns a ball at the location of each player with an initial velocity. 

Every frame, the `BallMovementSystem` moves each ball based on its current velocity, deflects the velocity if the ball hits an obstacle, and diminishes the velocity over time.

When the user hits the space key, the `BallKickingSystem` applies an impact velocity to all balls within a short distance from a player.

![](Common/Images/step3_result.png)

<br>

## **Step 4:** Improving performance by moving the work into parallel jobs.

- [`NewPlayerMovementSystem.cs `](./Step%204/NewPLayerMovementSystem.cs)
- [`NewBallKickingSystem.cs `](./Step%204/NewBallKickingSystem.cs)
- [`NewBallMovementSystem.cs `](./Step%204/NewBallMovementSystem.cs)

These new systems duplicate the functionality of the originals, but they do the heavy lifting in jobs rather than on the main thread.

Note that the `BallMovementJob` and `BallKickingJob` both have the same query, so it *might* be more optimal if they were combined into one job, but this is just speculation. In practice, you should profile carefully to see whether consolidating them is actually faster!

Also note that when we schedule the `IJobEntity` jobs, we write:

```csharp
myJob.ScheduleParallel(); 
```

...but these schedule calls are modified by source-gen to pass and return a job handle:

```csharp
state.Dependency = myJob.ScheduleParallel(state.Dependency);   // result of source-gen
```

This is necessary to correctly handle entity job dependencies, as explained [here](../../../Docs/entities-jobs.md#systemstatedependency).

<br>
<hr>

*END OF TUTORIAL*

<br>




## Links discovered
- [Video: Entities "Kickball" Tutorial walkthrough](https://youtu.be/P6_3L7RTcm0)
- [`ConfigAuthoring.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%201/ConfigAuthoring.cs)
- [`ObstacleAuthoring.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%201/ObstacleAuthoring.cs)
- [`ObstacleSpawnerSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%201/ObstacleSpawnerSystem.cs)
- [baked](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Docs/baking.md)
- [`PlayerAuthoring.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%202/PlayerAuthoring.cs)
- [`PlayerSpawnerSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%202/PlayerSpawnerSystem.cs)
- [`PlayerMovementSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%202/PlayerMovementSystem.cs)
- [`BallAuthoring.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%203/BallAuthoring.cs)
- [`BallSpawnerSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%203/BallSpawnerSystem.cs)
- [`BallMovementSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%203/BallMovementSystem.cs)
- [`BallKickingSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%203/BallMovementSystem.cs)
- [`NewPlayerMovementSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%204/NewPLayerMovementSystem.cs)
- [`NewBallKickingSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%204/NewBallKickingSystem.cs)
- [`NewBallMovementSystem.cs `](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Entities101/Assets/Kickball/Step%204/NewBallMovementSystem.cs)
- [here](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Docs/entities-jobs.md#systemstatedependency)

--- Dots101/Entities101/Assets/Tornado/README.md ---
# Tornado sample

In this Tornado simulation, a tornado travels in a figure-8 pattern and tears apart buildings made of bars connected at their end points. The tornado is depicted as a swarm of swirling cubes. The bars and cubes collide with the ground but not with each other.

## Code

- `BuildingSpawnSystem`: spawns the points and bars that make up the
- `BuildingSystem`: simulates the points and bars. (Updated in the `FixedStepSimulationSystemGroup`.)
- `BuildingRenderSystem`: updates the bar transforms for rendering.
 buildings.
- `CameraSystem`: moves the camera to follow the tornado.
- `ConfigAuthoring`: contains all sim parameters plus prefabs for the bars and particles.
- `TornadoSpawnSystem`: spawns the cube particles that make up the tornado.
- `TornadoSystem`: simulates the cube particles. (Updated in the `FixedStepSimulationSystemGroup`.)

## Notes

- The bars are stored as unmanaged lists and structs.
- The key logic is implemented as Burst-compiled jobs.
- The bars are rendered as entities.
- No physics engine is used.
- The simulation runs at a fixed rate of 50 ticks a second. (This explains the oscillating frame times measured in the profiler when running at higher framerates.)
- The stability of a constraint simulation depends a lot on the order in which constraints are solved. A fully parallel solution that maintains consistent order may be possible, but for simplicity, we avoided full parallelism.
- For the duration of the simulation, the number of bars remains constant, but the number of end points increases as the bars get disconnected: two connected bars share the same point, so an additional point is needed when they separate.
- The scene initially only contains the ground plane, a light, the camera, and a config GameObject. All the bars and cubes are instantiated in the `TornadoSpawnSystem` and `BuildingSpawnSystem` at runtime.
- Each point is updated independently, so they can be updated in parallel in an `IJobParallelFor`.
- The bar simulation solves the distance constraints by moving the points and eventually breaking the connections. When a connection breaks, the shared point gets split into two separate points. 
- Each bar's rendering transform matrix is computed from its two points.
- The tornado's position and intensity is computed each frame from the elapsed time. 
- When a bar is disconnected, its two points are not shared with other bars, and it occupies 250 bytes: 200 bytes for the bar itself and 25 bytes each for two points. If we assume a maximum memory bandwidth of 60 GB/s (representative of a modern gaming PC), the theoretical absolute maximum scale of this simulation is 4 billion bars at 60hz. In practice, we'll be lucky to achieve a tenth of that scale, but knowing the theoretical limit helps set our expectations.
- A point's number of connected bars and whether the point is anchored is combined into one value (each byte stored in the 'connectivity' array). This makes it cheaper to check whether a point is connected to anything.
- In experimentation, the building generation code never seems to create buildings with more than about 50 bars. As long as this is true, it's safe to store the number of connected bars in a single byte.

## Entities vs. arrays

The advantage of an entity is flexibility: entities can be independently created and destroyed, their components can be added and removed, and a reference to an entity will remain valid for the entity's lifetime. All entities sharing a subset of component types can be processed together in a single query. On the downside, a reference to an entity is composed of two ints (index and version numbers), and looking up an entity _via_ reference is costlier than if we could just follow a pointer.

The advantage of using arrays instead of entities is that items can be looked up directly by their index. Not only is the lookup cheaper, a reference to an item can be stored as just a single int. On the downside, elements in an array cannot be independently added and removed without also shifting the other elements within the array, thereby changing their indexes.

In this sample, we use entities to render the bars and cubes, but what about the points? The points never change in structure and are never reordered nor deleted, only created (when bars disconnect), so the advantages of entities don't apply here. Storing the points in an array also allows for cheaper lookups, of which we'll need to do many per frame.

Furthermore, the simulation has a large number of bars, each of which must reference its two points. Were the points stored as entities, each bar would require 16 bytes for these references (2 ints per point). By storing the points in an array, each bar requires only 8 bytes for these references (1 int per point). Smaller data is always a good thing, as it leas to less memory access.





--- Dots101/Jobs101/Assets/TargetsAndSeekers/README.md ---
# Jobs Tutorial

[Video: Jobs Tutorial walkthrough](https://youtu.be/oOgNg2gL2yw) (17 minutes)

The tutorial is split into discrete steps that each build upon the last. Step N is in the `Assets/StepN` directory, *e.g.* step 2 is in the `Assets/Step2` directory.

### The problem we want to solve:

- Seekers (blue cubes) and Targets (red cubes) each move slowly in a random direction on a 2D plane.
- A white debug line is drawn from each Seeker to its nearest Target.

![each blue seeker finds its nearest red target](./Common/Images/find_target.gif)

<br>

# Step 1 - Solution without jobs

- A singleton `Spawner` MonoBehaviour instantiates 1000 seekers (blue cubes) and 1000 targets (red cubes) within a 500-by-500 area on the XZ plane.
- The `Seeker` and `Target` MonoBehaviours move each seeker and target slowly along a random vector.
- The `Spawner` stores the transforms of the targets in a static array.
- The `FindNearest` MonoBehaviour (attached to the seeker prefab) uses the target transforms array to find the nearest target position and draws a white debug line.

## Results

The finding algorithm used here is simple brute force: for every seeker, we loop over every target.

Here's a profile of a typical frame with 1000 seekers and 1000 targets:

![profile for step 1](./Common/Images/step1_profile.png)

Each seeker takes ~0.3ms to update, taking over 330ms total.

<br>

# Step 2 - Solution with a single-threaded job

- The `Spawner` stores the transforms of both the seekers and targets in static arrays.
- The `FindNearest` MonoBehaviour is moved from the seeker prefab to the "Spawner" GameObject.
- `FindNearest` copies the `localPosition` values of the seeker and target transforms into `NativeArray`'s of `float3`'s.
- `FindNearest` schedules and completes the new `FindNearestJob`, which uses these NativeArray's.

By putting the hard work into a job, we can move the work from the main thread to a worker thread, and we can Burst-compile the code. Jobs and Burst-compiled code cannot access any managed objects (including GameObjects and GameObject components), so we must first copy all the data to be processed by the job into unmanaged collections, such as `NativeArray`'s.

| &#x1F4DD; NOTE |
| :- |
| Strictly speaking, jobs actually *can* access managed objects, but doing so requires special care and isn't normally a good idea. Besides, we definitely want to Burst-compile this job, and Burst-compiled code strictly *cannot* access managed objects at all. |

Though we could still use `Vector3`'s and `Mathf`, we'll instead use `float3` and `math` from the `Unity.Mathematics` package, which has special optimization hooks for Burst.

So here's how our `FindNearestJob` job is defined:


```c#
public struct FindNearestJob : IJob
{
    // All the data which a job will access
    // must be included in its fields.
    public NativeArray<float3> TargetPositions;
    public NativeArray<float3> SeekerPositions;
    public NativeArray<float3> NearestTargetPositions;

    public void Execute()
    {
        // ... the code which the job will run goes here
    }
}
```

The `Update()` of `FindNearest`:

1. Copies the seeker and target transforms into `NativeArray`'s of `float3`'s.
1. Creates an instance of `FindNearestJob`, initializing its fields with the `NativeArray`'s.
1. Calls the `Schedule()` extension method on the job instance.
1. Calls `Complete()` on the `JobHandle` that was returned by `Schedule()`.
1. Uses the `NearestTargetPositions` array, which is populated by the job, to draw a debug line from each seeker to its nearest target.

Here's the excerpt that instantiates, schedules, and completes the job:

```c#
// To schedule a job, we first create an instance and populate its fields.
FindNearestJob findJob = new FindNearestJob
{
    TargetPositions = TargetPositions,
    SeekerPositions = SeekerPositions,
    NearestTargetPositions = NearestTargetPositions,
};

// Schedule() puts the job instance on the job queue.
JobHandle findHandle = findJob.Schedule();

// The Complete() method will not return until the job
// represented by the handle has finished execution.
// In some cases, a job may have finished
// execution before Complete() is called on its handle.
// Either way, the Complete() call will only return 
// once the job is done.
findHandle.Complete();
```

## Results

Here's a profile of a typical frame with 1000 seekers and 1000 targets **without Burst compiling the job**:

![profile for step 2 (Burst disabled)](./Common/Images/step2_profile_no_burst.png)

~30ms is definitely better than the ~330ms we saw before, but next let's **enable Burst compilation** by adding the `[BurstCompile]` attribute on the job struct. **Also make sure that Burst compilation is enabled in the menubar:**

![Enable Burst compilation](./Common/Images/enable_burst.png).

Here's what we get with Burst:

![profile for step 2 (Burst enabled)](./Common/Images/step2_profile.png)

At ~1.5ms, we're well within the 16.6ms budget of 60fps.

Since we have so much headroom now,  let's try 10,000 seekers and 10,000 targets:

![profile for step 2 (Burst enabled, 10,000 seekers and targets)](./Common/Images/step2_profile_10000.png)

A 10-fold increase in seekers and targets results in a 70-fold increase in run time, but this is expected given that every seeker is checking its distance to every target.

| &#x1F4DD; NOTE |
| :- |
| Notice in these profiles that the jobs run on the main thread. This can happen when we call `Complete()` on a job that hasn't yet been pulled off the job queue: because the main thread would otherwise just be sitting idle while it waits for the job to finish anyway, the main thread itself might run the job. |

<br>

# Step 3 - Solution with a parallel job

- The `FindNearestJob` now implements `IJobParallelFor` instead of `IJob`.
- The `Schedule()` call in `FindNearest` now takes two int parameters: an *index count* and *batch size*.

For a job that processes an array or list, it's often possible to parallelize the work by splitting the indices into sub-ranges. For example, one half of an array could be processed on one thread while concurrently the other half is processed on another thread.

We can conveniently create such jobs using `IJobParallelFor`, whose `Schedule()` method takes two int arguments:

- *index count*: the size of the array or list being processed
- *batch size*: the size of the sub-ranges, *a.k.a.* batches

For example, if a job's index count is 100 and its batch size is 40, then the job is split into three batches: the first covering indexes 0 through 39; the second covering indexes 40 through 79; and the third covering indexes 80 through 99.

The worker threads pull these batches off the queue individually, so the batches of a single job can be processed concurrently on different threads.

An `IJobParallelFor`'s `Execute()` method takes an index parameter and is called once for each index, from 0 up to the index count:

```c#
public struct FindNearestJob : IJobParallelFor
{
    [ReadOnly] public NativeArray<float3> TargetPositions;
    [ReadOnly] public NativeArray<float3> SeekerPositions;
    public NativeArray<float3> NearestTargetPositions;

    // Each Execute call processes only an individual index.
    public void Execute(int index)
    {
        // ...
    }
}
```

```c#
// This job processes every seeker, so the
// seeker array length is used as the index count.
// A batch size of 100 is semi-arbitrarily chosen here 
// simply because it's not too big but not too small.
JobHandle findHandle = findJob.Schedule(SeekerPositions.Length, 100);
```

## Results

Profile of a typical frame with 10,000 seekers and 10,000 targets:

![profile for step 3](./Common/Images/step3_profile.png)

With the work split across 16 cores, it takes ~260ms total CPU time but less than 17ms from start to end.

<br>

# Step 4 - Solution with a parallel job and a smarter algorithm

- The `FindNearest` MonoBehaviour now schedules an additional job to sort the target positions array based on the X coords.
- Because the target positions array is sorted, `FindNearestJob` no longer has to exhaustively consider every target.

We can get big performance gains if we organize the data in some way, such as by sorting the targets into a [quadtree](https://en.wikipedia.org/wiki/Quadtree) or [*k*-d tree](https://en.wikipedia.org/wiki/K-d_tree). To keep things simple, we'll just sort the targets by their X coords, though we could just as well sort by Z coords (the choice is arbitrary). Finding the nearest target to an individual seeker can then be done in these steps:

1. Do a binary search for the target with the X coord that is nearest to the seeker's X coord.
2. From the index of that target, search up and down in the array for a target with a smaller 2-dimensional distance.
3. As we search up and down through the array, we early out once the X-axis distance exceeds the 2-dimensional distance to the current candidate for nearest target.

The key insights here are that:

- We don't need to check any target with an X-axis distance greater than the 2-dimensional distance to the current candidate.
- Assuming the targets are sorted by their X coord, if the X-axis distance of one target is too great, then the X-axis distances of all targets to one side of it in the array must also be too large.

So the search no longer requires considering every individual target for each seeker.

## Sorting with jobs

We could write our own job to do the sorting, but instead we'll call the `NativeArray` extension method `SortJob()`, which returns a `SortJob` struct. The `Schedule()` method of `SortJob` schedules *two* jobs: `SegmentSort`, which sorts separate segments of the array in parallel, and `SegmentSortMerge`, which merges the sorted segments. (Merging must be done in a separate single-threaded job because the merging algorithm can't be parallelized.)

## Job dependencies

The `SegmentSortMerge` job should not begin execution until the `SegmentSort` job has itself finished execution, so the `SegmentSort` job is made a *dependency* of the `SegmentSortMerge` job. As a rule, **the worker threads will not execute a job until all of its dependencies have finished execution.** Job dependencies effectively allow us to specify a sequential execution order amongst scheduled jobs.

Our `FindNearestJob` needs to wait for the sorting to finish, so it must depend upon the sorting jobs. Here's our code that creates and schedules the jobs:

```c#
SortJob<float3, AxisXComparer> sortJob = TargetPositions.SortJob(
    new AxisXComparer { });

FindNearestJob findJob = new FindNearestJob
{
    TargetPositions = TargetPositions,
    SeekerPositions = SeekerPositions,
    NearestTargetPositions = NearestTargetPositions,
};

JobHandle sortHandle = sortJob.Schedule();

// To make the find job depend upon the sorting jobs,
// we pass the sort job handle when we schedule the find job.
JobHandle findHandle = findJob.Schedule(
        SeekerPositions.Length, 100, sortHandle);

// Completing a job also completes all of its
// dependencies, so completing the find job also
// completes the sort jobs.
findHandle.Complete();
```

The sequence of jobs is thus: `SegmentSort` -> `SegmentSortMerge` -> `FindNearestJob`.

If we neglect to make the sorting job a dependency of the find job, the job safety checks will throw an exception when we attempt to schedule the find job.

## Results

For this solution, here's a profile of a typical frame with 10,000 seekers and 10,000 targets:

![profile for step 4](./Common/Images/step4_profile.png)

Now the `FindNearestJob` takes just ~7.5ms total CPU time and ~0.5ms from start to end.

Zooming in, we can see the `SegmentSort` and `SegmentSortMerge` jobs:

![profile for step 4 (sorting)](./Common/Images/step4_profile_sort.png)

The `SegmentSort` takes under a 0.1ms start to end, and the single-threaded `SegmentSortMerge` takes ~0.5ms. Weighed against the enormous improvement in `FindNearestJob`, the extra step of sorting is well worth the additional cost.

Most of the frame time now is eaten up by the inefficiencies of GameObjects, which could be addressed by replacing the GameObjects with entities. 









## Links discovered
- [Video: Jobs Tutorial walkthrough](https://youtu.be/oOgNg2gL2yw)
- [each blue seeker finds its nearest red target](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/find_target.gif)
- [profile for step 1](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step1_profile.png)
- [profile for step 2 (Burst disabled)](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step2_profile_no_burst.png)
- [Enable Burst compilation](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/enable_burst.png)
- [profile for step 2 (Burst enabled)](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step2_profile.png)
- [profile for step 2 (Burst enabled, 10,000 seekers and targets)](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step2_profile_10000.png)
- [profile for step 3](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step3_profile.png)
- [quadtree](https://en.wikipedia.org/wiki/Quadtree)
- [*k*-d tree](https://en.wikipedia.org/wiki/K-d_tree)
- [profile for step 4](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step4_profile.png)
- [profile for step 4 (sorting)](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/Dots101/Jobs101/Assets/TargetsAndSeekers/Common/Images/step4_profile_sort.png)

--- Dots101/OtherSamples/DotsUI/Assets/README.md ---
# DOTS and UI Toolkit Integration Sample

This sample demonstrates the use of UI Toolkit within an Entities-based project. In the game, the player controls a wizard who collects ingredients for his magical soup.

To understand this sample, you'll need some basic prior knowledge of both UI Toolkit and Entities:

- [UI Toolkit introductory material](https://learn.unity.com/course/ui-toolkit-fundamentals)
- [Entities introductory material](https://github.com/Unity-Technologies/EntityComponentSystemSamples)

The code of the project resides under the `Assets/Scripts` directory, which has three subdirectories: `Gameplay`, `ScriptableObjects`, and `UI`. The entity components are mainly defined in the `Gameplay/Components` subdirectory.

For a walkthrough of the project, see [this video](https://youtu.be/72EaJ1OW9Nw) (18 minutes).

## Gameplay code

### `Gameplay/GameManagerSystem.cs`

A system that controls the macro-level game state (which is expressed as a `GameState` enum stored in the `GameData` singleton component).

### `Gameplay/GameInput.cs`

A static class that contains `InputAction` objects, which are initialized by the `GameManagerSystem`. Used by the systems to read input.

### `Gameplay/PlayerMovementSystem.cs`

A system that moves the player character. Because the character is a dynamic rigidbody, its movement is controlled by setting its `PhysicsVelocity` component.

### `Gameplay/CameraFollowSystem.cs`

A system that makes the camera follow the player.

### `Gameplay/QuestSystem.cs`

A system that handles the quest interactions: picking up the ingredients, updating the HUD display of collected ingredients, and turning in the quest at the cauldron.

### `Gameplay/EnergyBallSystem.cs`

A system that controls the energy ball pickups. When the player walks near an energy ball, it gravitates towards the player and orbits around them.

### `ScriptableObjects/CollectablesData.cs`

The set of ingredient names and their associated sprites for display in the inventory.

### `ScriptableObjects/DialogueData.cs`

The dialogue strings displayed at the start and end of the game.

### `ScriptableObjects/QuestData.cs`

The counts of ingredients to collect that are required to complete the quest.

## UI code

### `UI/UIScreen.cs`

A base class for the other screen classes. ("Screen" here means really a UI element. We call them "screens" to avoid confusion with the element types provided by UI Toolkit itself.)

`UIScreen` inherits from `ScriptableObject` so that its instances can be stored in a `UnityObjectRef`.

Each UIScreen has an `EntityCommandBuffer` so that it can record 'event' entities to be processed in the next frame. For example, when the user clicks the close button on the inventory screen, the click handler uses the `EntityCommandBuffer` to create an event entity representing the click action.

### `Gameplay/EventSystem.cs`

A system which every frame will:

1. Destroy the event entities of the prior frame.
2. Playback the `EntityCommandBuffer` of the screens.
3. Create a new `EntityCommandBuffer` for the screens.

### `Gameplay/UISystem.cs`

A system which handles the event entities generated by the UI screens. For example, `UISystem` will query for events that signal a screen's close button was clicked, and if such an entity exists, `UISystem` will close the screen.

### `UI/DialogueScreen.cs`

A wrapper for the dialogue UI element that appears at the start and end of the game.

### `UI/HelpScreen.cs`

A wrapper for the help UI element (the help screen that appears when you click the question mark button).

### `UI/HintScreen.cs`

A wrapper for the hint UI element (the text that appears next to an ingredient when it's near the player).

### `UI/HUDScreen.cs`

A wrapper for the HUD UI element (the bottom toolbar of buttons for opening the help screen and inventory screen).

### `UI/InventoryScreen.cs`

A wrapper for the pop-up inventory UI element.

### `UI/InventorySlot.cs`

A wrapper for the UI elements representing a slot of the inventory.

### `UI/QuestScreen.cs`

A wrapper for the quest UI element (the quest status info in the top-right).

### `UI/SplashScreen.cs`

A wrapper for the splash UI element (the "press any key" text at the very start of the game).





## Links discovered
- [UI Toolkit introductory material](https://learn.unity.com/course/ui-toolkit-fundamentals)
- [Entities introductory material](https://github.com/Unity-Technologies/EntityComponentSystemSamples)
- [this video](https://youtu.be/72EaJ1OW9Nw)

--- Dots101/ContentManagement101/ProjectSettings/ProjectVersion.txt ---
m_EditorVersion: 6000.2.11f1
m_EditorVersionWithRevision: 6000.2.11f1 (7134d7685e5d)


--- Dots101/Entities101/ProjectSettings/ProjectVersion.txt ---
m_EditorVersion: 6000.2.10f1
m_EditorVersionWithRevision: 6000.2.10f1 (d3d30d158480)


--- Dots101/Jobs101/ProjectSettings/ProjectVersion.txt ---
m_EditorVersion: 6000.2.10f1
m_EditorVersionWithRevision: 6000.2.10f1 (d3d30d158480)


--- EntitiesSamples/README.md ---
# Entities Samples

*For Entities and DOTS starter material, see the [main page of the repo](../README.md).*

- [Baking](Assets/Baking/README.md)
- [Boids](Assets/Boids/README.md)
- [Graphical](Assets/Graphical/README.md)
- [Streaming](Assets/Streaming/README.md)


## Links discovered
- [main page of the repo](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/README.md)
- [Baking](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/Baking/README.md)
- [Boids](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/Boids/README.md)
- [Graphical](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/Graphical/README.md)
- [Streaming](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/EntitiesSamples/Assets/Streaming/README.md)

--- EntitiesSamples/Assets/Baking/README.md ---
# Entities baking samples

## AutoAuthoring

A solution for conveniently creating authoring components that simply copy each field of the authoring MonoBehaviour to a corresponding field of an IComponentData.

## BakingDependencies sample

This sample demonstrates how a baker and a baking system can react to changes made on the authoring data.

The `ImageGeneratorAuthoring` component references an image and a `ScriptableObject` asset, which contains a float value, a mesh, and a material. During baking, this component generates one primitive per pixel in the image and sets the color correspondingly.

Modifying any of the authoring component's fields will trigger a re-bake of the necessary GameObjects in the subscene. For example, modifying the float field will re-bake both GameObjects (because they both use the asset), but modifying the "hello.png" image will only re-bake the one GameObject which depends upon it.

## BakingTypes sample

This sample doesn't do anything at runtime, but it uses baking to create a bounding box around each set of cubes (enable Gizmos to see the white debug lines). When you drag the cubes around in the Scene window, you'll see the bounding box update as you drag because baking is re-triggered as you edit the subscene.

## BlobAssetBaker sample

This sample creates a [BlobAsset](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/blob-assets-concept.html) during Baking. At runtime, the animation curve stored in the BlobAsset is used to animate the y position of a cube.

## BlobAssetBakingSystem sample

This sample demonstrates how to bake BlobAssets in an efficient and scalable way using baking systems. In the code:

- The subscene contains 256 GameObjects, split in four types: Capsules, Cubes, Cylinders and Spheres.
- Each GameObject in the subscene has a `MeshBBAuthoring` component that defines the information we want to store in a blob asset.
- The `MeshBBAuthoring` baker stores the mesh vertices in a `BakingType` buffer and additional information in a `BakingType` component.
- The `MeshBBRenderSystem`, which updates in edit mode, uses the blob asset to draw a debug bounding box around the 256 baked entities.

The `ComputeBlobAssetSystem` BakingSystem is set up in three main steps:

1. BlobAssets that are not already present in the BlobAssetStore are added to a list for processing.
2. Unique BlobAssets are identified by their hashes.
3. `BlobAssetReference` are stored in entity components.

Note that bakers track which BlobAssets are referenced by which entities and keep the BlobAssetStore updated accordingly. However, BlobAssets created in a *baking system* are not tracked automatically, so the baking system must manually check if the entities reference different BlobAssets compared to last bake and update the BlobAssetStore manually. If an Entity is removed altogether, the baking systems must clean up any baked BlobAssets that the entity might reference.

## PrefabReference sample

This sample demonstrates how to use an `EntityPrefabReference`. Whereas directly baking a prefab in each SubScene creates one baked entity per SubScene, an `EntityPrefabReference` allows multiple SubScenes to reference a single baked prefab entity.

## Links discovered
- [BlobAsset](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/blob-assets-concept.html)

--- EntitiesSamples/Assets/Boids/README.md ---
# Boids sample

Schools of fish flock together and avoid sharks.

This sample demonstrates advanced uses of ECS and jobs to achieve a complex, large scale simulation behavior.

![](./boids.jpg)

--- EntitiesSamples/Assets/Graphical/README.md ---
# Graphical samples

*Samples demonstrating how to work with certain graphical elements.*

## AnimateGameObject sample

This sample demonstrates an entity that logically controls an animated GameObject.

## RenderSwap sample

Change the material of rendered entities at runtime.

## ShaderGraph sample

This sample defines material override components, which allow you to control shader parameters by setting the override component values.

## Splines sample

This sample uses baking to define a spline. At runtime, boxes move along the spline paths. 

## TextureUpdate sample

This sample uses Burst-compiled jobs to efficiently generate a texture.

## WireframeBlob sample

This sample constructs a blob wireframe for a complex mesh. Enable Gizmos to see the wireframe. In game, click on the ground to spawn additional instances.

--- EntitiesSamples/Assets/Streaming/README.md ---
# Entities streaming samples

## AssetManagement sample

This sample loads and unloads assets at runtime using `WeakObjectReference`.

## BindingRegistry sample

The BindingRegistry tracks associations between GameObject component fields and corresponding entity component fields. By using the `RegisterBinding` attribute, authoring components can be live updated in sync with changes to the corresponding entity components. (This effect is only visible in "mixed mode" of the inspector window.)

## PrefabAndSceneReferences sample

This sample loads entity prefabs and entity scenes at runtime using `EntityPrefabReference` and `EntitySceneReference`. At bake time, the references are assigned GUID's of the assets, and these GUID's are resolved at runtime.

## RuntimeContentManager sample

This sample demonstrates how to use the [RuntimeContentManager](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/content-management.html) to load and release assets at runtime.

## SceneManagement samples

This is a series of samples that demonstrate the scene management API's.



## Links discovered
- [RuntimeContentManager](https://docs.unity3d.com/Packages/com.unity.entities@1.0/manual/content-management.html)

--- EntitiesSamples/Assets/Streaming/SceneManagement/README.md ---
# Entities SceneLoading samples

*NOTE: In these samples, opening and closing the subscene while in playmode may trigger errors. You should enter playmode with the subscenes closed.*

## SceneLoading sample 

This sample shows how to load/unload scenes.

## SceneState

This sample has a UI for loading scenes and their sections.

## SectionLoading sample

This sample shows how to load/unload sections from a scene.

## CrossSectionReferences sample

This sample demonstrates how entities in one section can or cannot reference another.

## SectionMetadata sample

This sample shows how to add metadata to section entities.

## StreamingVolume

This sample uses custom volumes to trigger loading and unloading of subscenes. Move the player capsule with the "WASD" keys. The subscenes are loaded and unload as the player enters and leaves the volumes.

## SubsceneInstancing sample

This sample shows how to instantiate a scene multiple times using a *PostLoadCommandBuffer* and the *ProcessAfterLoad* system.

## Complete sample

This sample streams tiles based on the player position with a basic LOD solution. Move the player with the "WASD" keys. Tiles will load and unload based on their distance to the player, and tiles closer to the player will switch to a higher LOD level: 

- blue boxes = high LOD (section 1)
- yellow boxes = medium LOD (section 2)
- red boxes = low LOD (section 3)
- the ground quad = all LOD levels (section 0).

![Complete Sample 1!](./Common/Complete1.gif "Complete Sample 1")

- The `TileLOD` component of the ground quad defines the distances at which each LOD level is loaded. During baking, the `TileLODBakingSystem` stores this information in the `TileLODRange` component on each section entity. At runtime, the `TileLoadingSystem` loads and unloads the tiles based on these loading and unloading distances.
- The `TileDistanceSystem` finds the distance between each tile and the closest relevant entity. 
- The `TileLODSystem` loads and unloads the sections based on the LOD distances to the closest relevant entity.

Note that we can have more than one `Relevant` entity. Here we see the effect of having two separate `Relevant` entities:


![Complete Sample 2!](./Common/Complete2.gif "Complete Sample 2")






--- EntitiesSamples/ProjectSettings/ProjectVersion.txt ---
m_EditorVersion: 6000.2.10f1
m_EditorVersionWithRevision: 6000.2.10f1 (d3d30d158480)


--- GraphicsSamples/HDRPSamples/README.md ---
# Entities Graphics HDRP Samples Project
This Project includes feature sample Scenes for HDRP Entities Graphics.

## Feature sample Scenes
The feature sample Scenes are in the _SampleScenes_ folder split into different folders depending on topic. Most of these Scenes include GameObjects in a SubScene.

Unity renders GameObjects with Entities Graphics when a corresponding entity exists, and without Entities Graphics when a corresponding entity does not exist. For the GameObjects in the SubScene, this means that Unity renders them with Entities Graphics at all times; in Edit Mode, in Play Mode, and in the built player.

### Scene List

| Scene | Description | Screenshot |
| --- | --- | - |
| AmbientAndBlendProbes | Demonstrate how to use light probes | ![](READMEimages/AmbientAndBlendProbes.png) |
| Lightmaps | Demonstrates lightmap support for Entities | ![](READMEimages/Lightmaps.PNG) |
| Lightprobes | Demonstrates lightprobe support for Entities | ![](READMEimages/Lightprobes.PNG) |
| BuiltInMaterialSHProperties | Demonstrates override of the built-in material SH property values | ![](READMEimages/BuiltInMaterialSHProperties.PNG) |
| HDRPLitProperties | Demonstrates material property overrides for different HDRP Lit material properties on Entities | ![](READMEimages/HDRPLitProperties.PNG) |
| HDRPShaders | Demonstrates material property overrides for HDRP Lit, LitTessellation, Unlit, LayeredLit, LayeredLitTessellation shaders on Entities | ![](READMEimages/HDRPShaders.PNG) |
| MaterialOverridesSample | Demonstrates the setup of overriding a material's properties without having to write code | ![](READMEimages/MaterialOverridesSample.PNG) |
| ShaderGraphProperties | Demonstrates material property overrides for Shader Graph shaders on Entities | ![](READMEimages/ShaderGraphProperties.PNG) |
| HybridEntitiesConversion | Demonstrates the graphics related companion components that you can put in a Subscene | ![](READMEimages/HybridEntitiesConversion.PNG) |
| TriggerParticles | Demonstrates how to play VFX from an ECS System | ![](READMEimages/TriggerParticles.PNG) |
| EntityCreation | Demonstrates how to efficiently create entities at run time that are rendered via Entities Graphics  | ![](READMEimages/EntityCreation.PNG) |
| MaterialMeshChange | Demonstrates how to change a Material and Mesh on Entities at runtime | ![](READMEimages/MaterialMeshChange.PNG) |
| RenderMeshUtilityExample | Demonstrates the new RenderMeshUtility.AddComponents API | ![](READMEimages/RenderMeshUtilityExample.PNG) |
| MeshDeformations | Demonstrates BlendShape and SkinWeight entities | ![](READMEimages/MeshDeformations.PNG) |
| SkinnedCharacter | Demonstrates SkinnedMeshRenderer entities | ![](READMEimages/SkinnedCharacter.PNG) |
| DisabledEntities |  Demonstrates disabled entities | ![](READMEimages/DisabledEntities.PNG) |
| LODs | Demonstrates LODs in Entities Graphics| ![](READMEimages/LODs.PNG) |
| MatrixPrevious | Demonstrates moving Entities and support for HDRP Motion Vectors | ![](READMEimages/MatrixPrevious.PNG) |
| Submesh | Demonstrates using a Mesh with multiple sub-meshes with Entities Graphics | ![](READMEimages/Submesh.png) |
| TransparencyOrdering | Demonstrates transparent entities ordering | ![](READMEimages/TransparencyOrdering.PNG) |





--- GraphicsSamples/URPSamples/README.md ---
# Entities Graphics URP Samples Project
This Project includes feature sample Scenes for URP Entities Graphics.

## Feature sample Scenes
The feature sample Scenes are in the _SampleScenes_ folder split into different folders depending on topic. Most of these Scenes include GameObjects in a SubScene. 

Unity renders GameObjects with Entities Graphics when a corresponding entity exists, and without Entities Graphics when a corresponding entity does not exist. For the GameObjects in the SubScene, this means that Unity renders them with Entities Graphics at all times; in Edit Mode, in Play Mode, and in the built player.

### Scene List

| Scene | Description | Screenshot |
| --- | --- | - |
| AmbientAndBlendProbes | Demonstrate how to use light probes | ![](READMEimages/AmbientAndBlendProbes.PNG) |
| Lightmaps | Demonstrates lightmap support for Entities | ![](READMEimages/Lightmaps.PNG) |
| Lightprobes | Demonstrates lightprobe support for Entities | ![](READMEimages/Lightprobes.PNG) |
| BuiltInMaterialSHProperties | Demonstrates override of the built-in material SH property values | ![](READMEimages/BuiltInMaterialSHProperties.PNG) |
| MaterialOverridesSample | Demonstrates the setup of overriding a material's properties without having to write code | ![](READMEimages/MaterialOverridesSample.PNG) |
| ShaderGraphProperties | Demonstrates material property overrides for Shader Graph shaders on Entities | ![](READMEimages/ShaderGraphProperties.PNG) |
| URPLitProperties | Demonstrates material property overrides for different URP Lit material properties on Entities | ![](READMEimages/URPLitProperties.PNG) |
| HybridEntitiesConversion | Demonstrates the graphics related companion components that you can put in a Subscene | ![](READMEimages/HybridEntitiesConversion.PNG) |
| TriggerParticles | Demonstrates how to play a ParticleSystem from an ECS System | ![](READMEimages/TriggerParticles.PNG) |
| EntityCreation | Demonstrates how to efficiently create entities at run time that are rendered via Entities Graphics | ![](READMEimages/EntityCreation.PNG) |
| MaterialMeshChange | Demonstrates how to change a Material and Mesh on Entities at runtime | ![](READMEimages/MaterialMeshChange.PNG) |
| RenderMeshUtilityExample | Demonstrates the new RenderMeshUtility.AddComponents API | ![](READMEimages/RenderMeshUtilityExample.PNG) |
| MeshDeformations | Demonstrates BlendShape and SkinWeight entities | ![](READMEimages/MeshDeformations.PNG) |
| SkinnedCharacter | Demonstrates SkinnedMeshRenderer entities | ![](READMEimages/SkinnedCharacter.PNG) |
| DisabledEntities |  Demonstrates disabled entities | ![](READMEimages/DisabledEntities.PNG) |
| LODs | Demonstrates LODs in Entities Graphics | ![](READMEimages/LODs.PNG) |
| SimpleDotsInstancingShader | Demonstrates a simple unlit shader which renders using DOTS instancing | ![](READMEimages/SimpleDotsInstancingShader.PNG) |
| Submesh | Demonstrates using a Mesh with multiple sub-meshes with Entities Graphics | ![](READMEimages/Submesh.png) |
| TransparencyOrdering | Demonstrates transparent entities ordering | ![](READMEimages/TransparencyOrdering.PNG) |


--- NetcodeSamples/README.md ---
### Unity Netcode for Entities Samples

*For more Netcode and DOTS starter material, see the [main page of this repo](../README.md).*

The Netcode for Entities package provides the multiplayer features needed to implement
world synchronization in an [entities]((https://docs.unity3d.com/Packages/com.unity.entities@latest))-based multiplayer game. It uses the transport package
for the socket level functionality, Unity Physics for networked physics simulation, Logging package for packet dump logs. Key Netcode for Entities features include:

* Server authoritative synchronization model.
* RPC support, useful for control flow or network events.
* Client / server world bootstrapping so you have clear separation of logic and you can run a server with multiple clients in a single process, like the editor when testing.
* Synchronize entities with interpolation and client side prediction working by default.
* Network traffic debugging tools.
* GameObject conversion flow support, so you can use a hybrid model to add multiplayer to a GameObject/MonoBehaviour based project.

[Netcode for Entities Manual](https://docs.unity3d.com/Packages/com.unity.netcode@latest)

[The Netcode for Entitiets forum](https://forum.unity.com/forums/dots-netcode.425/)

### Samples

#### NetCube
A small sample featuring the Netcode for Entities Package basic features, this is the sample used in the __Getting Started__ guide in the manual.

#### HelloNetcode
This is a suite of samples which aim to be small, simple and show features in isolation. Later samples then re-use earlier ones so it's simpler to see exactly what's being shown and similar routines (like connecting, going in game etc) don't need to be repeated. This way samples can also build on top of each other and become more complex. They are split into Basic, Intermediate and Advanced areas depending on level of complexity and how commonly the things shown are needed in a normal project.

#### Asteroids
A small game featuring the Netcode for Entities Package features.

#### PredictionSwitching
A sample using predicted physics based on Unity Physics. The sample is predicting all objects close the the player but not objects far away. The color of the spheres will change to indicate if they are predicted or interpolated.

#### PlayerList
A sample which shows how to maintain a list of connected players by using the RPC feature.

## Links discovered
- [main page of this repo](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/README.md)
- [entities](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/NetcodeSamples/(https:/docs.unity3d.com/Packages/com.unity.entities@latest)
- [Netcode for Entities Manual](https://docs.unity3d.com/Packages/com.unity.netcode@latest)
- [The Netcode for Entitiets forum](https://forum.unity.com/forums/dots-netcode.425/)

--- NetcodeSamples/Assets/Samples/LevelSync/README.md ---
# Networked level synchronization demo

This sample contains a demonstration for how to manage level synchronization between server and clients when using the netcode package.

## Structure

- The main module is the _NetcodeLevelSync.cs_ file which implements the networked level sync flow. It does no scene load/unloading itself as that is very use case specific.
- The _LevelSync_Bootstrap_ scene contains a subscene based level flow which demonstrates how to make use of the networked sync module.
  - It has a UI which makes use of the LevelManager.cs as entry point.
  - It uses LevelTracker* systems to handle loading/unloading routines.

## Flow

_NetcodeLevelSync_ implements the following flow:
- Server initiates level loading
  - Disable ghost sync (_NetworkStreamInGame_ on all connections)
  - Unload current level and start loading the new level
  - Send RPC command to connected clients telling them to also switch levels
- When client receives the RPC command
  - Disable ghost sync (_NetworkStreamInGame_ on server connection)
  - Unload current level and start loading next one
  - When done loading send RPC to server signalling you are ready
- When server has received ready message from all clients and is himself done loading
  - Enable ghost sync (_NetworkStreamInGame_ on all connections)

_NetcodeLevelSync_ is controlled through _LevelSyncStateComponent_ data.
```c#
public struct LevelSyncStateComponent : IComponentData
{
    public LevelSyncState State;
    public int CurrentLevel;
    public int NextLevel;
}
```

The valid level sync states are
```c#
public enum LevelSyncState
{
    Idle,
    LevelLoadRequest,
    LevelLoadInProgress,
    LevelLoaded
}
```

- Normally the state will be _Idle_.
- When server starts level loading he should place the state in _LevelLoadInProgress_
- When a command to load a new level has arrived the client will see the _LevelLoadRequest_ and needs to react to that by starting the level load routine himself and setting state to _LevelLoadInProgress_.
- When either server or client are done loading they should set the state to _LevelLoaded_
- State will go back to _Idle_ when processing is done.

## Sample code reference 

A good way to see the flow more clearly is to have a look at the test for it, as it goes though all the steps in a simple way in one file. See [SceneAutomationSystems.cs](../../Tests/SceneLoadingTests/SceneAutomationSystems.cs) 


## Links discovered
- [SceneAutomationSystems.cs](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/NetcodeSamples/Assets/Tests/SceneLoadingTests/SceneAutomationSystems.cs)

--- NetcodeSamples/ProjectSettings/ProjectVersion.txt ---
m_EditorVersion: 6000.2.10f1
m_EditorVersionWithRevision: 6000.2.10f1 (d3d30d158480)


--- NetcodeSamples/Assets/Samples/CustomSerializer/CustomSerializer.md ---
# Creating a custom chunk serialization method

This sample shows how implement and register a custom serialization method, to serialize ghost chunks of a given archetype.

## Why using custom serialization function

Only one reason: **Peformance**! When using the a custom serialization function designed for a specific archetype,
you can make (or relax) certain assumptions: I.e.
* No checks for removed components.
* Optimise the loops that gather and copy data.
* Generally write things in a way that gives both the compiler, and burst in primis, more opportunities for
  auto-vectorization.

In general, it also gives a CPU performance gain in cases where the ghost has a lots of small components, reducing function pointer call overhead (and more importantly single call setup overhead).

### Current limitation of the custom serializer API
This is an advanced feature of the Netcode package (we can say it is "in-preview"), available for now only when using the PrefabCreation API (i.e. manually created ghost entities types).

# USING THE API
## Registering custom serializers
In order to use custom chunk serialization function; **said function must be registered to the GhostCollection system, before the
prefabs are collected and processed.** A good place to put the registration, is in the system where you create the prefabs.

To register your custom serialization function, you need to retrieve the `GhostCollectionCustomSerializer` singleton,
and add an entry for a given archetype. A ghost archetype is identified by its GhostType hash.

```csharp
GhostPrefabCreation.ConvertToGhostPrefab(EntityManager, prefab, prefabConfig);
var hash = (Unity.Entities.Hash128)EntityManager.GetComponentData<GhostType>(prefab);
var customSerializers = SystemAPI.GetSingletonRW<GhostCollectionCustomSerializers>();
customSerializers.ValueRW.Serializers.Add(hash, new GhostPrefabCustomSerializer
{
    SerializeChunk = CustomChunkSerializer.SerializerFunc, 
    PreSerializeChunk = CustomChunkSerializer.PreSerializerFunc
});
```

Both `SerializeChunk` and  `PreSerializeChunk` functions are optional, meaning that you can have either one of them, or both.

## Register a custom component list provider for the archetype
In order to be able to serialize a component, it is necessary to access and retrieve the component data from the chunk.
This is achieved by accessing the list of serialized components registered for this archetype, and retrieve from them a list of type handles (the `DynamicTypeHandle`) for each component type.

Each the prefab processed by the `GhostCollectionSystem` has:
- one entry in the `GhostCollectionPrefabSerializer` list, that contains a bunch of metadata information to serialize the type.
- each serialized component will create an entry in the `GhostCollectionComponentIndex` (for root and child entities in order) that contains (among other things):
  - which serializer to use (the SerializerIndex field)
  - an index in the `DynamicTypeList` (ComponentIndex) that let you retrieve the `DynamicComponentTypeHandle`.

```csharp
var typeData = ghostCollectionPrefabSerializer[ghostType];
var componentIndex = typeData.FirstComponent; 
var index = componentIndices[componentIndex];
var dynamicTypeHandle = dynamicTypeList[index.ComponentIndex];
```

When writing a custom serialization method, it can be tricky to find the index of a specific component type
in the `componentIndices` list, for the current ghost archetype. That because a components position in the list depends upon:
- its stable-type-hash
- the serializer hash associated with that specific component for that archetype.

Therefore, we support passing a `CollectComponents` function pointer to the GhostPrefabCreation.ConvertToGhostPrefab` (a field of the config argument),
such that you know exactly the index into the `componentIndices` list for a specific component type.

For example:

```csharp
public static void CollectComponents(IntPtr componentTypesPtr, IntPtr componentCountPtr)
{
    ref var componentTypes = ref GhostComponentSerializer.TypeCast<NativeList<ComponentType>>(componentTypesPtr);
    ref var componentCount = ref GhostComponentSerializer.TypeCast<NativeArray<int>>(componentCountPtr);
    //Root
    componentTypes.Add(ComponentType.ReadWrite<GhostOwner>());
    componentTypes.Add(ComponentType.ReadWrite<LocalTransform>());
    componentTypes.Add(ComponentType.ReadWrite<IntCompo1>());
    componentTypes.Add(ComponentType.ReadWrite<IntCompo2>());
    componentTypes.Add(ComponentType.ReadWrite<IntCompo3>());
    componentTypes.Add(ComponentType.ReadWrite<FloatCompo1>());
    componentTypes.Add(ComponentType.ReadWrite<FloatCompo2>());
    componentTypes.Add(ComponentType.ReadWrite<FloatCompo3>());
    componentTypes.Add(ComponentType.ReadWrite<InterpolatedOnlyComp>());
    componentTypes.Add(ComponentType.ReadWrite<OwnerOnlyComp>());
    componentTypes.Add(ComponentType.ReadWrite<Buf1>());
    componentTypes.Add(ComponentType.ReadWrite<Buf2>());
    componentTypes.Add(ComponentType.ReadWrite<Buf3>());
    componentCount[0] = 13;
    //Child 1
    componentTypes.Add(ComponentType.ReadWrite<IntCompo1>());
    componentTypes.Add(ComponentType.ReadWrite<FloatCompo1>());
    componentTypes.Add(ComponentType.ReadWrite<Buf1>());
    componentCount[1] = 3;
    //Child 2
    componentTypes.Add(ComponentType.ReadWrite<IntCompo2>());
    componentTypes.Add(ComponentType.ReadWrite<FloatCompo2>());
    componentTypes.Add(ComponentType.ReadWrite<Buf2>());
    componentCount[2] = 3;
}
```

You can find this function in the `CustomChunkSerializer.cs` file.

When the function is present, the components list for that archetype use the order specified by that method, giving you the possibility
to access the component types information consistently, and also allowing you to define the component serialization order.

## Implementing custom chunk serializer

We provide a bunch of utility methods that can be used to serialize the enable bits, buffers and components inside the
`CustomGhostSerializerHelpers` class.
The `CustomChunkSerializer.cs` can be considered a sort of template that you can reuse to write or generate your serializer almost
automatically (by just invoking the provider helper functions).

To make the code as re-usable as possible (and reducing mistakes), you must re-use the generated component serializer struct
(i.e `MyAssembly.Generated.MyComponentGhostComponentSerializer`) and:
- invoke on an instance of that serializer one of the `CopyToSnapshot<T>` methods.
- invoke on an instance of that serializer one of the `SerializeWithSingleBaseline` or `SerializeWithThreeBaseline` or `SerializeBuffer`.

Unfortunately, given that the `MyAssembly.Generated.MyComponentGhostComponentSerializer` serializer is auto-generated, most IDE's will not help auto-complete the method name, nor will they recognize the classes existence. But the code will compile correctly.

The serialization is divided in two steps:

### STEP 1 - COPY TO SNAPSHOT
You just need to implement the `CustomChunkSerializer.CopyComponentsToSnapshot` method, by copying the enable bits (if necessary), and copying the component data. For example:

```csharp

new Unity.NetCode.Generated.GhostOwnerGhostComponentSerializer().CopyComponentToSnapshot(chunk, ref context,
    ghostChunkComponentTypesPtr, indices[0], snapshotPtr, ref snapshotOffset);
new Unity.NetCode.Generated.TransformDefaultVariantGhostComponentSerializer().CopyComponentToSnapshot(chunk, ref context,
    ghostChunkComponentTypesPtr,indices[1], snapshotPtr, ref snapshotOffset);
CustomGhostSerializerHelpers.CopyEnableBits(chunk, context.startIndex, context.endIndex, context.snapshotStride,
    ref ghostChunkComponentTypesPtr[indices[2].ComponentIndex], enableBits, ref maskOffset);
```

Similarly, for child entity components, we have similar methods that just scaffold some implementation details and boilerplate template code.

### STEP 2 - SERIALIZE TO THE DATASTREAM
After the data has been copied into the snapshot buffer, we can serialize the snapshot (entity by entity), into the data stream. Based on the acknowledge baselines, we should serialize by either:
- A single or default baseline
- three baselines.

The `CustomChunkSerializer` class has two methods that need to be implemented:
- `SerializeWithSingleBaseline`
- `SerializeWithThreeBaseline`

All code-generated serializers provide three static methods can be used for writing the snapshot data into the stream:
- `SerializeSingleBaseline`: serialize the data using only one baseline (either acked or the default one).
- `SerializeThreeBaseline`: serialize the data using the last three baselines (all acked) and by predicting the value to reduce the delta.
- `SerializeBuffer`: serialize a buffer to the stream using one single baseline (either the default or the acked one).

See the `CustomChunkSerializer.cs` for an example how to use them. But as a short example:

```csharp

//With a single baseline
compBitSize[0*compBitSizeStride] = default(Unity.NetCode.Generated.GhostOwnerGhostComponentSerializer).SerializeComponentThreeBaseline(snapshotData,baseline0Ptr,
    baseline1Ptr, baseline2Ptr, changeMaskData, ref changeMaskOffset, ref snapshotOffset, ref predictor, ref writer, compressionModel);

//With three baseline
compBitSize[0*compBitSizeStride] = default(Unity.NetCode.Generated.GhostOwnerGhostComponentSerializer).SerializeComponentThreeBaseline(snapshotData,baseline0Ptr,
    baseline1Ptr, baseline2Ptr, changeMaskData, ref changeMaskOffset, ref snapshotOffset, ref predictor, ref writer, compressionModel);    
```






--- NetcodeSamples/Assets/Samples/PlayerList/PlayerList.md ---
# PlayerList - Joiners and Leavers "Feed"

## Requirements
* "PlayerList" uses RPCs, which are available even "out of game".
* The "PlayerList" sample makes use of the optional `ICleanupComponentData` `ConnectionState`.

## Sample Description

The "PlayerList" sample uses RPCs to create a "feed" of players who have connected/disconnected, including the "reason" (i.e. cause) of the disconnect.

>[!NOTE]
> It is implemented via RPCs so that it can be used without the need to synchronise snapshots.
> However, another approach (which isn't demonstrated here) is to implement this behaviour via a single, static-optimized ghost (with an IBufferElementData containing all connected players).

### `ServerPlayerListSystem`
`ConnectionState` is added via an `OnUpdate` `AddComponent` call (using a query of all `NetworkStreamConnection` entities, which don't have a ConnectionState).

New Joiners are handled in the `HandleNewJoinersJob`. This job must wait for an RPC from a client (`ClientRegisterUsernameRpc`), as there is no way to infer a clients `Username` except to ask for it.
Thus, each client must opt-into being seen in the player list.
This username is then validated, and broadcast to all other players. The player is now considered "connected" (or "joined").

>[!NOTE]
> For your own game, you can source usernames however you like. 
> E.g. The GameServer could communicate with a backend instead, receiving a list of expected clients.
> Clients authenticate while connecting to the server, and are expected to provide a single-use join token, which can then be mapped to a Username.

For disconnecting players: The `NotifyPlayersOfDisconnectsJob` job polls each `ConnectionState` FSM, detects disconnects (regardless of the reason), and again broadcasts this change to clients.
Unity Transport Package (UTP) can detect:
* Client Disconnects.
* Server Disconnects (i.e. "Kicking" or "Booting" a player).
* Socket/Driver Timeouts (i.e. no response from a client for X seconds, assume disconnected).
This `DisconnectReason` is also broadcast to all other players, for you to optionally read from. We recommend communicating it to players, as it's a UX improvement: Players often appreciate knowing what happened to their friends.

### `ClientPlayerListSystem`
* Registers a username with the "PlayerList" sub-system (via `ClientRegisterUsernameRpc`).
* Receives and handles `InvalidUsernameResponseRpc` when attempting to set an invalid username (e.g. you may want to use a profanity or abuse filter).
* Receives and handles `PlayerListEntry.ChangedRpc` change events (of players connecting, disconnecting, and changing username).

### Rendering Systems
* `ClientPlayerListEventSystem` takes all `ChangedRpc`'s and converts them into `PlayerListNotificationBuffer` entries.
* `RenderPlayerListMb` is a stateless, debug, IMGUI renderer of this data. It also provides a text-field, allowing you to update your username.

### Testing
You can also use new controls in the "Multiplayer > Window: PlayMode Tools" to test various forms of disconnect (use thin clients to simulate other players).
Testing "Socket Timeouts" is now possible too. UTP defaults to 30s to timeout a connection.
Obviously, building a player to test this is also supported.

>[!NOTE]
> Effort has been taken to ensure that notifications are in order. I.e. When connecting, you will only see "new joiner" notifications for players who sent their connect notification RPCs _after you_.


--- NetcodeSamples/Assets/Samples/PredictionSwitching/PredictionSwitching.md ---
# Prediction Switching Sample
[Prediction Switching](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/prediction.html#prediction-switching) allows you to switch the `GhostMode` of a ghost on the fly (i.e. during playmode), allowing clients to opt-into prediction, ultimately saving CPU cycles.

This sample demonstrates that idea with a simplified "football" sandbox.

* `Sphere.prefab` is a physics ball, which is relatively expensive to predict (in high quantities). It is the target of this optimization.
* `Player.prefab` is our player (i.e. character controller), which:
    * Interacts with these balls (by colliding with them).
    * Defines the center of the "Prediction Switching Radius" (see `PredictionSwitchingSystem.cs`).

#### Color Key
* **Cyan** - Interpolated Ghosts.
* **Green** - Predicted Ghosts.
* _Player colors are excluded._

> [!NOTE]
> This color key is also used by the "Bounding Box Drawer" tool, which is toggleable via the `Multiplayer PlayMode Tools Window > Bounding Box Drawer > Disabled` button.

By entering playmode, you are able to observe that balls within a radius of the player transition to Predicted (and vice-versa).
You should also be able to observe the interpolation being applied (during the transition), especially when balls bounce off each other.

See the `PredictionSwitchingSettingsAuthoring` `MonoBehaviour` to modify the settings, and observe how they affect gameplay.

## Takeaways
* Generally speaking: As with all things in NetCode, faster moving (and more unpredictable) entities are significantly harder to compensate for.
* "Prediction Switching" allows you to selectively opt-into Predicting a ghost, giving you a decent tradeoff between client performance (via Interpolation) and gameplay responsiveness (via Client Prediction), while maintaining server authority.


## Links discovered
- [Prediction Switching](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/prediction.html#prediction-switching)

--- NetcodeSamples/Assets/Samples/Asteroids/Materials/texgen.html ---
<html>

    <head>
        <title>Texture generator</title>
        <script>
        function renderBullet() {
            var canvas = document.getElementById("bullet");
            var ctx = canvas.getContext("2d");
            var size = 32;
            canvas.width = size;
            canvas.height = size;

            var trail = false;
            ctx.lineCap = "round";
            // trail
            if (trail) {
                ctx.strokeStyle = "rgba(255,255,255,0.49)";
                ctx.lineWidth = size/4 - 0.25;
                ctx.beginPath();
                ctx.moveTo(size/2, size/4);
                ctx.lineTo(size/2, size-size/4);
                ctx.stroke();
            }

            // Bullet
            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = size/4;
            ctx.beginPath();
            ctx.moveTo(size/2, size/4);
            ctx.lineTo(size/2, trail ? (size/2) : (size - size/4));
            ctx.stroke();
        }

        function renderShip(shadow) {
            var canvas = document.getElementById(shadow?"ship_with_shadow" : "ship");
            var ctx = canvas.getContext("2d");
            var size = 32;
            canvas.width = size;
            canvas.height = size;

            ctx.lineCap = "round";
            ctx.lineJoin = "round";

            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = size/12;
            if (shadow) {
                ctx.shadowColor = "#ffffff";
                ctx.shadowBlur = size/16;
                ctx.lineWidth += size/16;
            }

            ctx.beginPath();
            ctx.moveTo(size/2, size/8);
            ctx.lineTo(size/4, size - size/8);
            ctx.lineTo(size - size/4, size - size/8);
            ctx.closePath();
            ctx.stroke();
            if (shadow) {
                ctx.shadowBlur = 0;
            }
        }
        function renderAsteroid() {
            var canvas = document.getElementById("asteroid");
            var ctx = canvas.getContext("2d");
            var size = 32;
            canvas.width = size;
            canvas.height = size;

            ctx.lineCap = "round";
            ctx.lineJoin = "round";

            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = size/16;
            ctx.beginPath();
            ctx.moveTo(size/16, size/16);
            ctx.lineTo(size/16, size - size/16);
            ctx.lineTo(size - size/16, size - size/16);
            ctx.lineTo(size - size/16, size/16);
            ctx.closePath();
            ctx.stroke();
        }
        function renderParticle() {
            var canvas = document.getElementById("particle");
            var ctx = canvas.getContext("2d");
            var size = 32;
            canvas.width = size;
            canvas.height = size;

            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(size/2, size/2, size/2, 0, 2 * Math.PI);
            ctx.fill();
        }
        window.onload = function() {
            renderBullet();
            renderShip(false);
            renderShip(true);
            renderAsteroid();
            renderParticle();
        }
        </script>
    </head>
    <body style="background: black;">
        <canvas id="bullet"></canvas>
        <canvas id="ship"></canvas>
        <canvas id="ship_with_shadow"></canvas>
        <canvas id="asteroid"></canvas>
        <canvas id="particle"></canvas>
    </body>
</html>


--- NetcodeSamples/Assets/Samples/HelloNetcode/1_Basics/01_BootstrapAndFrontend/BootstrapAndFrontend.md ---
# HelloNetcode Bootstrap and Frontend sample

The netcode package provides a way to automatically create client and server worlds and connect them together (client connects to server) by using a custom bootstrapper and the auto connector feature. This works in simple cases when testing out features quickly.

It's also possible to do everything manually via helper methods, including creating the worlds and setting up connections.

When any HelloNetcode sample is directly opened (besides the _Frontend_ scene), the autoconnect functionality is used.

See

* _Establish a connection_ section in the [Getting Started](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/getting-started.html) guide
* [Client Server Worlds](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/client-server-worlds.html)
* [Network Connection](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/network-connection.html)

## Sample description

This sample shows the modification needed to the bootstrap functionality to enable the auto connection feature and to select an alternative manual connection and world creation method, called _Frontend_ here. It's split into two parts:

* Bootstrap folder of the sample has the custom bootstrap code file, it enables auto connection when the frontend is not being used and also creates the default client and server worlds (like would happen with the default netcode bootstrap).
* Frontend folder shows a UI for selecting at runtime if you'd want to host a game or join one. It creates at runtime either a only a client world (join) or both client and server (host) and then manually starts listening or connecting as appropriate.

The frontend is placed in a separate assembly from the bootstrap assembly since this is something we do not want to include in dedicated server builds (UNITY_SERVER is defined).

There three scenes here:

* _Frontend.unity_ has manual connection setup (connect or host) and on demand world creation (at runtime) with scene selection of all sample scenes in the project.
* There is a companion _FrontendHUD.unity_ scene which shows the UI for going back to the main menu after a scene has been opened from the frontend, and text for the connection status.
* A _FrontendBootstrap_ scene is meant to be placed first in the build settings scene list and sets up a few flows for the first sample scene loaded. It loads the Asteroids sample by default when a dedicated server is launched, but otherwise the frontend scene. When a scene name is given on the command line it picks that instead.

## Note

> [!NOTE]
> The Frontend scene contains a toggle for relay support. To read more about what this feature entails, refer to the 01b_RelaySupport description.

## Links discovered
- [Getting Started](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/getting-started.html)
- [Client Server Worlds](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/client-server-worlds.html)
- [Network Connection](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/network-connection.html)

--- NetcodeSamples/Assets/Samples/HelloNetcode/2_Intermediate/01_CharacterController/CharacterController.md ---
# HelloNetcode Character Controller sample

This samples shows how you can expand kinematic character controllers as used in the Physics sample to allow characters to react to and walk on static geometry. The motion is still using kinematic physics, but it checks if it is standing on something and makes sure to not go through obstacles.

See

* [Physics](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/physics.html)
* [Unity Physics](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/TableOfContents.html) package

## Requirements

The spawn player sample is used to trigger the auto spawning of the player when connection is established. The dynamic physics objects from the physics sample are used.

* GoInGame
* SpawnPlayer
* Physics

## Sample description

This sample works very similar to the Physics sample, the only difference is how the character is moved. The character has a reference to a character controller config which has a separate physics collider. The collider used for the character controller only collides with static geometry, this means that the character controller can perform collider casts to find a valid position to move to. The actual movement is performed by setting a physics velocity on the real collider and let physics move it. This means all interactions with dynamic objects are performed, but they do not affect the movement of the player.

The character controller prefab has been modified compared to the physics player sample like so:

* Add a CharacterControllerAuthoring with a reference to a new prefab which has a CharacterControllerConfigAuthoring

The CharacterControllerConfig is a separate prefab which has a collider setup to only collide with static objects, and some configuration parameters for movement.


## Links discovered
- [Physics](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/physics.html)
- [Unity Physics](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/TableOfContents.html)

--- NetcodeSamples/Assets/Samples/HelloNetcode/3_Advanced/05_ClientOnlyState/ClientOnlyState.md ---
# HelloNetcode Client-Only state backup

The sample show how to backup and restore predicted ghosts components that are not replicated by the server, and that are (usually) present only on the client. 
I.e components that are used to track a client-only state machine, counters, animation states etc.

You can learn more about prediction [here](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/prediction.html).

## Requirements

Connection needs to be in game already.
* GoInGame
* SpawnPlayer

## Sample description
The sample uses the helper library SamplesCommon.ClientOnlyComponentBackup, that provides a common set of utility, systems, and logic for restoring and backup client-only components.

We choose to make the *PlayerMovement* component not replicated by the server. For that purpose, we created a new player ghost prefab, similar to the one used in the SpawnPlayer sample,
and by using the the *ghost authoring inspector component*, we customised the *PlayerMovement* to be not replicated (but still present on the server and client, because the server is also using it)
by setting the variant to use as 'DontSerializeVariant'. You can learn more about variants and their setup in [Ghost component types and variants](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/ghost-types-templates.html).
 
The client requests the *PlayerMovement* component to be backup/restored by registering it to the **ClientOnlyCollection** singleton, by calling the
RegisterClientOnlyComponents method. **The registration must done before entering in game**.


At runtime, on the client worlds, two systems are responsible to copy and restore the components states as part of the prediction loop:
- **ClientOnlyComponentBackupSystem**: responsible to backup the ghost which has client-only components and create other accessory metadata.
- **ClientOnlyComponentRestoreSystem**: responsible to restore the client-only components when new snapshots are received.

### How the backup and restore systems works

The *ClientOnlyComponentBackupSystem* run at the end of the prediction loop, and it is responsible to build some new metadata, necessary to backup the component state, and to backup the component data.
In particular:
- Collects and create metadata for all ghost prefabs that present a client-only component. This is a pre-processing stage performed before the actual backup can take place. 
- Adds to all predicted ghosts that uses a prefab type with client-only data a new ClientOnlyBackup state component. The component contains a buffer, used to store the component backup, 
and other accessory data.
- For each full prediction tick, it processes all predicted ghosts with a ClientOnlyBackup, and stores their client-only component states in the backup buffer. 

The components backup is stored in a resizable circular buffer. The buffer does not have a fixed size because it need to grow as necessary to accomodate latency and the fact ghosts are sent at different interval/priority. All predicted tick since the last snapshot
received for that ghost must be present, in order to be able to restore the correct components states.

The *ClientOnlyComponentRestoreSystem* is responsible to restore the component states. It runs as part of the GhostSimulationSystemGroup, after the GhostUpdateSystem.
This order is particularly important for two reasons:
- The GhostUpdateSystem updates for all the predicted ghost the tick at which the prediction should start. As such, this information must be up-to-date when the ClientOnlyComponentRestoreSystem runs.
- The GhostUpdateSystem updates all the ghost components states, because a snapshot is received or a "partial" restore (prediction backup).
 
By running the system after the GhostUpdate and before the next prediction loop, we are guaranteeing that **all the components are restored to the correct tick** inside the whole simulation group.

The restoring process itself does two important step:
- refresh the component data for all predicted ghosts that need to be updated, by mem-copying back the component the data from the backup.
- reduces the size of the backup buffer, by removing the old component backups. This let the buffer sizes to stay in check and have bounded capacity.

Further information can be found in the SamplesCommon.ClientOnlyComponentBackup (see all comments in code).

### Notes
The sample could be seen as a little "improper", meaning that the component is used also by the server to drive some simulation. However, due to the nature of the logic itself (and its predictability),
the client can actually completely predict the value of the counter. And because of that we choose to use it as an example.

### Limitations
- Buffers are currently not supported
- Only 32 client-only component types can be registered.


## Links discovered
- [here](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/prediction.html)
- [Ghost component types and variants](https://docs.unity3d.com/Packages/com.unity.netcode@latest?subfolder=/manual/ghost-types-templates.html)

--- PhysicsSamples/README.md ---
# Unity Physics Samples

*For more Phyiscs and DOTS starter material, see the [main page of this repo](../README.md).*

## Controls 

In the *Game* window:

- Mouse spring : Click and drag with left mouse
- Camera rotate : Click and drag with right mouse
- Camera move : W,A,S,D keys

## Debug Display

A lot of the demos display extra information as debug display gizmos in the Editor, for example the Query demos (ray cast, distance cast, etc). This display for these gizmos is in the *Scene* not the *Game* window. So keep an eye on both if in doubt:

| Scene view                                                                  | Game view                                                                   |
|-----------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| ![Game window](READMEimages/closes_hit_scene_view.png)                      | ![Game window](READMEimages/closes_hit_game_view.png)                       |

## Scene List

| Category    | Scene                                                         | Description                                                         |    Level     |                                                                                  |
|-------------|---------------------------------------------------------------|---------------------------------------------------------------------|:------------:|----------------------------------------------------------------------------------|
| Hello World | <sub>Hello World.unity</sub>                                  | Introductory scene for rigid body setup                             | Introductory | ![Demo image](READMEimages/hello_world.gif)                                      |
| Hello World | <sub>SphereAndBoxColliders.unity</sub>                        | Basic colliders                                                     | Introductory | ![Demo image](READMEimages/representations.gif)                                  |
| Hello World | <sub>GravityWell.unity</sub>                                  | Introductory scene                                                  | Introductory | ![Demo image](READMEimages/conversion.gif)                                       |
| Setup       | <sub>2a1. Collider Parade - Basic.unity</sub>                 | Demo showing various shapes for collision detection                 | Introductory | ![Demo image](READMEimages/collider_parade_basic.gif)                            |
| Setup       | <sub>2a2. Collider Parade - Advanced</sub>                    | Demo showing various shapes for more advanced collision detection   | Introductory | ![Demo image](READMEimages/collider_parade_advanced.gif)                         |
| Setup       | <sub>2b1. Motion Properties - Mass.unity</sub>                | Demo showing how to explicitly set mass properties using custom (yellow) and built-in (grey) authoring components | Introductory | ![Demo image](READMEimages/motion_properties_mass.gif) |
| Setup       | <sub>2b2. Motion Properties - Velocity.unity</sub>            | Setting initial linear and angular velocities                       | Introductory | ![Demo Image](READMEimages/motion_properties_velocity.gif)                       |
| Setup       | <sub>2b3. Motion Properties - Damping.unity</sub>             | Demo showing the effect of linear and angular damping               | Introductory | ![Demo Image](READMEimages/motion_properties_damping.gif)                        |
| Setup       | <sub>2b4. Motion Properties - Gravity Factor.unity</sub>      | Demo showing the effect of per body gravity multipliers             | Introductory | ![Demo Image](READMEimages/motion_properties_gravity_factor.gif)                 |
| Setup       | <sub>2b5. Motion Properties - Center of Mass.unity</sub>      | Demo showing the effect of overriding center of mass                | Introductory | ![Demo Image](READMEimages/motion_properties_center_of_mass.gif)                 |
| Setup       | <sub>2b6. Motion Properties - Inertia Tensor.unity</sub>      | Demo showing the effect of overriding inertia tensor                | Introductory | ![Demo Image](READMEimages/motion_properties_inertia_tensor.gif)                 |
| Setup       | <sub>2b7. Motion Properties - Smoothing.unity</sub>           | Demo showing the effect of interpolation and extrapolation          | Introductory | ![Demo Image](READMEimages/motion_properties_smoothing.gif)                      |
| Setup       | <sub>2c1. Material Properties - Friction.unity</sub>          | Showing effect of different friction material values                | Introductory | ![Demo Image](READMEimages/material_properties_friction.gif)                     |
| Setup       | <sub>2c2. Material Properties - Restitution.unity</sub>       | Showing effect of different restitution values                      | Introductory | ![Demo Image](READMEimages/material_properties_restitution.gif)                  |
| Setup       | <sub>2c3. Material Properties - Collision Filters.unity</sub> | Showing effect of different collision filters                       | Introductory | ![Demo Image](READMEimages/material_properties_collision_filters.gif)            |
| Setup       | <sub>2d1. Events - Triggers.unity</sub>                       | Demo demonstrating the usage of triggers                            | Introductory | ![Demo Image](READMEimages/events_triggers.gif)                                  |
| Setup       | <sub>2d2. Events - Contacts.unity</sub>                       | Showing effect of different contacts                                | Introductory | ![Demo Image](READMEimages/events_contacts.gif)                                  |
| Query       | <sub>3a. All Hits Distance Test.unity</sub>                   | Demo showing results of distance queries between multiple colliders | Introductory | ![Demo Image](READMEimages/all_hits_distance_test.gif)                           |
| Query       | <sub>3b. Cast Test.unity</sub>                                | Demo showing the results of collider casting and ray casting        | Introductory | ![Demo Image](READMEimages/cast_test.gif)                                        |
| Query       | <sub>3c. Closest Hit Distance Test.unity</sub>                | Demo showing results of distance queries                            | Introductory | ![Demo Image](READMEimages/closest_hit_distance_test.gif)                        |
| Query       | <sub>3d. Custom Collector.unity</sub>                         | Demonstration of raycast                                            | Introductory | ![Demo Image](READMEimages/custom_collector.gif)                                 |
| Joints      | <sub>4a. Joints Parade.unity</sub>                            | Demo showing a range of joint types                                 | Introductory | ![Demo Image](READMEimages/joints_parade.gif)                                    |
| Joints      | <sub>4b. Limit DOF.unity</sub>                                | Showing effect of limiting degrees of freedom                       | Introductory | ![Demo Image](READMEimages/limit_dof.gif)                                        |
| Joints      | <sub>4c1. All Motors Parade.unity</sub>                       | Demo showing different motors                                       | Introductory | ![Demo Image](READMEimages/all_motors_parade.gif)                                |
| Joints      | <sub>4c2. Position Motor.unity</sub>                          | Demo showing position motor                                         | Introductory | ![Demo Image](READMEimages/position_motor.gif)                                   |
| Joints      | <sub>4c3. Linear Velocity Motor.unity</sub>                   | Showing linear velocity motor                                       | Introductory | ![Demo Image](READMEimages/linear_velocity_motor.gif)                            |
| Joints      | <sub>4c4. Angular Velocity Motor.unity</sub>                  | Demonstrating angular velocity motor                                | Introductory | ![Demo Image](READMEimages/angular_velocity_motor.gif)                           |
| Joints      | <sub>4c5. Rotational Motor.unity</sub>                        | Demonstrating rotational motor                                      | Introductory | ![Demo Image](READMEimages/rotational_motor.gif)                                 |
| Joints      | <sub>4d. Ragdolls.unity</sub>                                 | Obligatory stack of ragdolls demo                                   | Introductory | ![Ragdoll](READMEimages/ragdoll.gif)                                             |
| Joints      | <sub>4e. Single Ragdoll.unity</sub>                           | GameObject ragdoll for Unity Physics (left) and built-in physics (right), created using the [Ragdoll Wizard](https://docs.unity3d.com/Manual/wizard-RagdollWizard.html) | Introductory | ![Demo Image](READMEimages/single_ragdoll.gif) |
| Modify      | <sub>5a. Change Motion Type.unity</sub>                       | Demo showing change of motion type                                  | Introductory | ![Demo Image](READMEimages/change_motion_types.gif)                              |
| Modify      | <sub>5b. Change Box Collider Size.unity</sub>                 | Demonstrating runtime change of collider size                       | Introductory | ![Demo Image](READMEimages/change_box_collider_size.gif)                         |
| Modify      | <sub>5c. Change Collider Type.unity</sub>                     | Demonstrating change of collider type                               | Introductory | ![Demo Image](READMEimages/change_collider_type.gif)                             |
| Modify      | <sub>5d. Change Velocity.unity</sub>                          | Demo showing change of velocity                                     | Introductory | ![Demo Image](READMEimages/change_velocity.gif)                                  |
| Modify      | <sub>5e. Kinematic Motion.unity</sub>                         | Demo showing kinematic motion in combination with dynamic objects   | Introductory | ![Demo Image](READMEimages/kinematic_motion.gif)                                 |
| Modify      | <sub>5f. Change Surface Velocity.unity</sub>                  | Demo showing change of surface velocity                             | Introductory | ![Demo Image](READMEimages/change_surface_velocity.gif)                          |
| Modify      | <sub>5g1. Change Collider Material - Bouncy Boxes.unity</sub> | Demo showing effect of unique prefab instantiation with collider material changes | Intermediate | ![Demo Image](READMEimages/runtime_modification_collider_material.gif) |
| Modify      | <sub>5g2. Unique Collider Blob Sharing.unity</sub>            | Demo showing effect of instantiating prefabs during runtime, making collider blobs unique and sharing collider blob data | Advanced | ![Demo Image](READMEimages/runtime_modification_unique_sharing.gif) |
| Modify      | <sub>5g3. Runtime Collider Creation.unity</sub>               | Create mesh colliders during runtime                                |   Advanced   | ![Modify colliders during runtime](READMEimages/modify_colliders_runtime.gif)    |
| Modify      | <sub>5g4. Runtime Collision Filter Modification.unity</sub>   | Modify collision filters during runtime                             |   Advanced   | ![Modify collision filters during runtime](READMEimages/runtime_modification_collision_filter.gif) |
| Modify      | <sub>5g5. Modify Collider Geometry.unity</sub>                | Modify collider geometry during runtime                             |   Advanced   | ![Modify collider geometry during runtime](READMEimages/runtime_modification_geometry.gif) |
| Modify      | <sub>5h. Change Scale.unity</sub>                             | Demo showing scale change of entities                               | Introductory | ![Demo Image](READMEimages/change_scale.gif)                                     |
| Modify      | <sub>5i. Apply Impulse.unity</sub>                            | Demo showing application of impulses                                | Introductory | ![Demo Image](READMEimages/apply_impulse.gif)                                    |
| Modify      | <sub>5j. Modify Broadphase Pairs.unity</sub>                  | Filter out collision by explicitly deleting pairs from broad phase  |   Advanced   | ![Modify broadphase Sample](READMEimages/modify_broadphase_pairs.gif)            |
| Modify      | <sub>5k. Modify Contact Jacobians.unity</sub>                 | Modify the results of contact generation to produce special effects |   Advanced   | ![Modify contacts](READMEimages/modify_contact_jacobians.gif)                    |
| Modify      | <sub>5l. Modify Narrowphase Contacts.unity</sub>              | Add new user contacts to simulation pipeline                        |   Advanced   | ![Modify Narrowphase contacts](READMEimages/modify_narrowphase_contacts.gif)     | 
| Use Case    | <sub>6a. Character Controller.unity</sub>                     | User case demo showing a rudimentary FPS character controller       | Intermediate | ![Character Control](READMEimages/character_controller.gif)                      |
| Use Case    | <sub>6b. Pool.unity</sub>                                     | Demonstration of calling immediate mode physics                     | Intermediate | ![Immediate physics](READMEimages/pool.gif)                                      |
| Use Case    | <sub>6c. Planet Gravity.unity</sub>                           | Performance demo of asteroids around a planet using SP/HP           | Introductory | ![Planet Gravity](READMEimages/planet_gravity.gif)                               |
| Use Case    | <sub>6d. Raycast Car.unity</sub>                              | User case demo showing a set of vehicle behaviors                   | Intermediate | ![Vehicles](READMEimages/raycast_car.gif)                                        |


## Links discovered
- [main page of this repo](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/README.md)
- [Game window](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/closes_hit_scene_view.png)
- [Game window](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/closes_hit_game_view.png)
- [Demo image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/hello_world.gif)
- [Demo image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/representations.gif)
- [Demo image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/conversion.gif)
- [Demo image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/collider_parade_basic.gif)
- [Demo image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/collider_parade_advanced.gif)
- [Demo image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_mass.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_velocity.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_damping.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_gravity_factor.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_center_of_mass.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_inertia_tensor.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/motion_properties_smoothing.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/material_properties_friction.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/material_properties_restitution.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/material_properties_collision_filters.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/events_triggers.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/events_contacts.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/all_hits_distance_test.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/cast_test.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/closest_hit_distance_test.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/custom_collector.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/joints_parade.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/limit_dof.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/all_motors_parade.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/position_motor.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/linear_velocity_motor.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/angular_velocity_motor.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/rotational_motor.gif)
- [Ragdoll](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/ragdoll.gif)
- [Ragdoll Wizard](https://docs.unity3d.com/Manual/wizard-RagdollWizard.html)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/single_ragdoll.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/change_motion_types.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/change_box_collider_size.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/change_collider_type.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/change_velocity.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/kinematic_motion.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/change_surface_velocity.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/runtime_modification_collider_material.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/runtime_modification_unique_sharing.gif)
- [Modify colliders during runtime](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/modify_colliders_runtime.gif)
- [Modify collision filters during runtime](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/runtime_modification_collision_filter.gif)
- [Modify collider geometry during runtime](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/runtime_modification_geometry.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/change_scale.gif)
- [Demo Image](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/apply_impulse.gif)
- [Modify broadphase Sample](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/modify_broadphase_pairs.gif)
- [Modify contacts](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/modify_contact_jacobians.gif)
- [Modify Narrowphase contacts](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/modify_narrowphase_contacts.gif)
- [Character Control](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/character_controller.gif)
- [Immediate physics](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/pool.gif)
- [Planet Gravity](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/planet_gravity.gif)
- [Vehicles](https://github.com/Unity-Technologies/EntityComponentSystemSamples/blob/master/PhysicsSamples/READMEimages/raycast_car.gif)

--- PhysicsSamples/Assets/Tests/StreamingStressTest/README.md ---
Use the `StreamingStressTest` scene to test the creation and deletion of physics colliders at runtime.

When you open this scene for the first time you need to create the entities based on the GameObject cubes with physics peroperties. Select each of the active subscenes named _SubScene__* and in the inspector click "Rebuild Entities Cache". For large subscenes this can take up to 10 minutes or more. Whenever you modify a subscene you need to rebuild its entity cache again.

The sub-scenes _SubScene_StaticColliders_Fixed_Small_ and _SubScene_StaticColliders_Fixed_Large_ add to the main scene around 5000 and respectively 46000 static cubes. The larger scene is disabled by default.

_SubScene_StaticColliders_Streaming_ contains around 5000 static cubes and has a script attached to it that requests this subscene to be loaded or unloaded every `FramesBetweenStramingOperations = 10` frames. This simulates a scenario where parts of the game world get streamed in and out during gameplay.

/!\ Cubes will be flashing in the game view as they get streamed in and out frequently.


--- PhysicsSamples/ProjectSettings/ProjectVersion.txt ---
m_EditorVersion: 6000.2.10f1
m_EditorVersionWithRevision: 6000.2.10f1 (d3d30d158480)
