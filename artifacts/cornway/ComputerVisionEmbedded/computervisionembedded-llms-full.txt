# llms-full (private-aware)
> Built from GitHub files and website pages. Large files may be truncated.

--- development/u5/scripts/example_runner.py ---
# Copyright (c) 2024 Basalte bv
#
# SPDX-License-Identifier: Apache-2.0

from runners.core import RunnerCaps, ZephyrBinaryRunner


class ExampleRunner(ZephyrBinaryRunner):
    """Dummy example runner."""

    def __init__(self, cfg, param):
        super().__init__(cfg)
        self.param = param

    @classmethod
    def name(cls):
        return "example"

    @classmethod
    def capabilities(cls):
        return RunnerCaps(commands=({"simulate"}))

    @classmethod
    def do_add_parser(cls, parser):
        parser.add_argument("--param", action="store", help="An example parameter")

    @classmethod
    def do_create(cls, cfg, args):
        return cls(cfg, param=args.param)

    def do_run(self, command, **kwargs):
        self.logger.info(f"Running {command} on {self.param}")


--- development/u5/scripts/example_west_command.py ---
# Copyright (c) 2019 Foundries.io
# Copyright (c) 2022 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

'''example_west_command.py

Example of a west extension in the example-application repository.'''

from west.commands import WestCommand  # your extension must subclass this
from west import log                   # use this for user output

class ExampleWestCommand(WestCommand):

    def __init__(self):
        super().__init__(
            'example-west-command',               # gets stored as self.name
            'an example west extension command',  # self.help
            # self.description:
            '''\
A multi-line description of example-west-command.

You can split this up into multiple paragraphs and they'll get
reflowed for you. You can also pass
formatter_class=argparse.RawDescriptionHelpFormatter when calling
parser_adder.add_parser() below if you want to keep your line
endings.''')

    def do_add_parser(self, parser_adder):
        # This is a bit of boilerplate, which allows you full control over the
        # type of argparse handling you want. The "parser_adder" argument is
        # the return value of an argparse.ArgumentParser.add_subparsers() call.
        parser = parser_adder.add_parser(self.name,
                                         help=self.help,
                                         description=self.description)

        # Add some example options using the standard argparse module API.
        parser.add_argument('-o', '--optional', help='an optional argument')
        parser.add_argument('required', help='a required argument')

        return parser           # gets stored as self.parser

    def do_run(self, args, unknown_args):
        # This gets called when the user runs the command, e.g.:
        #
        #   $ west my-command-name -o FOO BAR
        #   --optional is FOO
        #   required is BAR
        log.inf('--optional is', args.optional)
        log.inf('required is', args.required)


--- development/README.md ---
## This repository contains a bunch of projects, primarily targeting stm32 based platforms
### The idea behind it - is to creatre unified space where you can build and start your own projects targeting Computer Vision and AI on the edge

Current version supports 3 customized boards, each board has well known predecessor \
Boards schematics and pcb's can be found [Here](https://github.com/cornway/ComputerVisionHw)\
Having this boards schematics you can easily figure out and adopt examples found here to your own hardware

For a fresh start
* Clone this repo
* `git submodule init --update`
* `west init -l u5`
* `west update`

### Apply stm32hal.patch, in case -O2 (CONFIG_SPEED_OPTIMIZATIONS=y) is used
* `cd modules/hal/stm32/`
* `git apply ../../../stm32hal.patch`

## Applicatons:
* **u5/uvc_gf_dk1/** - Simple one that utilizes UVC USB class to given board into a USB camera; only works for **grinreflex_dk1** board
* **u5/gf_dkx/** - unified application, can be used for all boards (so far), has two targets - face detection, and face + smile detection using opencv
* **uvc_gf_dk1/** - example video streaming application, available only for **grinreflex_n6_dk1** board

## Boards supported:
* **grinreflex_dk1** - uses schematic from [HW](https://github.com/cornway/ComputerVisionHw) repo **stm32u5_v1.0**
  * Extrnal flash
  * USB
  * OV2640 compatible camera
  * LCD serial display
  * A few GPIOS
  * ...
* **grinreflex_dk2** - counterpart of **stm32u5_v2.0** in [HW](https://github.com/cornway/ComputerVisionHw) repo
  * Simplified version of v1.0, unfortunatelly I put there MCU that seems to went out of stock
  * All hardware fetures from V1.0, except - there is no external flash and USB
* **grinreflex_n6_dk1** - most complicated so far, uses **stm32n6_v1.0** schematic in [HW](https://github.com/cornway/ComputerVisionHw)
  * Hw Features
    * LCD serial display
    * OV2640 compatible camera
    * Eternal flash
    * External vddcore regulator
    * Boot switch
    * GPIO extension connector
  * Build variants (Just provide this option after **-board** to west command)
    * **grinreflex_n6_dk3//app** - XIP application, requires **--sysbuild** option, loaded by fsbl
    * **grinreflex_n6_dk3//fsbl_app** - application that is a part of fsbl
    * **grinreflex_n6_dk3//fsbl** - fsbl, usually required when you specify **--sysbuild**, that builds mcuboot
    * Example: build XIP application \
    `west build -b grinreflex_n6_dk3//app --sysbuild u5/gf_n6_dk3/` \
That board pretty much derived from [Nucleo](https://docs.zephyrproject.org/latest/boards/st/nucleo_n657x0_q/doc/index.html), so you can use their tutorial to obtain information on how to build/run/debug

## Configuration options
* **CONFIG_OPENCV_LIB** - if **y**, adds OpenCv library, please see `u5/lib/cv/CMakeLists.txt` to see which modules are actually built
* **CONFIG_TFLITE_LIB** - if **y**, adds TfLite framework, the performance remains poor as no optimizations are done yet
* **CONFIG_QUIRC_LIB** - say **y** to Add [this](https://github.com/dlbeer/quirc)
* **CONFIG_NEMA** - enables **NEMA** or stm32's **GPU2.5**, no modifications required to **lvgl** (Yes, that works only as a part of lvgl so far), that sometimes significantly speeds up graphic manipulations
* **CONFIG_STM32_JPEG** - pretty much **rough** stm32's jpeg driver, tested only on **u5** family so far


### Note: while playing yo may face weird issues, where configuration is not suppoorted or missing, please feel free to submit an issue; Maintainers are very welcome


## Links discovered
- [Here](https://github.com/cornway/ComputerVisionHw)
- [HW](https://github.com/cornway/ComputerVisionHw)
- [Nucleo](https://docs.zephyrproject.org/latest/boards/st/nucleo_n657x0_q/doc/index.html)
- [this](https://github.com/dlbeer/quirc)

--- development/host/CMakeLists.txt ---
cmake_minimum_required(VERSION 3.10)
project(host_app)

# Find OpenCV4
find_package(OpenCV 4 REQUIRED)

set(OPENCV_HAAR_PATH "/usr/share/opencv4/")
#set(OPENCV_HAAR_PATH "${CMAKE_SOURCE_DIR}/Haar")

set(HAAR_HEADER "${CMAKE_BINARY_DIR}/Include/HaarPath.hpp")
file(MAKE_DIRECTORY "${CMAKE_BINARY_DIR}/Include")

configure_file(
    ${CMAKE_SOURCE_DIR}/HaarPath.hpp.in
    ${HAAR_HEADER}
    @ONLY
)

set(OPENCV_UTILS_DIR_PATH "../u5/common/opencv")

set(HOST_APP_SRCS
    Src/main.cpp
    ${OPENCV_UTILS_DIR_PATH}/src/opencv_utils.cpp
    ${OPENCV_UTILS_DIR_PATH}/src/opencv_pipeline.cpp
    ${OPENCV_UTILS_DIR_PATH}/include/gf/opencv_utils.hpp
    ${OPENCV_UTILS_DIR_PATH}/include/gf/opencv_pipeline.hpp
)

# Add executable
add_executable(host_app ${HOST_APP_SRCS})

# Link OpenCV libraries
target_include_directories(host_app
    PRIVATE "${CMAKE_BINARY_DIR}/Include"
    PRIVATE ${OpenCV_INCLUDE_DIRS}
    PRIVATE ${OPENCV_UTILS_DIR_PATH}/include)

target_link_libraries(host_app PRIVATE ${OpenCV_LIBS})


--- development/u5/README.md ---
# Zephyr Example Application

<a href="https://github.com/zephyrproject-rtos/example-application/actions/workflows/build.yml?query=branch%3Amain">
  <img src="https://github.com/zephyrproject-rtos/example-application/actions/workflows/build.yml/badge.svg?event=push">
</a>
<a href="https://github.com/zephyrproject-rtos/example-application/actions/workflows/docs.yml?query=branch%3Amain">
  <img src="https://github.com/zephyrproject-rtos/example-application/actions/workflows/docs.yml/badge.svg?event=push">
</a>
<a href="https://zephyrproject-rtos.github.io/example-application">
  <img alt="Documentation" src="https://img.shields.io/badge/documentation-3D578C?logo=sphinx&logoColor=white">
</a>
<a href="https://zephyrproject-rtos.github.io/example-application/doxygen">
  <img alt="API Documentation" src="https://img.shields.io/badge/API-documentation-3D578C?logo=c&logoColor=white">
</a>

This repository contains a Zephyr example application. The main purpose of this
repository is to serve as a reference on how to structure Zephyr-based
applications. Some of the features demonstrated in this example are:

- Basic [Zephyr application][app_dev] skeleton
- [Zephyr workspace applications][workspace_app]
- [Zephyr modules][modules]
- [West T2 topology][west_t2]
- [Custom boards][board_porting]
- Custom [devicetree bindings][bindings]
- Out-of-tree [drivers][drivers]
- Out-of-tree libraries
- Example CI configuration (using GitHub Actions)
- Custom [west extension][west_ext]
- Custom [Zephyr runner][runner_ext]
- Doxygen and Sphinx documentation boilerplate

This repository is versioned together with the [Zephyr main tree][zephyr]. This
means that every time that Zephyr is tagged, this repository is tagged as well
with the same version number, and the [manifest](west.yml) entry for `zephyr`
will point to the corresponding Zephyr tag. For example, the `example-application`
v2.6.0 will point to Zephyr v2.6.0. Note that the `main` branch always
points to the development branch of Zephyr, also `main`.

[app_dev]: https://docs.zephyrproject.org/latest/develop/application/index.html
[workspace_app]: https://docs.zephyrproject.org/latest/develop/application/index.html#zephyr-workspace-app
[modules]: https://docs.zephyrproject.org/latest/develop/modules.html
[west_t2]: https://docs.zephyrproject.org/latest/develop/west/workspaces.html#west-t2
[board_porting]: https://docs.zephyrproject.org/latest/guides/porting/board_porting.html
[bindings]: https://docs.zephyrproject.org/latest/guides/dts/bindings.html
[drivers]: https://docs.zephyrproject.org/latest/reference/drivers/index.html
[zephyr]: https://github.com/zephyrproject-rtos/zephyr
[west_ext]: https://docs.zephyrproject.org/latest/develop/west/extensions.html
[runner_ext]: https://docs.zephyrproject.org/latest/develop/modules.html#external-runners

## Getting Started

Before getting started, make sure you have a proper Zephyr development
environment. Follow the official
[Zephyr Getting Started Guide](https://docs.zephyrproject.org/latest/getting_started/index.html).

### Initialization

The first step is to initialize the workspace folder (``my-workspace``) where
the ``example-application`` and all Zephyr modules will be cloned. Run the following
command:

```shell
# initialize my-workspace for the example-application (main branch)
west init -m https://github.com/zephyrproject-rtos/example-application --mr main my-workspace
# update Zephyr modules
cd my-workspace
west update
```

### Building and running

To build the application, run the following command:

```shell
cd example-application
west build -b $BOARD app
```

where `$BOARD` is the target board.

You can use the `custom_plank` board found in this
repository. Note that Zephyr sample boards may be used if an
appropriate overlay is provided (see `app/boards`).

A sample debug configuration is also provided. To apply it, run the following
command:

```shell
west build -b $BOARD app -- -DEXTRA_CONF_FILE=debug.conf
```

Once you have built the application, run the following command to flash it:

```shell
west flash
```

### Testing

To execute Twister integration tests, run the following command:

```shell
west twister -T tests --integration
```

### Documentation

A minimal documentation setup is provided for Doxygen and Sphinx. To build the
documentation first change to the ``doc`` folder:

```shell
cd doc
```

Before continuing, check if you have Doxygen installed. It is recommended to
use the same Doxygen version used in [CI](.github/workflows/docs.yml). To
install Sphinx, make sure you have a Python installation in place and run:

```shell
pip install -r requirements.txt
```

API documentation (Doxygen) can be built using the following command:

```shell
doxygen
```

The output will be stored in the ``_build_doxygen`` folder. Similarly, the
Sphinx documentation (HTML) can be built using the following command:

```shell
make html
```

The output will be stored in the ``_build_sphinx`` folder. You may check for
other output formats other than HTML by running ``make help``.


## Links discovered
- [manifest](https://github.com/cornway/ComputerVisionEmbedded/blob/roman/development/u5/west.yml)
- [Zephyr Getting Started Guide](https://docs.zephyrproject.org/latest/getting_started/index.html)
- [CI](https://github.com/cornway/ComputerVisionEmbedded/blob/roman/development/u5/.github/workflows/docs.yml)
- [<img src="https://github.com/zephyrproject-rtos/example-application/actions/workflows/build.yml/badge.svg?event=push">](https://github.com/zephyrproject-rtos/example-application/actions/workflows/build.yml?query=branch%3Amain)
- [<img src="https://github.com/zephyrproject-rtos/example-application/actions/workflows/docs.yml/badge.svg?event=push">](https://github.com/zephyrproject-rtos/example-application/actions/workflows/docs.yml?query=branch%3Amain)
- [<img alt="Documentation" src="https://img.shields.io/badge/documentation-3D578C?logo=sphinx&logoColor=white">](https://zephyrproject-rtos.github.io/example-application)
- [<img alt="API Documentation" src="https://img.shields.io/badge/API-documentation-3D578C?logo=c&logoColor=white">](https://zephyrproject-rtos.github.io/example-application/doxygen)

--- development/u5/gf_n6_dk3/README.rst ---
.. zephyr:code-sample:: hello_world
   :name: Hello World

   Print "Hello World" to the console.

Overview
********

A simple sample that can be used with any :ref:`supported board <boards>` and
prints "Hello World" to the console.

Building and Running
********************

This application can be built and executed on QEMU as follows:

.. zephyr-app-commands::
   :zephyr-app: samples/hello_world
   :host-os: unix
   :board: qemu_x86
   :goals: run
   :compact:

To build for another board, change "qemu_x86" above to that board's name.

Sample Output
=============

.. code-block:: console

    Hello World! x86

Exit QEMU by pressing :kbd:`CTRL+A` :kbd:`x`.


--- development/u5/CMakeLists.txt ---
# Copyright (c) 2021 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0
#
# This CMake file is picked by the Zephyr build system because it is defined
# as the module CMake entry point (see zephyr/module.yml).


# This is needed so that custom driver classes using system calls are taken into
# account
zephyr_syscall_include_directories(include)

zephyr_include_directories(include)

add_subdirectory(drivers)
add_subdirectory(lib)
add_subdirectory(common)



--- development/u5/common/CMakeLists.txt ---


if (CONFIG_OPENCV_LIB)
add_subdirectory(opencv)
endif()

if (CONFIG_NEMA)
add_subdirectory(nema)
endif()

target_include_directories(app PUBLIC include)

if (CONFIG_VIDEO)
target_sources(app PRIVATE
    src/video.cpp
)
endif()

if (CONFIG_LVGL)
target_sources(app PRIVATE
    src/lvgl_utils.cpp
    src/utils.cpp
)
endif()

dt_has_chosen(USART2 PROPERTY "zephyr_usart2")

if (USART2)
target_sources(app PRIVATE
    src/uart.cpp
)
endif()


--- development/u5/drivers/CMakeLists.txt ---
# Copyright (c) 2021 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

# Out-of-tree drivers for existing driver classes STM32 NEMA 2DGPU
add_subdirectory_ifdef(CONFIG_NEMA nema)
add_subdirectory_ifdef(CONFIG_STM32_JPEG jpeg)


--- development/u5/gf_dkx/CMakeLists.txt ---
#-------------------------------------------------------------------------------
# Zephyr Example Application
#
# Copyright (c) 2021 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

cmake_minimum_required(VERSION 3.13.1)

set(EXTRA_CONF_FILE
    ${CMAKE_CURRENT_SOURCE_DIR}/lvgl.conf;
)

if (CONFIG_VARIANT_RELEASE)
set(DTC_OVERLAY_FILE ${DTC_OVERLAY_FILE};${CMAKE_CURRENT_SOURCE_DIR}/overlays/release.overlay CACHE STRING "" FORCE)
endif()

find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})

project(gf_dkx)

target_include_directories(app PRIVATE
    src
)

target_sources(app PRIVATE
    src/main.c
)

include(${ZEPHYR_BASE}/samples/subsys/usb/common/common.cmake)

if (CONFIG_OPENCV_LIB)
    if (CONFIG_VARIAND_FACE_DETECT_ONLY)
        target_sources(app PRIVATE
            src/opencv_fd_only_app.cpp
        )
    else()
        target_sources(app PRIVATE
            src/opencv_fd_app.cpp
        )
    endif()
else()
    target_sources(app PRIVATE
        src/lvgl_video_app.cpp
    )
endif()

execute_process(
    COMMAND git describe --always --dirty
    OUTPUT_VARIABLE GIT_REVISION
)

string(REGEX REPLACE "\n$" "" GIT_REVISION "${GIT_REVISION}")

configure_file(
    src/version.h.in
    src/version.h
    @ONLY
)

target_include_directories(app PRIVATE "${CMAKE_CURRENT_BINARY_DIR}/src")


--- development/u5/gf_n6_dk3/CMakeLists.txt ---
# SPDX-License-Identifier: Apache-2.0

cmake_minimum_required(VERSION 3.20.0)

find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})
project(gf_n6_dk3)

target_include_directories(app PRIVATE
src
)

target_sources(app PRIVATE
src/application.cpp
src/main.c)


--- development/u5/lib/CMakeLists.txt ---
# SPDX-License-Identifier: Apache-2.0

add_subdirectory_ifdef(CONFIG_TFLITE_LIB tflite)
add_subdirectory_ifdef(CONFIG_OPENCV_LIB cv)
add_subdirectory_ifdef(CONFIG_QUIRC_LIB quirc)

--- development/u5/uvc_gf_dk1/CMakeLists.txt ---
cmake_minimum_required(VERSION 3.13.1)

set(EXTRA_CONF_FILE
    ${CMAKE_CURRENT_SOURCE_DIR}/lvgl.conf;
)

find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})

project(uvc_gf_dk1)
include(${ZEPHYR_BASE}/samples/subsys/usb/common/common.cmake)

target_include_directories(app PRIVATE
    src
)

target_sources(app PRIVATE
    src/main.c
)

if (NOT CONFIG_BOARD_GRINREFLEX_DK1)
message(FATAL "only CONFIG_BOARD_GRINREFLEX_DK1 is supported")
endif()

--- development/u5/doc/conf.py ---
# Configuration file for the Sphinx documentation builder.
#
# For the full list of built-in configuration values, see the documentation:
# https://www.sphinx-doc.org/en/master/usage/configuration.html

# -- Project information -----------------------------------------------------
# https://www.sphinx-doc.org/en/master/usage/configuration.html#project-information

project = 'Example Application'
copyright = '2024, The Zephyr Community'
author = 'The Zephyr Community'
release = '1.0.0'

# -- General configuration ---------------------------------------------------
# https://www.sphinx-doc.org/en/master/usage/configuration.html#general-configuration

extensions = ['sphinx.ext.intersphinx']

templates_path = ['_templates']
exclude_patterns = ['_build_sphinx', 'Thumbs.db', '.DS_Store']

# -- Options for HTML output -------------------------------------------------
# https://www.sphinx-doc.org/en/master/usage/configuration.html#options-for-html-output

html_theme = 'alabaster'

# -- Options for Intersphinx -------------------------------------------------
# https://www.sphinx-doc.org/en/master/usage/extensions/intersphinx.html

intersphinx_mapping = {'zephyr': ('https://docs.zephyrproject.org/latest/', None)}
